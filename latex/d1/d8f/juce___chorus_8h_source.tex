\hypertarget{juce___chorus_8h_source}{}\doxysection{juce\+\_\+\+Chorus.\+h}
\label{juce___chorus_8h_source}\index{build/juce\_dsp/widgets/juce\_Chorus.h@{build/juce\_dsp/widgets/juce\_Chorus.h}}
\mbox{\hyperlink{juce___chorus_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 }
\DoxyCodeLine{5 \textcolor{comment}{/*}}
\DoxyCodeLine{6 \textcolor{comment}{  ==============================================================================}}
\DoxyCodeLine{7 \textcolor{comment}{}}
\DoxyCodeLine{8 \textcolor{comment}{   This file is part of the JUCE library.}}
\DoxyCodeLine{9 \textcolor{comment}{   Copyright (c) 2020 -\/ Raw Material Software Limited}}
\DoxyCodeLine{10 \textcolor{comment}{}}
\DoxyCodeLine{11 \textcolor{comment}{   JUCE is an open source library subject to commercial or open-\/source}}
\DoxyCodeLine{12 \textcolor{comment}{   licensing.}}
\DoxyCodeLine{13 \textcolor{comment}{}}
\DoxyCodeLine{14 \textcolor{comment}{   By using JUCE, you agree to the terms of both the JUCE 6 End-\/User License}}
\DoxyCodeLine{15 \textcolor{comment}{   Agreement and JUCE Privacy Policy (both effective as of the 16th June 2020).}}
\DoxyCodeLine{16 \textcolor{comment}{}}
\DoxyCodeLine{17 \textcolor{comment}{   End User License Agreement: www.juce.com/juce-\/6-\/licence}}
\DoxyCodeLine{18 \textcolor{comment}{   Privacy Policy: www.juce.com/juce-\/privacy-\/policy}}
\DoxyCodeLine{19 \textcolor{comment}{}}
\DoxyCodeLine{20 \textcolor{comment}{   Or: You may also use this code under the terms of the GPL v3 (see}}
\DoxyCodeLine{21 \textcolor{comment}{   www.gnu.org/licenses).}}
\DoxyCodeLine{22 \textcolor{comment}{}}
\DoxyCodeLine{23 \textcolor{comment}{   JUCE IS PROVIDED "{}AS IS"{} WITHOUT ANY WARRANTY, AND ALL WARRANTIES, WHETHER}}
\DoxyCodeLine{24 \textcolor{comment}{   EXPRESSED OR IMPLIED, INCLUDING MERCHANTABILITY AND FITNESS FOR PURPOSE, ARE}}
\DoxyCodeLine{25 \textcolor{comment}{   DISCLAIMED.}}
\DoxyCodeLine{26 \textcolor{comment}{}}
\DoxyCodeLine{27 \textcolor{comment}{  ==============================================================================}}
\DoxyCodeLine{28 \textcolor{comment}{*/}}
\DoxyCodeLine{29 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespacedsp}{dsp}}}
\DoxyCodeLine{30 \{}
\DoxyCodeLine{31 }
\DoxyCodeLine{47 \textcolor{keyword}{template} <\textcolor{keyword}{typename} SampleType>}
\DoxyCodeLine{48 \textcolor{keyword}{class }\mbox{\hyperlink{classdsp_1_1_chorus}{Chorus}}}
\DoxyCodeLine{49 \{}
\DoxyCodeLine{50 \textcolor{keyword}{public}:}
\DoxyCodeLine{51     \textcolor{comment}{//==============================================================================}}
\DoxyCodeLine{53 \textcolor{comment}{}    \mbox{\hyperlink{classdsp_1_1_chorus_a00ee9518bdcd6d9ba15282ec49d68116}{Chorus}}();}
\DoxyCodeLine{54 }
\DoxyCodeLine{55     \textcolor{comment}{//==============================================================================}}
\DoxyCodeLine{59 \textcolor{comment}{}    \textcolor{keywordtype}{void} \mbox{\hyperlink{classdsp_1_1_chorus_a6b0d1c3a4d9b9b8ccedc68106d9cb2ee}{setRate}} (SampleType newRateHz);}
\DoxyCodeLine{60 }
\DoxyCodeLine{63     \textcolor{keywordtype}{void} \mbox{\hyperlink{classdsp_1_1_chorus_abebc9cf04656ab0e58093cd90e46285f}{setDepth}} (SampleType newDepth);}
\DoxyCodeLine{64 }
\DoxyCodeLine{68     \textcolor{keywordtype}{void} \mbox{\hyperlink{classdsp_1_1_chorus_a2fbfe083dc510b4f6032729c71237125}{setCentreDelay}} (SampleType newDelayMs);}
\DoxyCodeLine{69 }
\DoxyCodeLine{73     \textcolor{keywordtype}{void} \mbox{\hyperlink{classdsp_1_1_chorus_a8ee876fc18a2b56de971015c22298d39}{setFeedback}} (SampleType newFeedback);}
\DoxyCodeLine{74 }
\DoxyCodeLine{78     \textcolor{keywordtype}{void} \mbox{\hyperlink{classdsp_1_1_chorus_aaa9f873728ddf15bf6cdfb4c3f851165}{setMix}} (SampleType newMix);}
\DoxyCodeLine{79 }
\DoxyCodeLine{80     \textcolor{comment}{//==============================================================================}}
\DoxyCodeLine{82 \textcolor{comment}{}    \textcolor{keywordtype}{void} \mbox{\hyperlink{classdsp_1_1_chorus_ae226aafb31406b9b3a73ba68ec18ce75}{prepare}} (\textcolor{keyword}{const} \mbox{\hyperlink{structdsp_1_1_process_spec}{ProcessSpec}}\& spec);}
\DoxyCodeLine{83 }
\DoxyCodeLine{85     \textcolor{keywordtype}{void} \mbox{\hyperlink{classdsp_1_1_chorus_aec1afc3999be46675224888c5ff419c2}{reset}}();}
\DoxyCodeLine{86 }
\DoxyCodeLine{87     \textcolor{comment}{//==============================================================================}}
\DoxyCodeLine{89 \textcolor{comment}{}    \textcolor{keyword}{template} <\textcolor{keyword}{typename} ProcessContext>}
\DoxyCodeLine{90     \textcolor{keywordtype}{void} \mbox{\hyperlink{classdsp_1_1_chorus_ad48a5db5e4a787411d8f619c2768f825}{process}} (\textcolor{keyword}{const} ProcessContext\& context) \textcolor{keyword}{noexcept}}
\DoxyCodeLine{91     \{}
\DoxyCodeLine{92         \textcolor{keyword}{const} \textcolor{keyword}{auto}\& inputBlock = context.getInputBlock();}
\DoxyCodeLine{93         \textcolor{keyword}{auto}\& outputBlock      = context.getOutputBlock();}
\DoxyCodeLine{94         \textcolor{keyword}{const} \textcolor{keyword}{auto} numChannels = outputBlock.getNumChannels();}
\DoxyCodeLine{95         \textcolor{keyword}{const} \textcolor{keyword}{auto} numSamples  = outputBlock.getNumSamples();}
\DoxyCodeLine{96 }
\DoxyCodeLine{97         \mbox{\hyperlink{group__juce__core-system_ga1f96ab6751237979b907a54f52a7296a}{jassert}} (inputBlock.getNumChannels() == numChannels);}
\DoxyCodeLine{98         \mbox{\hyperlink{group__juce__core-system_ga1f96ab6751237979b907a54f52a7296a}{jassert}} (inputBlock.getNumChannels() == lastOutput.size());}
\DoxyCodeLine{99         \mbox{\hyperlink{group__juce__core-system_ga1f96ab6751237979b907a54f52a7296a}{jassert}} (inputBlock.getNumSamples()  == numSamples);}
\DoxyCodeLine{100 }
\DoxyCodeLine{101         \textcolor{keywordflow}{if} (context.isBypassed)}
\DoxyCodeLine{102         \{}
\DoxyCodeLine{103             outputBlock.copyFrom (inputBlock);}
\DoxyCodeLine{104             \textcolor{keywordflow}{return};}
\DoxyCodeLine{105         \}}
\DoxyCodeLine{106 }
\DoxyCodeLine{107         \textcolor{keyword}{auto} delayValuesBlock = \mbox{\hyperlink{classdsp_1_1_audio_block}{AudioBlock<SampleType>}}(bufferDelayTimes).\mbox{\hyperlink{classdsp_1_1_audio_block_a299c2ac84fd87eef264aa0f0d39cc426}{getSubBlock}} (0, numSamples);}
\DoxyCodeLine{108         \textcolor{keyword}{auto} contextDelay = \mbox{\hyperlink{structdsp_1_1_process_context_replacing}{ProcessContextReplacing<SampleType>}} (delayValuesBlock);}
\DoxyCodeLine{109         delayValuesBlock.clear();}
\DoxyCodeLine{110 }
\DoxyCodeLine{111         osc.process (contextDelay);}
\DoxyCodeLine{112         delayValuesBlock.multiplyBy (oscVolume);}
\DoxyCodeLine{113 }
\DoxyCodeLine{114         \textcolor{keyword}{auto}* delaySamples = bufferDelayTimes.getWritePointer (0);}
\DoxyCodeLine{115 }
\DoxyCodeLine{116         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < numSamples; ++i)}
\DoxyCodeLine{117         \{}
\DoxyCodeLine{118             \textcolor{keyword}{auto} lfo = \mbox{\hyperlink{group__juce__core-maths_gadfd716f36f80987d66ebc2fce819c1fe}{jmax}} (\textcolor{keyword}{static\_cast<}SampleType\textcolor{keyword}{>} (1.0), maximumDelayModulation * delaySamples[i] + centreDelay);}
\DoxyCodeLine{119             delaySamples[i] = \textcolor{keyword}{static\_cast<}SampleType\textcolor{keyword}{>} (lfo * sampleRate / 1000.0);}
\DoxyCodeLine{120         \}}
\DoxyCodeLine{121 }
\DoxyCodeLine{122         dryWet.pushDrySamples (inputBlock);}
\DoxyCodeLine{123 }
\DoxyCodeLine{124         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} channel = 0; channel < numChannels; ++channel)}
\DoxyCodeLine{125         \{}
\DoxyCodeLine{126             \textcolor{keyword}{auto}* inputSamples  = inputBlock .getChannelPointer (channel);}
\DoxyCodeLine{127             \textcolor{keyword}{auto}* outputSamples = outputBlock.getChannelPointer (channel);}
\DoxyCodeLine{128 }
\DoxyCodeLine{129             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < numSamples; ++i)}
\DoxyCodeLine{130             \{}
\DoxyCodeLine{131                 \textcolor{keyword}{auto} \mbox{\hyperlink{namespacegl_ae94d0a99dc3426b5ac5fc7d881691a61}{input}} = inputSamples[i];}
\DoxyCodeLine{132                 \textcolor{keyword}{auto} \mbox{\hyperlink{namespacegl_a6feaa3453ce5f1535f7b2709b198b7b6}{output}} = \mbox{\hyperlink{namespacegl_ae94d0a99dc3426b5ac5fc7d881691a61}{input}} -\/ lastOutput[channel];}
\DoxyCodeLine{133 }
\DoxyCodeLine{134                 delay.pushSample ((\textcolor{keywordtype}{int}) channel, \mbox{\hyperlink{namespacegl_a6feaa3453ce5f1535f7b2709b198b7b6}{output}});}
\DoxyCodeLine{135                 delay.setDelay (delaySamples[i]);}
\DoxyCodeLine{136                 \mbox{\hyperlink{namespacegl_a6feaa3453ce5f1535f7b2709b198b7b6}{output}} = delay.popSample ((\textcolor{keywordtype}{int}) channel);}
\DoxyCodeLine{137 }
\DoxyCodeLine{138                 outputSamples[i] = \mbox{\hyperlink{namespacegl_a6feaa3453ce5f1535f7b2709b198b7b6}{output}};}
\DoxyCodeLine{139                 lastOutput[channel] = \mbox{\hyperlink{namespacegl_a6feaa3453ce5f1535f7b2709b198b7b6}{output}} * feedbackVolume[channel].getNextValue();}
\DoxyCodeLine{140             \}}
\DoxyCodeLine{141         \}}
\DoxyCodeLine{142 }
\DoxyCodeLine{143         dryWet.mixWetSamples (outputBlock);}
\DoxyCodeLine{144     \}}
\DoxyCodeLine{145 }
\DoxyCodeLine{146 \textcolor{keyword}{private}:}
\DoxyCodeLine{147     \textcolor{comment}{//==============================================================================}}
\DoxyCodeLine{148     \textcolor{keywordtype}{void} update();}
\DoxyCodeLine{149 }
\DoxyCodeLine{150     \textcolor{comment}{//==============================================================================}}
\DoxyCodeLine{151     \mbox{\hyperlink{classdsp_1_1_oscillator}{Oscillator<SampleType>}} osc;}
\DoxyCodeLine{152     \mbox{\hyperlink{classdsp_1_1_delay_line}{DelayLine<SampleType, DelayLineInterpolationTypes::Linear>}} delay;}
\DoxyCodeLine{153     \mbox{\hyperlink{class_smoothed_value}{SmoothedValue<SampleType, ValueSmoothingTypes::Linear>}} oscVolume;}
\DoxyCodeLine{154     std::vector<SmoothedValue<SampleType, ValueSmoothingTypes::Linear>> feedbackVolume \{ 2 \};}
\DoxyCodeLine{155     DryWetMixer<SampleType> dryWet;}
\DoxyCodeLine{156     std::vector<SampleType> lastOutput \{ 2 \};}
\DoxyCodeLine{157     \mbox{\hyperlink{class_audio_buffer}{AudioBuffer<SampleType>}} bufferDelayTimes;}
\DoxyCodeLine{158 }
\DoxyCodeLine{159     \textcolor{keywordtype}{double} sampleRate = 44100.0;}
\DoxyCodeLine{160     SampleType rate = 1.0, depth = 0.25, feedback = 0.0, mix = 0.5,}
\DoxyCodeLine{161                centreDelay = 7.0;}
\DoxyCodeLine{162 }
\DoxyCodeLine{163     \textcolor{keyword}{static} \textcolor{keyword}{constexpr} SampleType maxDepth               = 1.0,}
\DoxyCodeLine{164                                 maxCentreDelayMs       = 100.0,}
\DoxyCodeLine{165                                 oscVolumeMultiplier    = 0.5,}
\DoxyCodeLine{166                                 maximumDelayModulation = 20.0;}
\DoxyCodeLine{167 \};}
\DoxyCodeLine{168 }
\DoxyCodeLine{169 \} \textcolor{comment}{// namespace dsp}}
\DoxyCodeLine{170  \textcolor{comment}{// namespace juce}}
\DoxyCodeLine{171 }

\end{DoxyCode}
