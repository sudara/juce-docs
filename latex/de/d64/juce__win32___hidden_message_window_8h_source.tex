\hypertarget{juce__win32___hidden_message_window_8h_source}{}\doxysection{juce\+\_\+win32\+\_\+\+Hidden\+Message\+Window.\+h}
\label{juce__win32___hidden_message_window_8h_source}\index{build/juce\_events/native/juce\_win32\_HiddenMessageWindow.h@{build/juce\_events/native/juce\_win32\_HiddenMessageWindow.h}}
\mbox{\hyperlink{juce__win32___hidden_message_window_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{/*}}
\DoxyCodeLine{2 \textcolor{comment}{  ==============================================================================}}
\DoxyCodeLine{3 \textcolor{comment}{}}
\DoxyCodeLine{4 \textcolor{comment}{   This file is part of the JUCE library.}}
\DoxyCodeLine{5 \textcolor{comment}{   Copyright (c) 2020 -\/ Raw Material Software Limited}}
\DoxyCodeLine{6 \textcolor{comment}{}}
\DoxyCodeLine{7 \textcolor{comment}{   JUCE is an open source library subject to commercial or open-\/source}}
\DoxyCodeLine{8 \textcolor{comment}{   licensing.}}
\DoxyCodeLine{9 \textcolor{comment}{}}
\DoxyCodeLine{10 \textcolor{comment}{   The code included in this file is provided under the terms of the ISC license}}
\DoxyCodeLine{11 \textcolor{comment}{   http://www.isc.org/downloads/software-\/support-\/policy/isc-\/license. Permission}}
\DoxyCodeLine{12 \textcolor{comment}{   To use, copy, modify, and/or distribute this software for any purpose with or}}
\DoxyCodeLine{13 \textcolor{comment}{   without fee is hereby granted provided that the above copyright notice and}}
\DoxyCodeLine{14 \textcolor{comment}{   this permission notice appear in all copies.}}
\DoxyCodeLine{15 \textcolor{comment}{}}
\DoxyCodeLine{16 \textcolor{comment}{   JUCE IS PROVIDED "{}AS IS"{} WITHOUT ANY WARRANTY, AND ALL WARRANTIES, WHETHER}}
\DoxyCodeLine{17 \textcolor{comment}{   EXPRESSED OR IMPLIED, INCLUDING MERCHANTABILITY AND FITNESS FOR PURPOSE, ARE}}
\DoxyCodeLine{18 \textcolor{comment}{   DISCLAIMED.}}
\DoxyCodeLine{19 \textcolor{comment}{}}
\DoxyCodeLine{20 \textcolor{comment}{  ==============================================================================}}
\DoxyCodeLine{21 \textcolor{comment}{*/}}
\DoxyCodeLine{22 }
\DoxyCodeLine{23 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespacejuce}{juce}}}
\DoxyCodeLine{24 \{}
\DoxyCodeLine{25 }
\DoxyCodeLine{26 \textcolor{comment}{//==============================================================================}}
\DoxyCodeLine{27 \textcolor{keyword}{class }\mbox{\hyperlink{classjuce_1_1_hidden_message_window}{HiddenMessageWindow}}}
\DoxyCodeLine{28 \{}
\DoxyCodeLine{29 \textcolor{keyword}{public}:}
\DoxyCodeLine{30     \mbox{\hyperlink{classjuce_1_1_hidden_message_window_a46109e515cee945ffbab4082a6578513}{HiddenMessageWindow}} (\textcolor{keyword}{const} TCHAR* \textcolor{keyword}{const} messageWindowName, WNDPROC wndProc)}
\DoxyCodeLine{31     \{}
\DoxyCodeLine{32         \mbox{\hyperlink{class_string}{String}} className (\textcolor{stringliteral}{"{}JUCE\_"{}});}
\DoxyCodeLine{33         className << \mbox{\hyperlink{class_string_aab501daf0fa0bbba1479218447d1f936}{String::toHexString}} (\mbox{\hyperlink{class_time_adcd3d5c5f46454a0cae726b1c8ba0426}{Time::getHighResolutionTicks}}());}
\DoxyCodeLine{34 }
\DoxyCodeLine{35         HMODULE moduleHandle = (HMODULE) Process::getCurrentModuleInstanceHandle();}
\DoxyCodeLine{36 }
\DoxyCodeLine{37         WNDCLASSEX wc = \{\};}
\DoxyCodeLine{38         wc.cbSize         = \textcolor{keyword}{sizeof} (wc);}
\DoxyCodeLine{39         wc.lpfnWndProc    = wndProc;}
\DoxyCodeLine{40         wc.cbWndExtra     = 4;}
\DoxyCodeLine{41         wc.hInstance      = moduleHandle;}
\DoxyCodeLine{42         wc.lpszClassName  = className.\mbox{\hyperlink{class_string_a1861bc68125754e7a0b30f1a3e91937f}{toWideCharPointer}}();}
\DoxyCodeLine{43 }
\DoxyCodeLine{44         atom = RegisterClassEx (\&wc);}
\DoxyCodeLine{45         \mbox{\hyperlink{group__juce__core-system_ga1f96ab6751237979b907a54f52a7296a}{jassert}} (atom != 0);}
\DoxyCodeLine{46 }
\DoxyCodeLine{47         hwnd = CreateWindow (getClassNameFromAtom(), messageWindowName,}
\DoxyCodeLine{48                              0, 0, 0, 0, 0,}
\DoxyCodeLine{49                              \textcolor{keyword}{nullptr}, \textcolor{keyword}{nullptr}, moduleHandle, \textcolor{keyword}{nullptr});}
\DoxyCodeLine{50         \mbox{\hyperlink{group__juce__core-system_ga1f96ab6751237979b907a54f52a7296a}{jassert}} (hwnd != \textcolor{keyword}{nullptr});}
\DoxyCodeLine{51     \}}
\DoxyCodeLine{52 }
\DoxyCodeLine{53     \mbox{\hyperlink{classjuce_1_1_hidden_message_window_a1f1e15fb910207caf7b0d77bd6b9842f}{\string~HiddenMessageWindow}}()}
\DoxyCodeLine{54     \{}
\DoxyCodeLine{55         DestroyWindow (hwnd);}
\DoxyCodeLine{56         UnregisterClass (getClassNameFromAtom(), \textcolor{keyword}{nullptr});}
\DoxyCodeLine{57     \}}
\DoxyCodeLine{58 }
\DoxyCodeLine{59     \textcolor{keyword}{inline} \mbox{\hyperlink{namespacejuce_a1b3c3cf7cdbe394e401d5db42e094ac5}{HWND}} \mbox{\hyperlink{classjuce_1_1_hidden_message_window_a5aae3e61c356becbe6c8ae4019fcca96}{getHWND}}() \mbox{\hyperlink{zconf_8h_a2c212835823e3c54a8ab6d95c652660e}{const}} noexcept     \{ \textcolor{keywordflow}{return} hwnd; \}}
\DoxyCodeLine{60 }
\DoxyCodeLine{61 \textcolor{keyword}{private}:}
\DoxyCodeLine{62     ATOM atom;}
\DoxyCodeLine{63     \mbox{\hyperlink{namespacejuce_a1b3c3cf7cdbe394e401d5db42e094ac5}{HWND}} hwnd;}
\DoxyCodeLine{64 }
\DoxyCodeLine{65     LPCTSTR getClassNameFromAtom() noexcept  \{ \textcolor{keywordflow}{return} (LPCTSTR) (\mbox{\hyperlink{group__juce__core-maths_gafb24e6184dde2b29ecfb687686e8fec2}{pointer\_sized\_uint}}) atom; \}}
\DoxyCodeLine{66 \};}
\DoxyCodeLine{67 }
\DoxyCodeLine{68 \textcolor{comment}{//==============================================================================}}
\DoxyCodeLine{69 \textcolor{keyword}{class }\mbox{\hyperlink{classjuce_1_1_juce_window_identifier}{JuceWindowIdentifier}}}
\DoxyCodeLine{70 \{}
\DoxyCodeLine{71 \textcolor{keyword}{public}:}
\DoxyCodeLine{72     \textcolor{keyword}{static} \textcolor{keywordtype}{bool} \mbox{\hyperlink{classjuce_1_1_juce_window_identifier_a787aaa19d69038401f54b247da153e68}{isJUCEWindow}} (\mbox{\hyperlink{namespacejuce_a1b3c3cf7cdbe394e401d5db42e094ac5}{HWND}} hwnd) \textcolor{keyword}{noexcept}}
\DoxyCodeLine{73     \{}
\DoxyCodeLine{74         \textcolor{keywordflow}{return} GetWindowLongPtr (hwnd, GWLP\_USERDATA) == getImprobableWindowNumber();}
\DoxyCodeLine{75     \}}
\DoxyCodeLine{76 }
\DoxyCodeLine{77     \textcolor{keyword}{static} \textcolor{keywordtype}{void} \mbox{\hyperlink{classjuce_1_1_juce_window_identifier_aab512a67d2441fc6c1e8dd7bbdeedc7a}{setAsJUCEWindow}} (\mbox{\hyperlink{namespacejuce_a1b3c3cf7cdbe394e401d5db42e094ac5}{HWND}} hwnd, \textcolor{keywordtype}{bool} isJuceWindow) \textcolor{keyword}{noexcept}}
\DoxyCodeLine{78     \{}
\DoxyCodeLine{79         SetWindowLongPtr (hwnd, GWLP\_USERDATA, isJuceWindow ? getImprobableWindowNumber() : 0);}
\DoxyCodeLine{80     \}}
\DoxyCodeLine{81 }
\DoxyCodeLine{82 \textcolor{keyword}{private}:}
\DoxyCodeLine{83     \textcolor{keyword}{static} LONG\_PTR getImprobableWindowNumber() noexcept}
\DoxyCodeLine{84     \{}
\DoxyCodeLine{85         \textcolor{keyword}{static} \textcolor{keyword}{auto} number = (LONG\_PTR) \mbox{\hyperlink{class_random}{Random}}().\mbox{\hyperlink{class_random_aa78fa923adb76a168c5c67d072cfcef3}{nextInt64}}();}
\DoxyCodeLine{86         \textcolor{keywordflow}{return} number;}
\DoxyCodeLine{87     \}}
\DoxyCodeLine{88 \};}
\DoxyCodeLine{89 }
\DoxyCodeLine{90 \textcolor{comment}{//==============================================================================}}
\DoxyCodeLine{91 \textcolor{keyword}{class }\mbox{\hyperlink{classjuce_1_1_device_change_detector}{DeviceChangeDetector}}  : \textcolor{keyword}{private} \mbox{\hyperlink{class_timer}{Timer}}}
\DoxyCodeLine{92 \{}
\DoxyCodeLine{93 \textcolor{keyword}{public}:}
\DoxyCodeLine{94     \mbox{\hyperlink{classjuce_1_1_device_change_detector_aaae78431ec0d1121bf53c1db40168ce5}{DeviceChangeDetector}} (\textcolor{keyword}{const} \textcolor{keywordtype}{wchar\_t}* \textcolor{keyword}{const} \mbox{\hyperlink{namespacegl_a23f4d6c2fb3e8fdfb824894be7a695c2}{name}})}
\DoxyCodeLine{95         : messageWindow (\mbox{\hyperlink{namespacegl_a23f4d6c2fb3e8fdfb824894be7a695c2}{name}}, (WNDPROC) deviceChangeEventCallback)}
\DoxyCodeLine{96     \{}
\DoxyCodeLine{97         SetWindowLongPtr (messageWindow.\mbox{\hyperlink{classjuce_1_1_hidden_message_window_a5aae3e61c356becbe6c8ae4019fcca96}{getHWND}}(), GWLP\_USERDATA, (LONG\_PTR) \textcolor{keyword}{this});}
\DoxyCodeLine{98     \}}
\DoxyCodeLine{99 }
\DoxyCodeLine{100     \textcolor{keyword}{virtual} \textcolor{keywordtype}{void} \mbox{\hyperlink{classjuce_1_1_device_change_detector_a7c887b87262b4633b63bb5ec71bfdb0d}{systemDeviceChanged}}() = 0;}
\DoxyCodeLine{101 }
\DoxyCodeLine{102     \textcolor{keywordtype}{void} \mbox{\hyperlink{classjuce_1_1_device_change_detector_a9b503e20df9c5de00d3abf4451a7a4af}{triggerAsyncDeviceChangeCallback}}()}
\DoxyCodeLine{103     \{}
\DoxyCodeLine{104         \textcolor{comment}{// We'll pause before sending a message, because on device removal, the OS hasn't always updated}}
\DoxyCodeLine{105         \textcolor{comment}{// its device lists correctly at this point. This also helps avoid repeated callbacks.}}
\DoxyCodeLine{106         \mbox{\hyperlink{class_timer_a3b1a51ac348c56a55fcef4570214f057}{startTimer}} (500);}
\DoxyCodeLine{107     \}}
\DoxyCodeLine{108 }
\DoxyCodeLine{109 \textcolor{keyword}{private}:}
\DoxyCodeLine{110     \mbox{\hyperlink{classjuce_1_1_hidden_message_window}{HiddenMessageWindow}} messageWindow;}
\DoxyCodeLine{111 }
\DoxyCodeLine{112     \textcolor{keyword}{static} LRESULT CALLBACK deviceChangeEventCallback (\mbox{\hyperlink{namespacejuce_a1b3c3cf7cdbe394e401d5db42e094ac5}{HWND}} \mbox{\hyperlink{namespacegl_ae0306c9e6aca74fac45e19b5f64f7ba7}{h}}, \textcolor{keyword}{const} UINT \mbox{\hyperlink{namespacegl_a1243e1c99f08a099c7a70cc1a258034a}{message}},}
\DoxyCodeLine{113                                                        \textcolor{keyword}{const} WPARAM wParam, \textcolor{keyword}{const} LPARAM lParam)}
\DoxyCodeLine{114     \{}
\DoxyCodeLine{115         \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespacegl_a1243e1c99f08a099c7a70cc1a258034a}{message}} == WM\_DEVICECHANGE}
\DoxyCodeLine{116              \&\& (wParam == 0x8000 \textcolor{comment}{/*DBT\_DEVICEARRIVAL*/}}
\DoxyCodeLine{117                   || wParam == 0x8004 \textcolor{comment}{/*DBT\_DEVICEREMOVECOMPLETE*/}}
\DoxyCodeLine{118                   || wParam == 0x0007 \textcolor{comment}{/*DBT\_DEVNODES\_CHANGED*/}))}
\DoxyCodeLine{119         \{}
\DoxyCodeLine{120             ((\mbox{\hyperlink{classjuce_1_1_device_change_detector}{DeviceChangeDetector}}*) GetWindowLongPtr (\mbox{\hyperlink{namespacegl_ae0306c9e6aca74fac45e19b5f64f7ba7}{h}}, GWLP\_USERDATA))}
\DoxyCodeLine{121                 -\/>\mbox{\hyperlink{classjuce_1_1_device_change_detector_a9b503e20df9c5de00d3abf4451a7a4af}{triggerAsyncDeviceChangeCallback}}();}
\DoxyCodeLine{122         \}}
\DoxyCodeLine{123 }
\DoxyCodeLine{124         \textcolor{keywordflow}{return} DefWindowProc (\mbox{\hyperlink{namespacegl_ae0306c9e6aca74fac45e19b5f64f7ba7}{h}}, \mbox{\hyperlink{namespacegl_a1243e1c99f08a099c7a70cc1a258034a}{message}}, wParam, lParam);}
\DoxyCodeLine{125     \}}
\DoxyCodeLine{126 }
\DoxyCodeLine{127     \textcolor{keywordtype}{void} timerCallback()\textcolor{keyword}{ override}}
\DoxyCodeLine{128 \textcolor{keyword}{    }\{}
\DoxyCodeLine{129         \mbox{\hyperlink{class_timer_ab918b8c1f80bf1de92dd1a5878f498bd}{stopTimer}}();}
\DoxyCodeLine{130         \mbox{\hyperlink{classjuce_1_1_device_change_detector_a7c887b87262b4633b63bb5ec71bfdb0d}{systemDeviceChanged}}();}
\DoxyCodeLine{131     \}}
\DoxyCodeLine{132 \};}
\DoxyCodeLine{133 }
\DoxyCodeLine{134 \} \textcolor{comment}{// namespace juce}}

\end{DoxyCode}
