\hypertarget{_a_u_input_format_converter_8h_source}{}\doxysection{AUInput\+Format\+Converter.\+h}
\label{_a_u_input_format_converter_8h_source}\index{build/juce\_audio\_plugin\_client/AU/CoreAudioUtilityClasses/AUInputFormatConverter.h@{build/juce\_audio\_plugin\_client/AU/CoreAudioUtilityClasses/AUInputFormatConverter.h}}
\mbox{\hyperlink{_a_u_input_format_converter_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{/*}}
\DoxyCodeLine{2 \textcolor{comment}{     File: AUInputFormatConverter.h}}
\DoxyCodeLine{3 \textcolor{comment}{ Abstract: Part of CoreAudio Utility Classes}}
\DoxyCodeLine{4 \textcolor{comment}{  Version: 1.1}}
\DoxyCodeLine{5 \textcolor{comment}{}}
\DoxyCodeLine{6 \textcolor{comment}{ Disclaimer: IMPORTANT:  This Apple software is supplied to you by Apple}}
\DoxyCodeLine{7 \textcolor{comment}{ Inc. ("{}Apple"{}) in consideration of your agreement to the following}}
\DoxyCodeLine{8 \textcolor{comment}{ terms, and your use, installation, modification or redistribution of}}
\DoxyCodeLine{9 \textcolor{comment}{ this Apple software constitutes acceptance of these terms.  If you do}}
\DoxyCodeLine{10 \textcolor{comment}{ not agree with these terms, please do not use, install, modify or}}
\DoxyCodeLine{11 \textcolor{comment}{ redistribute this Apple software.}}
\DoxyCodeLine{12 \textcolor{comment}{}}
\DoxyCodeLine{13 \textcolor{comment}{ In consideration of your agreement to abide by the following terms, and}}
\DoxyCodeLine{14 \textcolor{comment}{ subject to these terms, Apple grants you a personal, non-\/exclusive}}
\DoxyCodeLine{15 \textcolor{comment}{ license, under Apple's copyrights in this original Apple software (the}}
\DoxyCodeLine{16 \textcolor{comment}{ "{}Apple Software"{}), to use, reproduce, modify and redistribute the Apple}}
\DoxyCodeLine{17 \textcolor{comment}{ Software, with or without modifications, in source and/or binary forms;}}
\DoxyCodeLine{18 \textcolor{comment}{ provided that if you redistribute the Apple Software in its entirety and}}
\DoxyCodeLine{19 \textcolor{comment}{ without modifications, you must retain this notice and the following}}
\DoxyCodeLine{20 \textcolor{comment}{ text and disclaimers in all such redistributions of the Apple Software.}}
\DoxyCodeLine{21 \textcolor{comment}{ Neither the name, trademarks, service marks or logos of Apple Inc. may}}
\DoxyCodeLine{22 \textcolor{comment}{ be used to endorse or promote products derived from the Apple Software}}
\DoxyCodeLine{23 \textcolor{comment}{ without specific prior written permission from Apple.  Except as}}
\DoxyCodeLine{24 \textcolor{comment}{ expressly stated in this notice, no other rights or licenses, express or}}
\DoxyCodeLine{25 \textcolor{comment}{ implied, are granted by Apple herein, including but not limited to any}}
\DoxyCodeLine{26 \textcolor{comment}{ patent rights that may be infringed by your derivative works or by other}}
\DoxyCodeLine{27 \textcolor{comment}{ works in which the Apple Software may be incorporated.}}
\DoxyCodeLine{28 \textcolor{comment}{}}
\DoxyCodeLine{29 \textcolor{comment}{ The Apple Software is provided by Apple on an "{}AS IS"{} basis.  APPLE}}
\DoxyCodeLine{30 \textcolor{comment}{ MAKES NO WARRANTIES, EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION}}
\DoxyCodeLine{31 \textcolor{comment}{ THE IMPLIED WARRANTIES OF NON-\/INFRINGEMENT, MERCHANTABILITY AND FITNESS}}
\DoxyCodeLine{32 \textcolor{comment}{ FOR A PARTICULAR PURPOSE, REGARDING THE APPLE SOFTWARE OR ITS USE AND}}
\DoxyCodeLine{33 \textcolor{comment}{ OPERATION ALONE OR IN COMBINATION WITH YOUR PRODUCTS.}}
\DoxyCodeLine{34 \textcolor{comment}{}}
\DoxyCodeLine{35 \textcolor{comment}{ IN NO EVENT SHALL APPLE BE LIABLE FOR ANY SPECIAL, INDIRECT, INCIDENTAL}}
\DoxyCodeLine{36 \textcolor{comment}{ OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF}}
\DoxyCodeLine{37 \textcolor{comment}{ SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS}}
\DoxyCodeLine{38 \textcolor{comment}{ INTERRUPTION) ARISING IN ANY WAY OUT OF THE USE, REPRODUCTION,}}
\DoxyCodeLine{39 \textcolor{comment}{ MODIFICATION AND/OR DISTRIBUTION OF THE APPLE SOFTWARE, HOWEVER CAUSED}}
\DoxyCodeLine{40 \textcolor{comment}{ AND WHETHER UNDER THEORY OF CONTRACT, TORT (INCLUDING NEGLIGENCE),}}
\DoxyCodeLine{41 \textcolor{comment}{ STRICT LIABILITY OR OTHERWISE, EVEN IF APPLE HAS BEEN ADVISED OF THE}}
\DoxyCodeLine{42 \textcolor{comment}{ POSSIBILITY OF SUCH DAMAGE.}}
\DoxyCodeLine{43 \textcolor{comment}{}}
\DoxyCodeLine{44 \textcolor{comment}{ Copyright (C) 2014 Apple Inc. All Rights Reserved.}}
\DoxyCodeLine{45 \textcolor{comment}{}}
\DoxyCodeLine{46 \textcolor{comment}{*/}}
\DoxyCodeLine{47 \textcolor{preprocessor}{\#ifndef \_\_AUInputFormatConverter\_h\_\_}}
\DoxyCodeLine{48 \textcolor{preprocessor}{\#define \_\_AUInputFormatConverter\_h\_\_}}
\DoxyCodeLine{49 }
\DoxyCodeLine{50 \textcolor{preprocessor}{\#include "{}FormatConverterClient.h"{}}}
\DoxyCodeLine{51 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_a_u_timestamp_generator_8h}{AUTimestampGenerator.h}}"{}}}
\DoxyCodeLine{52 }
\DoxyCodeLine{53 \textcolor{comment}{// \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_}}
\DoxyCodeLine{54 \textcolor{comment}{// AUInputFormatConverter}}
\DoxyCodeLine{55 \textcolor{comment}{//}}
\DoxyCodeLine{56 \textcolor{comment}{// Subclass of FormatConverterClient that applies a format conversion}}
\DoxyCodeLine{57 \textcolor{comment}{// to an input of an AudioUnit.}}
\DoxyCodeLine{59 \textcolor{comment}{}\textcolor{keyword}{class }\mbox{\hyperlink{class_a_u_input_format_converter}{AUInputFormatConverter}} : \textcolor{keyword}{public} FormatConverterClient \{}
\DoxyCodeLine{60 \textcolor{keyword}{public}:}
\DoxyCodeLine{62     \mbox{\hyperlink{class_a_u_input_format_converter_a06a36b8b9deb007ca4c74cf5c79eb644}{AUInputFormatConverter}}(\mbox{\hyperlink{class_a_u_base}{AUBase}} *hostAU, \textcolor{keywordtype}{int} inputBus) :}
\DoxyCodeLine{63         \mbox{\hyperlink{class_a_u_input_format_converter_aacf232c5b034b30a734a31da7beff597}{mHost}}(hostAU),}
\DoxyCodeLine{64         \mbox{\hyperlink{class_a_u_input_format_converter_afeb5edb6bf6b385735f5fdb9cc16312d}{mHostBus}}(inputBus),}
\DoxyCodeLine{65         \mbox{\hyperlink{class_a_u_input_format_converter_a73952a02134fd9390ecf125a7afe4f6d}{mPreviousSilentFrames}}(0x1000)}
\DoxyCodeLine{66     \{}
\DoxyCodeLine{67 \textcolor{preprocessor}{\#if DEBUG}}
\DoxyCodeLine{68         \mbox{\hyperlink{class_a_u_input_format_converter_a12035e97e74bf83fb9208d8eae795320}{mTimestampGenerator}}.mVerbosity = 0;}
\DoxyCodeLine{69         strcpy(\mbox{\hyperlink{class_a_u_input_format_converter_a12035e97e74bf83fb9208d8eae795320}{mTimestampGenerator}}.mDebugName, \textcolor{stringliteral}{"{}AUConverter"{}});}
\DoxyCodeLine{70 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{71     \}}
\DoxyCodeLine{72 }
\DoxyCodeLine{73     \textcolor{comment}{// need to subsequently call Initialize, with the desired formats}}
\DoxyCodeLine{74 }
\DoxyCodeLine{76     \mbox{\hyperlink{class_a_u_input_format_converter_ad3b83cafa3e68613eaaaaea8fd8d3d6a}{\string~AUInputFormatConverter}}()}
\DoxyCodeLine{77     \{}
\DoxyCodeLine{78     \}}
\DoxyCodeLine{79 }
\DoxyCodeLine{80     \textcolor{keyword}{virtual} OSStatus \mbox{\hyperlink{class_a_u_input_format_converter_aa8615953bf13d74dd97de9c9cd592f34}{Initialize}}(\textcolor{keyword}{const} AudioStreamBasicDescription \&\mbox{\hyperlink{namespacegl_a53ba192f09eb5ce0813c301689e803f8}{src}}, \textcolor{keyword}{const} AudioStreamBasicDescription \&dest)}
\DoxyCodeLine{81     \{}
\DoxyCodeLine{82         OSStatus err = FormatConverterClient::Initialize(\mbox{\hyperlink{namespacegl_a53ba192f09eb5ce0813c301689e803f8}{src}}, dest);}
\DoxyCodeLine{83         \textcolor{keywordflow}{if} (err) \textcolor{keywordflow}{return} err;}
\DoxyCodeLine{84         \mbox{\hyperlink{class_a_u_input_format_converter_aed492212b6ed455980234e9f920e62d9}{mIsPCMToPCM}} = (\mbox{\hyperlink{namespacegl_a53ba192f09eb5ce0813c301689e803f8}{src}}.mFormatID == kAudioFormatLinearPCM) \&\& (dest.mFormatID == kAudioFormatLinearPCM);}
\DoxyCodeLine{85         \mbox{\hyperlink{class_a_u_input_format_converter_a9bcee974a8193fa41f2204d3b89d4fde}{mHasSRC}} = (\mbox{\hyperlink{_c_a_math_8h_a3015bfddf2da2a1e6c0ddc1a76e6128d}{fnonzero}}(\mbox{\hyperlink{namespacegl_a53ba192f09eb5ce0813c301689e803f8}{src}}.mSampleRate) \&\& \mbox{\hyperlink{_c_a_math_8h_a3015bfddf2da2a1e6c0ddc1a76e6128d}{fnonzero}}(dest.mSampleRate) \&\& \mbox{\hyperlink{_c_a_math_8h_ac960f355bfdf3aaba7a4bfe2d8d7b54b}{fnotequal}}(\mbox{\hyperlink{namespacegl_a53ba192f09eb5ce0813c301689e803f8}{src}}.mSampleRate, dest.mSampleRate));}
\DoxyCodeLine{86         \textcolor{keywordflow}{return} ca\_noErr;}
\DoxyCodeLine{87     \}}
\DoxyCodeLine{88 }
\DoxyCodeLine{89     \textcolor{keyword}{virtual} OSStatus    \mbox{\hyperlink{class_a_u_input_format_converter_a835aae2063d2ad3b9fe3886a22ffa400}{Reset}}()}
\DoxyCodeLine{90     \{}
\DoxyCodeLine{91         \mbox{\hyperlink{class_a_u_input_format_converter_a73952a02134fd9390ecf125a7afe4f6d}{mPreviousSilentFrames}} = 0x1000;}
\DoxyCodeLine{92         \mbox{\hyperlink{class_a_u_input_format_converter_a12035e97e74bf83fb9208d8eae795320}{mTimestampGenerator}}.\mbox{\hyperlink{class_a_u_timestamp_generator_afe91729dce0a7e89e5ae3021f12aa9b0}{Reset}}();}
\DoxyCodeLine{93         \textcolor{keywordflow}{return} FormatConverterClient::Reset();}
\DoxyCodeLine{94     \}}
\DoxyCodeLine{95 }
\DoxyCodeLine{96     \textcolor{keywordtype}{void}    \mbox{\hyperlink{class_a_u_input_format_converter_a389f4bd4c5800624fa55766d7eee1523}{SetStartInputTimeAtZero}}(\textcolor{keywordtype}{bool} \mbox{\hyperlink{jpegint_8h_af320905358fa78701e4cc60b6135601f}{b}})}
\DoxyCodeLine{97     \{}
\DoxyCodeLine{98         \mbox{\hyperlink{class_a_u_input_format_converter_a12035e97e74bf83fb9208d8eae795320}{mTimestampGenerator}}.\mbox{\hyperlink{class_a_u_timestamp_generator_acfd8f5c4fc72b2d774c7c5e68bdf2ca7}{SetStartInputAtZero}}(\mbox{\hyperlink{jpegint_8h_af320905358fa78701e4cc60b6135601f}{b}});}
\DoxyCodeLine{99     \}}
\DoxyCodeLine{100 }
\DoxyCodeLine{102     OSStatus    \mbox{\hyperlink{class_a_u_input_format_converter_a1338b4ba3e16d15f6a1652a419586909}{AUFillComplexBuffer}}(\textcolor{keyword}{const} AudioTimeStamp \&               inTimeStamp,}
\DoxyCodeLine{103                                     UInt32 \&                            ioOutputDataPacketSize,}
\DoxyCodeLine{104                                     AudioBufferList \&                   outOutputData,}
\DoxyCodeLine{105                                     AudioStreamPacketDescription*       outPacketDescription,}
\DoxyCodeLine{106                                     \textcolor{keywordtype}{bool}\&                               outSilence)}
\DoxyCodeLine{107     \{}
\DoxyCodeLine{108         \mbox{\hyperlink{class_a_u_input_format_converter_a12035e97e74bf83fb9208d8eae795320}{mTimestampGenerator}}.\mbox{\hyperlink{class_a_u_timestamp_generator_a17fdf2205429f7d9d0dd281090593920}{AddOutputTime}}(inTimeStamp, ioOutputDataPacketSize, mOutputFormat.mSampleRate);}
\DoxyCodeLine{109         \mbox{\hyperlink{class_a_u_input_format_converter_a515e1249a1167bbb0b44b674946c05bc}{mSilentOutput}} = \textcolor{keyword}{true};}
\DoxyCodeLine{110         OSStatus err = FillComplexBuffer(ioOutputDataPacketSize, outOutputData, outPacketDescription);}
\DoxyCodeLine{111         \textcolor{keywordflow}{if} (\mbox{\hyperlink{class_a_u_input_format_converter_a515e1249a1167bbb0b44b674946c05bc}{mSilentOutput}}) \{}
\DoxyCodeLine{112             \textcolor{keywordflow}{if} (!\mbox{\hyperlink{class_a_u_input_format_converter_aed492212b6ed455980234e9f920e62d9}{mIsPCMToPCM}} || (\mbox{\hyperlink{class_a_u_input_format_converter_a9bcee974a8193fa41f2204d3b89d4fde}{mHasSRC}} \&\& \mbox{\hyperlink{class_a_u_input_format_converter_a73952a02134fd9390ecf125a7afe4f6d}{mPreviousSilentFrames}} < 32))}
\DoxyCodeLine{113                 \mbox{\hyperlink{class_a_u_input_format_converter_a515e1249a1167bbb0b44b674946c05bc}{mSilentOutput}} = \textcolor{keyword}{false};}
\DoxyCodeLine{114             \mbox{\hyperlink{class_a_u_input_format_converter_a73952a02134fd9390ecf125a7afe4f6d}{mPreviousSilentFrames}} += ioOutputDataPacketSize;}
\DoxyCodeLine{115         \} \textcolor{keywordflow}{else}}
\DoxyCodeLine{116             \mbox{\hyperlink{class_a_u_input_format_converter_a73952a02134fd9390ecf125a7afe4f6d}{mPreviousSilentFrames}} = 0;}
\DoxyCodeLine{117         outSilence = \mbox{\hyperlink{class_a_u_input_format_converter_a515e1249a1167bbb0b44b674946c05bc}{mSilentOutput}};}
\DoxyCodeLine{118         \textcolor{keywordflow}{return} err;}
\DoxyCodeLine{119     \}}
\DoxyCodeLine{120 }
\DoxyCodeLine{122     \textcolor{keyword}{virtual} OSStatus    \mbox{\hyperlink{class_a_u_input_format_converter_a7b816b72a842c41087fba55a99b97d53}{FormatConverterInputProc}}(}
\DoxyCodeLine{123                                 UInt32 \&                        ioNumberDataPackets,}
\DoxyCodeLine{124                                 AudioBufferList \&               ioData,}
\DoxyCodeLine{125                                 AudioStreamPacketDescription**  outDataPacketDescription)}
\DoxyCodeLine{126     \{}
\DoxyCodeLine{127         OSStatus err = ca\_noErr;}
\DoxyCodeLine{128 }
\DoxyCodeLine{129         AudioUnitRenderActionFlags actionFlags = 0;}
\DoxyCodeLine{130         \mbox{\hyperlink{class_a_u_input_element}{AUInputElement}} *\mbox{\hyperlink{namespacegl_ae94d0a99dc3426b5ac5fc7d881691a61}{input}} = \mbox{\hyperlink{class_a_u_input_format_converter_aacf232c5b034b30a734a31da7beff597}{mHost}}-\/>\mbox{\hyperlink{class_a_u_base_a41b307509db5db6cc9eceeb5cfd036d9}{GetInput}}(\mbox{\hyperlink{class_a_u_input_format_converter_afeb5edb6bf6b385735f5fdb9cc16312d}{mHostBus}});}
\DoxyCodeLine{131         *ioNumberDataPackets = \mbox{\hyperlink{os_8h_abb702d8b501669a23aa0ab3b281b9384}{std::min}}(*ioNumberDataPackets, This-\/>mHost-\/>GetMaxFramesPerSlice());}
\DoxyCodeLine{132         \textcolor{keyword}{const} AudioTimeStamp \&inputTime = \mbox{\hyperlink{class_a_u_input_format_converter_a12035e97e74bf83fb9208d8eae795320}{mTimestampGenerator}}.\mbox{\hyperlink{class_a_u_timestamp_generator_a5cfaf84198166adce0b9b09e4ec258e9}{GenerateInputTime}}(ioNumberDataPackets, mInputFormat.mSampleRate);}
\DoxyCodeLine{133         err = \mbox{\hyperlink{namespacegl_ae94d0a99dc3426b5ac5fc7d881691a61}{input}}-\/>PullInput(actionFlags, inputTime, \mbox{\hyperlink{class_a_u_input_format_converter_afeb5edb6bf6b385735f5fdb9cc16312d}{mHostBus}}, ioNumberDataPackets);}
\DoxyCodeLine{134         \textcolor{keywordflow}{if} (!err) \{}
\DoxyCodeLine{135             \mbox{\hyperlink{namespacegl_ae94d0a99dc3426b5ac5fc7d881691a61}{input}}-\/>CopyBufferListTo(ioData);}
\DoxyCodeLine{136             \textcolor{keywordflow}{if} (!(actionFlags \& kAudioUnitRenderAction\_OutputIsSilence))}
\DoxyCodeLine{137                 \mbox{\hyperlink{class_a_u_input_format_converter_a515e1249a1167bbb0b44b674946c05bc}{mSilentOutput}} = \textcolor{keyword}{false};}
\DoxyCodeLine{138         \}}
\DoxyCodeLine{139         \textcolor{keywordflow}{return} err;}
\DoxyCodeLine{140     \}}
\DoxyCodeLine{141 }
\DoxyCodeLine{142 \textcolor{keyword}{protected}:}
\DoxyCodeLine{144     \mbox{\hyperlink{class_a_u_base}{AUBase}} *              \mbox{\hyperlink{class_a_u_input_format_converter_aacf232c5b034b30a734a31da7beff597}{mHost}};}
\DoxyCodeLine{146     \textcolor{keywordtype}{int}                     \mbox{\hyperlink{class_a_u_input_format_converter_afeb5edb6bf6b385735f5fdb9cc16312d}{mHostBus}};}
\DoxyCodeLine{147 }
\DoxyCodeLine{148     \mbox{\hyperlink{class_a_u_timestamp_generator}{AUTimestampGenerator}}    \mbox{\hyperlink{class_a_u_input_format_converter_a12035e97e74bf83fb9208d8eae795320}{mTimestampGenerator}};}
\DoxyCodeLine{149     \textcolor{keywordtype}{bool}                    \mbox{\hyperlink{class_a_u_input_format_converter_aed492212b6ed455980234e9f920e62d9}{mIsPCMToPCM}};}
\DoxyCodeLine{150     \textcolor{keywordtype}{bool}                    \mbox{\hyperlink{class_a_u_input_format_converter_a9bcee974a8193fa41f2204d3b89d4fde}{mHasSRC}};}
\DoxyCodeLine{151     \textcolor{keywordtype}{bool}                    \mbox{\hyperlink{class_a_u_input_format_converter_a515e1249a1167bbb0b44b674946c05bc}{mSilentOutput}};}
\DoxyCodeLine{152     UInt32                  \mbox{\hyperlink{class_a_u_input_format_converter_a73952a02134fd9390ecf125a7afe4f6d}{mPreviousSilentFrames}};}
\DoxyCodeLine{153 \};}
\DoxyCodeLine{154 }
\DoxyCodeLine{155 \textcolor{preprocessor}{\#endif }\textcolor{comment}{// \_\_AUInputFormatConverter\_h\_\_}}

\end{DoxyCode}
