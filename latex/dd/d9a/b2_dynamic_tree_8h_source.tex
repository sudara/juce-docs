\hypertarget{b2_dynamic_tree_8h_source}{}\doxysection{b2\+Dynamic\+Tree.\+h}
\label{b2_dynamic_tree_8h_source}\index{build/juce\_box2d/box2d/Collision/b2DynamicTree.h@{build/juce\_box2d/box2d/Collision/b2DynamicTree.h}}
\mbox{\hyperlink{b2_dynamic_tree_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{/*}}
\DoxyCodeLine{2 \textcolor{comment}{* Copyright (c) 2009 Erin Catto http://www.box2d.org}}
\DoxyCodeLine{3 \textcolor{comment}{*}}
\DoxyCodeLine{4 \textcolor{comment}{* This software is provided 'as-\/is', without any express or implied}}
\DoxyCodeLine{5 \textcolor{comment}{* warranty.  In no event will the authors be held liable for any damages}}
\DoxyCodeLine{6 \textcolor{comment}{* arising from the use of this software.}}
\DoxyCodeLine{7 \textcolor{comment}{* Permission is granted to anyone to use this software for any purpose,}}
\DoxyCodeLine{8 \textcolor{comment}{* including commercial applications, and to alter it and redistribute it}}
\DoxyCodeLine{9 \textcolor{comment}{* freely, subject to the following restrictions:}}
\DoxyCodeLine{10 \textcolor{comment}{* 1. The origin of this software must not be misrepresented; you must not}}
\DoxyCodeLine{11 \textcolor{comment}{* claim that you wrote the original software. If you use this software}}
\DoxyCodeLine{12 \textcolor{comment}{* in a product, an acknowledgment in the product documentation would be}}
\DoxyCodeLine{13 \textcolor{comment}{* appreciated but is not required.}}
\DoxyCodeLine{14 \textcolor{comment}{* 2. Altered source versions must be plainly marked as such, and must not be}}
\DoxyCodeLine{15 \textcolor{comment}{* misrepresented as being the original software.}}
\DoxyCodeLine{16 \textcolor{comment}{* 3. This notice may not be removed or altered from any source distribution.}}
\DoxyCodeLine{17 \textcolor{comment}{*/}}
\DoxyCodeLine{18 }
\DoxyCodeLine{19 \textcolor{preprocessor}{\#ifndef B2\_DYNAMIC\_TREE\_H}}
\DoxyCodeLine{20 \textcolor{preprocessor}{\#define B2\_DYNAMIC\_TREE\_H}}
\DoxyCodeLine{21 }
\DoxyCodeLine{22 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{b2_collision_8h}{b2Collision.h}}"{}}}
\DoxyCodeLine{23 \textcolor{preprocessor}{\#include "{}../Common/b2GrowableStack.h"{}}}
\DoxyCodeLine{24 }
\DoxyCodeLine{25 \textcolor{preprocessor}{\#define b2\_nullNode (-\/1)}}
\DoxyCodeLine{26 }
\DoxyCodeLine{28 \textcolor{keyword}{struct }\mbox{\hyperlink{structb2_tree_node}{b2TreeNode}}}
\DoxyCodeLine{29 \{}
\DoxyCodeLine{30     \textcolor{keywordtype}{bool} \mbox{\hyperlink{structb2_tree_node_a540267ce6fa890822f1eea2d1967f646}{IsLeaf}}()\textcolor{keyword}{ const}}
\DoxyCodeLine{31 \textcolor{keyword}{    }\{}
\DoxyCodeLine{32         \textcolor{keywordflow}{return} \mbox{\hyperlink{structb2_tree_node_a546c290cd8513f3988349184d7da25ff}{child1}} == \mbox{\hyperlink{b2_dynamic_tree_8h_a270158a5581de19a0baa4b4c1c54f1fe}{b2\_nullNode}};}
\DoxyCodeLine{33     \}}
\DoxyCodeLine{34 }
\DoxyCodeLine{36     \mbox{\hyperlink{structb2_a_a_b_b}{b2AABB}} \mbox{\hyperlink{structb2_tree_node_a798f1a594b33c713be45e76e79912239}{aabb}};}
\DoxyCodeLine{37 }
\DoxyCodeLine{38     \textcolor{keywordtype}{void}* \mbox{\hyperlink{structb2_tree_node_aff77b3eb48326aca1b0762f5c45e56e7}{userData}};}
\DoxyCodeLine{39 }
\DoxyCodeLine{40     \textcolor{keyword}{union}}
\DoxyCodeLine{41     \{}
\DoxyCodeLine{42         \mbox{\hyperlink{namespace_steinberg_a2ea05679b0aa73e249c6bd7e83f41f05}{juce::int32}} \mbox{\hyperlink{structb2_tree_node_a96acafc3abb6d79507700993f251aaa0}{parent}};}
\DoxyCodeLine{43         \mbox{\hyperlink{namespace_steinberg_a2ea05679b0aa73e249c6bd7e83f41f05}{juce::int32}} \mbox{\hyperlink{structb2_tree_node_ac7851c86fa538a97ca902f52dd8990e8}{next}};}
\DoxyCodeLine{44     \};}
\DoxyCodeLine{45 }
\DoxyCodeLine{46     \mbox{\hyperlink{namespace_steinberg_a2ea05679b0aa73e249c6bd7e83f41f05}{juce::int32}} \mbox{\hyperlink{structb2_tree_node_a546c290cd8513f3988349184d7da25ff}{child1}};}
\DoxyCodeLine{47     \mbox{\hyperlink{namespace_steinberg_a2ea05679b0aa73e249c6bd7e83f41f05}{juce::int32}} \mbox{\hyperlink{structb2_tree_node_a6ce6095aa41e4f90f78abe7f921ff6be}{child2}};}
\DoxyCodeLine{48 }
\DoxyCodeLine{49     \textcolor{comment}{// leaf = 0, free node = -\/1}}
\DoxyCodeLine{50     \mbox{\hyperlink{namespace_steinberg_a2ea05679b0aa73e249c6bd7e83f41f05}{juce::int32}} \mbox{\hyperlink{structb2_tree_node_afef72f44cac49cbebe59b6ef90737be8}{height}};}
\DoxyCodeLine{51 \};}
\DoxyCodeLine{52 }
\DoxyCodeLine{61 \textcolor{keyword}{class }\mbox{\hyperlink{classb2_dynamic_tree}{b2DynamicTree}}}
\DoxyCodeLine{62 \{}
\DoxyCodeLine{63 \textcolor{keyword}{public}:}
\DoxyCodeLine{65     \mbox{\hyperlink{classb2_dynamic_tree_a8af64cf6a1566fa4c5b5c9683bd937d9}{b2DynamicTree}}();}
\DoxyCodeLine{66 }
\DoxyCodeLine{68     \mbox{\hyperlink{classb2_dynamic_tree_a9060565fc63b4dd87d9560775c076786}{\string~b2DynamicTree}}();}
\DoxyCodeLine{69 }
\DoxyCodeLine{71     \mbox{\hyperlink{namespace_steinberg_a2ea05679b0aa73e249c6bd7e83f41f05}{juce::int32}} \mbox{\hyperlink{classb2_dynamic_tree_ae44676f12977dada46037da47fc7ffbf}{CreateProxy}}(\textcolor{keyword}{const} \mbox{\hyperlink{structb2_a_a_b_b}{b2AABB}}\& aabb, \textcolor{keywordtype}{void}* userData);}
\DoxyCodeLine{72 }
\DoxyCodeLine{74     \textcolor{keywordtype}{void} \mbox{\hyperlink{classb2_dynamic_tree_aa06a007b97f6d351f5eab3cd4daf0291}{DestroyProxy}}(\mbox{\hyperlink{namespace_steinberg_a2ea05679b0aa73e249c6bd7e83f41f05}{juce::int32}} proxyId);}
\DoxyCodeLine{75 }
\DoxyCodeLine{80     \textcolor{keywordtype}{bool} \mbox{\hyperlink{classb2_dynamic_tree_a9b78c4a3fd3a255be96d08422d7be580}{MoveProxy}}(\mbox{\hyperlink{namespace_steinberg_a2ea05679b0aa73e249c6bd7e83f41f05}{juce::int32}} proxyId, \textcolor{keyword}{const} \mbox{\hyperlink{structb2_a_a_b_b}{b2AABB}}\& aabb1, \textcolor{keyword}{const} \mbox{\hyperlink{structb2_vec2}{b2Vec2}}\& displacement);}
\DoxyCodeLine{81 }
\DoxyCodeLine{84     \textcolor{keywordtype}{void}* \mbox{\hyperlink{classb2_dynamic_tree_a87a0af38e156b5fefb94b38472918a1e}{GetUserData}}(\mbox{\hyperlink{namespace_steinberg_a2ea05679b0aa73e249c6bd7e83f41f05}{juce::int32}} proxyId) \textcolor{keyword}{const};}
\DoxyCodeLine{85 }
\DoxyCodeLine{87     \textcolor{keyword}{const} \mbox{\hyperlink{structb2_a_a_b_b}{b2AABB}}\& \mbox{\hyperlink{classb2_dynamic_tree_ae7f0f4489966ee6a5502d595ca21ce74}{GetFatAABB}}(\mbox{\hyperlink{namespace_steinberg_a2ea05679b0aa73e249c6bd7e83f41f05}{juce::int32}} proxyId) \textcolor{keyword}{const};}
\DoxyCodeLine{88 }
\DoxyCodeLine{91     \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{92     \textcolor{keywordtype}{void} \mbox{\hyperlink{classb2_dynamic_tree_a324df3eb65dfc22d3dcdca387737b193}{Query}}(T* \mbox{\hyperlink{juce__linux___a_l_s_a_8cpp_a7d161ccbd94169c2108f6a40711e3a76}{callback}}, \textcolor{keyword}{const} \mbox{\hyperlink{structb2_a_a_b_b}{b2AABB}}\& aabb) \textcolor{keyword}{const};}
\DoxyCodeLine{93 }
\DoxyCodeLine{101     \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{102     \textcolor{keywordtype}{void} \mbox{\hyperlink{classb2_dynamic_tree_aebd2dc6ee462e0cd0763a5f472243a13}{RayCast}}(T* \mbox{\hyperlink{juce__linux___a_l_s_a_8cpp_a7d161ccbd94169c2108f6a40711e3a76}{callback}}, \textcolor{keyword}{const} \mbox{\hyperlink{structb2_ray_cast_input}{b2RayCastInput}}\& \mbox{\hyperlink{namespacegl_ae94d0a99dc3426b5ac5fc7d881691a61}{input}}) \textcolor{keyword}{const};}
\DoxyCodeLine{103 }
\DoxyCodeLine{105     \textcolor{keywordtype}{void} \mbox{\hyperlink{classb2_dynamic_tree_ae9b989f0c04e38f9c940623d4e1728b9}{Validate}}() \textcolor{keyword}{const};}
\DoxyCodeLine{106 }
\DoxyCodeLine{109     \mbox{\hyperlink{namespace_steinberg_a2ea05679b0aa73e249c6bd7e83f41f05}{juce::int32}} \mbox{\hyperlink{classb2_dynamic_tree_ae3c7dc771d596f1f95fd3a3d7f2f3e97}{GetHeight}}() \textcolor{keyword}{const};}
\DoxyCodeLine{110 }
\DoxyCodeLine{113     \mbox{\hyperlink{namespace_steinberg_a2ea05679b0aa73e249c6bd7e83f41f05}{juce::int32}} \mbox{\hyperlink{classb2_dynamic_tree_a3feab170229e0acd17f6a4ad3fca406e}{GetMaxBalance}}() \textcolor{keyword}{const};}
\DoxyCodeLine{114 }
\DoxyCodeLine{116     \mbox{\hyperlink{b2_settings_8h_aacdc525d6f7bddb3ae95d5c311bd06a1}{float32}} \mbox{\hyperlink{classb2_dynamic_tree_a87da9819c4f190faec38f7fe4608caae}{GetAreaRatio}}() \textcolor{keyword}{const};}
\DoxyCodeLine{117 }
\DoxyCodeLine{119     \textcolor{keywordtype}{void} \mbox{\hyperlink{classb2_dynamic_tree_abd146017cfec1cf5ea7b87331f30a3ff}{RebuildBottomUp}}();}
\DoxyCodeLine{120 }
\DoxyCodeLine{121 \textcolor{keyword}{private}:}
\DoxyCodeLine{122 }
\DoxyCodeLine{123     \mbox{\hyperlink{namespace_steinberg_a2ea05679b0aa73e249c6bd7e83f41f05}{juce::int32}} AllocateNode();}
\DoxyCodeLine{124     \textcolor{keywordtype}{void} FreeNode(\mbox{\hyperlink{namespace_steinberg_a2ea05679b0aa73e249c6bd7e83f41f05}{juce::int32}} node);}
\DoxyCodeLine{125 }
\DoxyCodeLine{126     \textcolor{keywordtype}{void} InsertLeaf(\mbox{\hyperlink{namespace_steinberg_a2ea05679b0aa73e249c6bd7e83f41f05}{juce::int32}} node);}
\DoxyCodeLine{127     \textcolor{keywordtype}{void} RemoveLeaf(\mbox{\hyperlink{namespace_steinberg_a2ea05679b0aa73e249c6bd7e83f41f05}{juce::int32}} node);}
\DoxyCodeLine{128 }
\DoxyCodeLine{129     \mbox{\hyperlink{namespace_steinberg_a2ea05679b0aa73e249c6bd7e83f41f05}{juce::int32}} Balance(\mbox{\hyperlink{namespace_steinberg_a2ea05679b0aa73e249c6bd7e83f41f05}{juce::int32}} \mbox{\hyperlink{namespacegl_a06a196a98fd7b17e699cbea6c66c37cb}{index}});}
\DoxyCodeLine{130 }
\DoxyCodeLine{131     \mbox{\hyperlink{namespace_steinberg_a2ea05679b0aa73e249c6bd7e83f41f05}{juce::int32}} ComputeHeight() \textcolor{keyword}{const};}
\DoxyCodeLine{132     \mbox{\hyperlink{namespace_steinberg_a2ea05679b0aa73e249c6bd7e83f41f05}{juce::int32}} ComputeHeight(\mbox{\hyperlink{namespace_steinberg_a2ea05679b0aa73e249c6bd7e83f41f05}{juce::int32}} nodeId) \textcolor{keyword}{const};}
\DoxyCodeLine{133 }
\DoxyCodeLine{134     \textcolor{keywordtype}{void} ValidateStructure(\mbox{\hyperlink{namespace_steinberg_a2ea05679b0aa73e249c6bd7e83f41f05}{juce::int32}} \mbox{\hyperlink{namespacegl_a06a196a98fd7b17e699cbea6c66c37cb}{index}}) \textcolor{keyword}{const};}
\DoxyCodeLine{135     \textcolor{keywordtype}{void} ValidateMetrics(\mbox{\hyperlink{namespace_steinberg_a2ea05679b0aa73e249c6bd7e83f41f05}{juce::int32}} \mbox{\hyperlink{namespacegl_a06a196a98fd7b17e699cbea6c66c37cb}{index}}) \textcolor{keyword}{const};}
\DoxyCodeLine{136 }
\DoxyCodeLine{137     \mbox{\hyperlink{namespace_steinberg_a2ea05679b0aa73e249c6bd7e83f41f05}{juce::int32}} m\_root;}
\DoxyCodeLine{138 }
\DoxyCodeLine{139     \mbox{\hyperlink{structb2_tree_node}{b2TreeNode}}* m\_nodes;}
\DoxyCodeLine{140     \mbox{\hyperlink{namespace_steinberg_a2ea05679b0aa73e249c6bd7e83f41f05}{juce::int32}} m\_nodeCount;}
\DoxyCodeLine{141     \mbox{\hyperlink{namespace_steinberg_a2ea05679b0aa73e249c6bd7e83f41f05}{juce::int32}} m\_nodeCapacity;}
\DoxyCodeLine{142 }
\DoxyCodeLine{143     \mbox{\hyperlink{namespace_steinberg_a2ea05679b0aa73e249c6bd7e83f41f05}{juce::int32}} m\_freeList;}
\DoxyCodeLine{144 }
\DoxyCodeLine{146     \mbox{\hyperlink{namespace_steinberg_af4518d725547bee20d4e185e8d3f1965}{juce::uint32}} m\_path;}
\DoxyCodeLine{147 }
\DoxyCodeLine{148     \mbox{\hyperlink{namespace_steinberg_a2ea05679b0aa73e249c6bd7e83f41f05}{juce::int32}} m\_insertionCount;}
\DoxyCodeLine{149 \};}
\DoxyCodeLine{150 }
\DoxyCodeLine{151 \textcolor{keyword}{inline} \textcolor{keywordtype}{void}* \mbox{\hyperlink{classb2_dynamic_tree_a87a0af38e156b5fefb94b38472918a1e}{b2DynamicTree::GetUserData}}(\mbox{\hyperlink{namespace_steinberg_a2ea05679b0aa73e249c6bd7e83f41f05}{juce::int32}} proxyId)\textcolor{keyword}{ const}}
\DoxyCodeLine{152 \textcolor{keyword}{}\{}
\DoxyCodeLine{153     \mbox{\hyperlink{b2_settings_8h_ab3fe3791ea4d700d5cc1f8124d2edf33}{b2Assert}}(0 <= proxyId \&\& proxyId < m\_nodeCapacity);}
\DoxyCodeLine{154     \textcolor{keywordflow}{return} m\_nodes[proxyId].\mbox{\hyperlink{structb2_tree_node_aff77b3eb48326aca1b0762f5c45e56e7}{userData}};}
\DoxyCodeLine{155 \}}
\DoxyCodeLine{156 }
\DoxyCodeLine{157 \textcolor{keyword}{inline} \textcolor{keyword}{const} \mbox{\hyperlink{structb2_a_a_b_b}{b2AABB}}\& \mbox{\hyperlink{classb2_dynamic_tree_ae7f0f4489966ee6a5502d595ca21ce74}{b2DynamicTree::GetFatAABB}}(\mbox{\hyperlink{namespace_steinberg_a2ea05679b0aa73e249c6bd7e83f41f05}{juce::int32}} proxyId)\textcolor{keyword}{ const}}
\DoxyCodeLine{158 \textcolor{keyword}{}\{}
\DoxyCodeLine{159     \mbox{\hyperlink{b2_settings_8h_ab3fe3791ea4d700d5cc1f8124d2edf33}{b2Assert}}(0 <= proxyId \&\& proxyId < m\_nodeCapacity);}
\DoxyCodeLine{160     \textcolor{keywordflow}{return} m\_nodes[proxyId].\mbox{\hyperlink{structb2_tree_node_a798f1a594b33c713be45e76e79912239}{aabb}};}
\DoxyCodeLine{161 \}}
\DoxyCodeLine{162 }
\DoxyCodeLine{163 \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{164 \textcolor{keyword}{inline} \textcolor{keywordtype}{void} \mbox{\hyperlink{classb2_dynamic_tree_a324df3eb65dfc22d3dcdca387737b193}{b2DynamicTree::Query}}(T* \mbox{\hyperlink{juce__linux___a_l_s_a_8cpp_a7d161ccbd94169c2108f6a40711e3a76}{callback}}, \textcolor{keyword}{const} \mbox{\hyperlink{structb2_a_a_b_b}{b2AABB}}\& aabb)\textcolor{keyword}{ const}}
\DoxyCodeLine{165 \textcolor{keyword}{}\{}
\DoxyCodeLine{166     \mbox{\hyperlink{classb2_growable_stack}{b2GrowableStack<juce::int32, 256>}} stack;}
\DoxyCodeLine{167     stack.\mbox{\hyperlink{classb2_growable_stack_a23661327d64ff72d1ec8d6bcdb6d8992}{Push}}(m\_root);}
\DoxyCodeLine{168 }
\DoxyCodeLine{169     \textcolor{keywordflow}{while} (stack.\mbox{\hyperlink{classb2_growable_stack_a616bf4c119cc0567c5270d50d66eca3a}{GetCount}}() > 0)}
\DoxyCodeLine{170     \{}
\DoxyCodeLine{171         \mbox{\hyperlink{namespace_steinberg_a2ea05679b0aa73e249c6bd7e83f41f05}{juce::int32}} nodeId = stack.\mbox{\hyperlink{classb2_growable_stack_a53e53dcd6bff8308405a881f02957bc8}{Pop}}();}
\DoxyCodeLine{172         \textcolor{keywordflow}{if} (nodeId == \mbox{\hyperlink{b2_dynamic_tree_8h_a270158a5581de19a0baa4b4c1c54f1fe}{b2\_nullNode}})}
\DoxyCodeLine{173         \{}
\DoxyCodeLine{174             \textcolor{keywordflow}{continue};}
\DoxyCodeLine{175         \}}
\DoxyCodeLine{176 }
\DoxyCodeLine{177         \textcolor{keyword}{const} \mbox{\hyperlink{structb2_tree_node}{b2TreeNode}}* node = m\_nodes + nodeId;}
\DoxyCodeLine{178 }
\DoxyCodeLine{179         \textcolor{keywordflow}{if} (\mbox{\hyperlink{b2_collision_8cpp_ae7601420d0b42c1ee494e879dd2009a5}{b2TestOverlap}}(node-\/>\mbox{\hyperlink{structb2_tree_node_a798f1a594b33c713be45e76e79912239}{aabb}}, aabb))}
\DoxyCodeLine{180         \{}
\DoxyCodeLine{181             \textcolor{keywordflow}{if} (node-\/>\mbox{\hyperlink{structb2_tree_node_a540267ce6fa890822f1eea2d1967f646}{IsLeaf}}())}
\DoxyCodeLine{182             \{}
\DoxyCodeLine{183                 \textcolor{keywordtype}{bool} proceed = \mbox{\hyperlink{juce__linux___a_l_s_a_8cpp_a7d161ccbd94169c2108f6a40711e3a76}{callback}}-\/>QueryCallback(nodeId);}
\DoxyCodeLine{184                 \textcolor{keywordflow}{if} (proceed == \textcolor{keyword}{false})}
\DoxyCodeLine{185                 \{}
\DoxyCodeLine{186                     \textcolor{keywordflow}{return};}
\DoxyCodeLine{187                 \}}
\DoxyCodeLine{188             \}}
\DoxyCodeLine{189             \textcolor{keywordflow}{else}}
\DoxyCodeLine{190             \{}
\DoxyCodeLine{191                 stack.\mbox{\hyperlink{classb2_growable_stack_a23661327d64ff72d1ec8d6bcdb6d8992}{Push}}(node-\/>\mbox{\hyperlink{structb2_tree_node_a546c290cd8513f3988349184d7da25ff}{child1}});}
\DoxyCodeLine{192                 stack.\mbox{\hyperlink{classb2_growable_stack_a23661327d64ff72d1ec8d6bcdb6d8992}{Push}}(node-\/>\mbox{\hyperlink{structb2_tree_node_a6ce6095aa41e4f90f78abe7f921ff6be}{child2}});}
\DoxyCodeLine{193             \}}
\DoxyCodeLine{194         \}}
\DoxyCodeLine{195     \}}
\DoxyCodeLine{196 \}}
\DoxyCodeLine{197 }
\DoxyCodeLine{198 \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{199 \textcolor{keyword}{inline} \textcolor{keywordtype}{void} \mbox{\hyperlink{classb2_dynamic_tree_aebd2dc6ee462e0cd0763a5f472243a13}{b2DynamicTree::RayCast}}(T* \mbox{\hyperlink{juce__linux___a_l_s_a_8cpp_a7d161ccbd94169c2108f6a40711e3a76}{callback}}, \textcolor{keyword}{const} \mbox{\hyperlink{structb2_ray_cast_input}{b2RayCastInput}}\& \mbox{\hyperlink{namespacegl_ae94d0a99dc3426b5ac5fc7d881691a61}{input}})\textcolor{keyword}{ const}}
\DoxyCodeLine{200 \textcolor{keyword}{}\{}
\DoxyCodeLine{201     \mbox{\hyperlink{structb2_vec2}{b2Vec2}} p1 = \mbox{\hyperlink{namespacegl_ae94d0a99dc3426b5ac5fc7d881691a61}{input}}.p1;}
\DoxyCodeLine{202     \mbox{\hyperlink{structb2_vec2}{b2Vec2}} p2 = \mbox{\hyperlink{namespacegl_ae94d0a99dc3426b5ac5fc7d881691a61}{input}}.p2;}
\DoxyCodeLine{203     \mbox{\hyperlink{structb2_vec2}{b2Vec2}} \mbox{\hyperlink{namespacegl_aaa813f59532257ed092c4fad1b443fa5}{r}} = p2 -\/ p1;}
\DoxyCodeLine{204     \mbox{\hyperlink{b2_settings_8h_ab3fe3791ea4d700d5cc1f8124d2edf33}{b2Assert}}(\mbox{\hyperlink{namespacegl_aaa813f59532257ed092c4fad1b443fa5}{r}}.LengthSquared() > 0.0f);}
\DoxyCodeLine{205     \mbox{\hyperlink{namespacegl_aaa813f59532257ed092c4fad1b443fa5}{r}}.Normalize();}
\DoxyCodeLine{206 }
\DoxyCodeLine{207     \textcolor{comment}{// v is perpendicular to the segment.}}
\DoxyCodeLine{208     \mbox{\hyperlink{structb2_vec2}{b2Vec2}} \mbox{\hyperlink{namespacegl_a90222d5e414af4ac542dabf3b3097a7f}{v}} = \mbox{\hyperlink{b2_math_8h_a33b1b80b1114eb2d03c307b02ca6fdf6}{b2Cross}}(1.0f, \mbox{\hyperlink{namespacegl_aaa813f59532257ed092c4fad1b443fa5}{r}});}
\DoxyCodeLine{209     \mbox{\hyperlink{structb2_vec2}{b2Vec2}} abs\_v = \mbox{\hyperlink{b2_math_8h_a7711eacff2f9755d3b34b360f679b33a}{b2Abs}}(\mbox{\hyperlink{namespacegl_a90222d5e414af4ac542dabf3b3097a7f}{v}});}
\DoxyCodeLine{210 }
\DoxyCodeLine{211     \textcolor{comment}{// Separating axis for segment (Gino, p80).}}
\DoxyCodeLine{212     \textcolor{comment}{// |dot(v, p1 -\/ c)| > dot(|v|, h)}}
\DoxyCodeLine{213 }
\DoxyCodeLine{214     \mbox{\hyperlink{b2_settings_8h_aacdc525d6f7bddb3ae95d5c311bd06a1}{float32}} maxFraction = \mbox{\hyperlink{namespacegl_ae94d0a99dc3426b5ac5fc7d881691a61}{input}}.maxFraction;}
\DoxyCodeLine{215 }
\DoxyCodeLine{216     \textcolor{comment}{// Build a bounding box for the segment.}}
\DoxyCodeLine{217     \mbox{\hyperlink{structb2_a_a_b_b}{b2AABB}} segmentAABB;}
\DoxyCodeLine{218     \{}
\DoxyCodeLine{219         \mbox{\hyperlink{structb2_vec2}{b2Vec2}} \mbox{\hyperlink{namespacegl_ad0bd70fc9115453f6f5f5ac53accea65}{t}} = p1 + maxFraction * (p2 -\/ p1);}
\DoxyCodeLine{220         segmentAABB.\mbox{\hyperlink{structb2_a_a_b_b_ab94b68fbad8348b22b0522469b11bdb5}{lowerBound}} = \mbox{\hyperlink{b2_math_8h_a169e88bf0dd7c5462555219dd725e11d}{b2Min}}(p1, \mbox{\hyperlink{namespacegl_ad0bd70fc9115453f6f5f5ac53accea65}{t}});}
\DoxyCodeLine{221         segmentAABB.\mbox{\hyperlink{structb2_a_a_b_b_ad4a8ec483ba13a2c02918b01d058a18f}{upperBound}} = \mbox{\hyperlink{b2_math_8h_ab35d30607cf554096fa67407304be217}{b2Max}}(p1, \mbox{\hyperlink{namespacegl_ad0bd70fc9115453f6f5f5ac53accea65}{t}});}
\DoxyCodeLine{222     \}}
\DoxyCodeLine{223 }
\DoxyCodeLine{224     \mbox{\hyperlink{classb2_growable_stack}{b2GrowableStack<juce::int32, 256>}} stack;}
\DoxyCodeLine{225     stack.\mbox{\hyperlink{classb2_growable_stack_a23661327d64ff72d1ec8d6bcdb6d8992}{Push}}(m\_root);}
\DoxyCodeLine{226 }
\DoxyCodeLine{227     \textcolor{keywordflow}{while} (stack.\mbox{\hyperlink{classb2_growable_stack_a616bf4c119cc0567c5270d50d66eca3a}{GetCount}}() > 0)}
\DoxyCodeLine{228     \{}
\DoxyCodeLine{229         \mbox{\hyperlink{namespace_steinberg_a2ea05679b0aa73e249c6bd7e83f41f05}{juce::int32}} nodeId = stack.\mbox{\hyperlink{classb2_growable_stack_a53e53dcd6bff8308405a881f02957bc8}{Pop}}();}
\DoxyCodeLine{230         \textcolor{keywordflow}{if} (nodeId == \mbox{\hyperlink{b2_dynamic_tree_8h_a270158a5581de19a0baa4b4c1c54f1fe}{b2\_nullNode}})}
\DoxyCodeLine{231         \{}
\DoxyCodeLine{232             \textcolor{keywordflow}{continue};}
\DoxyCodeLine{233         \}}
\DoxyCodeLine{234 }
\DoxyCodeLine{235         \textcolor{keyword}{const} \mbox{\hyperlink{structb2_tree_node}{b2TreeNode}}* node = m\_nodes + nodeId;}
\DoxyCodeLine{236 }
\DoxyCodeLine{237         \textcolor{keywordflow}{if} (\mbox{\hyperlink{b2_collision_8cpp_ae7601420d0b42c1ee494e879dd2009a5}{b2TestOverlap}}(node-\/>\mbox{\hyperlink{structb2_tree_node_a798f1a594b33c713be45e76e79912239}{aabb}}, segmentAABB) == \textcolor{keyword}{false})}
\DoxyCodeLine{238         \{}
\DoxyCodeLine{239             \textcolor{keywordflow}{continue};}
\DoxyCodeLine{240         \}}
\DoxyCodeLine{241 }
\DoxyCodeLine{242         \textcolor{comment}{// Separating axis for segment (Gino, p80).}}
\DoxyCodeLine{243         \textcolor{comment}{// |dot(v, p1 -\/ c)| > dot(|v|, h)}}
\DoxyCodeLine{244         \mbox{\hyperlink{structb2_vec2}{b2Vec2}} \mbox{\hyperlink{namespacegl_a1bde49b4e268a18d021f931060e1cbb1}{c}} = node-\/>\mbox{\hyperlink{structb2_tree_node_a798f1a594b33c713be45e76e79912239}{aabb}}.\mbox{\hyperlink{structb2_a_a_b_b_a2c4051e79001a3166cc7f8ad811137fe}{GetCenter}}();}
\DoxyCodeLine{245         \mbox{\hyperlink{structb2_vec2}{b2Vec2}} \mbox{\hyperlink{namespacegl_ae0306c9e6aca74fac45e19b5f64f7ba7}{h}} = node-\/>\mbox{\hyperlink{structb2_tree_node_a798f1a594b33c713be45e76e79912239}{aabb}}.\mbox{\hyperlink{structb2_a_a_b_b_a2a4f550a18d2a0895fbc5c4d3ec17d22}{GetExtents}}();}
\DoxyCodeLine{246         \mbox{\hyperlink{b2_settings_8h_aacdc525d6f7bddb3ae95d5c311bd06a1}{float32}} separation = \mbox{\hyperlink{b2_math_8h_a7711eacff2f9755d3b34b360f679b33a}{b2Abs}}(\mbox{\hyperlink{b2_math_8h_a70b92f24af9112e7951ced79045363f1}{b2Dot}}(\mbox{\hyperlink{namespacegl_a90222d5e414af4ac542dabf3b3097a7f}{v}}, p1 -\/ \mbox{\hyperlink{namespacegl_a1bde49b4e268a18d021f931060e1cbb1}{c}})) -\/ \mbox{\hyperlink{b2_math_8h_a70b92f24af9112e7951ced79045363f1}{b2Dot}}(abs\_v, \mbox{\hyperlink{namespacegl_ae0306c9e6aca74fac45e19b5f64f7ba7}{h}});}
\DoxyCodeLine{247         \textcolor{keywordflow}{if} (separation > 0.0f)}
\DoxyCodeLine{248         \{}
\DoxyCodeLine{249             \textcolor{keywordflow}{continue};}
\DoxyCodeLine{250         \}}
\DoxyCodeLine{251 }
\DoxyCodeLine{252         \textcolor{keywordflow}{if} (node-\/>\mbox{\hyperlink{structb2_tree_node_a540267ce6fa890822f1eea2d1967f646}{IsLeaf}}())}
\DoxyCodeLine{253         \{}
\DoxyCodeLine{254             \mbox{\hyperlink{structb2_ray_cast_input}{b2RayCastInput}} subInput;}
\DoxyCodeLine{255             subInput.\mbox{\hyperlink{structb2_ray_cast_input_a7254a7062422833b1124fa464ab4caf3}{p1}} = \mbox{\hyperlink{namespacegl_ae94d0a99dc3426b5ac5fc7d881691a61}{input}}.p1;}
\DoxyCodeLine{256             subInput.\mbox{\hyperlink{structb2_ray_cast_input_a850102c843469781a3a627c871043d0b}{p2}} = \mbox{\hyperlink{namespacegl_ae94d0a99dc3426b5ac5fc7d881691a61}{input}}.p2;}
\DoxyCodeLine{257             subInput.\mbox{\hyperlink{structb2_ray_cast_input_acb5c88e0ef2c3716a1334611522ab0b2}{maxFraction}} = maxFraction;}
\DoxyCodeLine{258 }
\DoxyCodeLine{259             \mbox{\hyperlink{b2_settings_8h_aacdc525d6f7bddb3ae95d5c311bd06a1}{float32}} \mbox{\hyperlink{namespacegl_ad24be0b39bf5b7d31f7c100de8508670}{value}} = \mbox{\hyperlink{juce__linux___a_l_s_a_8cpp_a7d161ccbd94169c2108f6a40711e3a76}{callback}}-\/>RayCastCallback(subInput, nodeId);}
\DoxyCodeLine{260 }
\DoxyCodeLine{261             \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespacegl_ad24be0b39bf5b7d31f7c100de8508670}{value}} == 0.0f)}
\DoxyCodeLine{262             \{}
\DoxyCodeLine{263                 \textcolor{comment}{// The client has terminated the ray cast.}}
\DoxyCodeLine{264                 \textcolor{keywordflow}{return};}
\DoxyCodeLine{265             \}}
\DoxyCodeLine{266 }
\DoxyCodeLine{267             \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespacegl_ad24be0b39bf5b7d31f7c100de8508670}{value}} > 0.0f)}
\DoxyCodeLine{268             \{}
\DoxyCodeLine{269                 \textcolor{comment}{// Update segment bounding box.}}
\DoxyCodeLine{270                 maxFraction = \mbox{\hyperlink{namespacegl_ad24be0b39bf5b7d31f7c100de8508670}{value}};}
\DoxyCodeLine{271                 \mbox{\hyperlink{structb2_vec2}{b2Vec2}} \mbox{\hyperlink{namespacegl_ad0bd70fc9115453f6f5f5ac53accea65}{t}} = p1 + maxFraction * (p2 -\/ p1);}
\DoxyCodeLine{272                 segmentAABB.\mbox{\hyperlink{structb2_a_a_b_b_ab94b68fbad8348b22b0522469b11bdb5}{lowerBound}} = \mbox{\hyperlink{b2_math_8h_a169e88bf0dd7c5462555219dd725e11d}{b2Min}}(p1, \mbox{\hyperlink{namespacegl_ad0bd70fc9115453f6f5f5ac53accea65}{t}});}
\DoxyCodeLine{273                 segmentAABB.\mbox{\hyperlink{structb2_a_a_b_b_ad4a8ec483ba13a2c02918b01d058a18f}{upperBound}} = \mbox{\hyperlink{b2_math_8h_ab35d30607cf554096fa67407304be217}{b2Max}}(p1, \mbox{\hyperlink{namespacegl_ad0bd70fc9115453f6f5f5ac53accea65}{t}});}
\DoxyCodeLine{274             \}}
\DoxyCodeLine{275         \}}
\DoxyCodeLine{276         \textcolor{keywordflow}{else}}
\DoxyCodeLine{277         \{}
\DoxyCodeLine{278             stack.\mbox{\hyperlink{classb2_growable_stack_a23661327d64ff72d1ec8d6bcdb6d8992}{Push}}(node-\/>\mbox{\hyperlink{structb2_tree_node_a546c290cd8513f3988349184d7da25ff}{child1}});}
\DoxyCodeLine{279             stack.\mbox{\hyperlink{classb2_growable_stack_a23661327d64ff72d1ec8d6bcdb6d8992}{Push}}(node-\/>\mbox{\hyperlink{structb2_tree_node_a6ce6095aa41e4f90f78abe7f921ff6be}{child2}});}
\DoxyCodeLine{280         \}}
\DoxyCodeLine{281     \}}
\DoxyCodeLine{282 \}}
\DoxyCodeLine{283 }
\DoxyCodeLine{284 \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
