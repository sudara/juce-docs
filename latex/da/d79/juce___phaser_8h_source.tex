\hypertarget{juce___phaser_8h_source}{}\doxysection{juce\+\_\+\+Phaser.\+h}
\label{juce___phaser_8h_source}\index{build/juce\_dsp/widgets/juce\_Phaser.h@{build/juce\_dsp/widgets/juce\_Phaser.h}}
\mbox{\hyperlink{juce___phaser_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 }
\DoxyCodeLine{5 \textcolor{comment}{/*}}
\DoxyCodeLine{6 \textcolor{comment}{  ==============================================================================}}
\DoxyCodeLine{7 \textcolor{comment}{}}
\DoxyCodeLine{8 \textcolor{comment}{   This file is part of the JUCE library.}}
\DoxyCodeLine{9 \textcolor{comment}{   Copyright (c) 2020 -\/ Raw Material Software Limited}}
\DoxyCodeLine{10 \textcolor{comment}{}}
\DoxyCodeLine{11 \textcolor{comment}{   JUCE is an open source library subject to commercial or open-\/source}}
\DoxyCodeLine{12 \textcolor{comment}{   licensing.}}
\DoxyCodeLine{13 \textcolor{comment}{}}
\DoxyCodeLine{14 \textcolor{comment}{   By using JUCE, you agree to the terms of both the JUCE 6 End-\/User License}}
\DoxyCodeLine{15 \textcolor{comment}{   Agreement and JUCE Privacy Policy (both effective as of the 16th June 2020).}}
\DoxyCodeLine{16 \textcolor{comment}{}}
\DoxyCodeLine{17 \textcolor{comment}{   End User License Agreement: www.juce.com/juce-\/6-\/licence}}
\DoxyCodeLine{18 \textcolor{comment}{   Privacy Policy: www.juce.com/juce-\/privacy-\/policy}}
\DoxyCodeLine{19 \textcolor{comment}{}}
\DoxyCodeLine{20 \textcolor{comment}{   Or: You may also use this code under the terms of the GPL v3 (see}}
\DoxyCodeLine{21 \textcolor{comment}{   www.gnu.org/licenses).}}
\DoxyCodeLine{22 \textcolor{comment}{}}
\DoxyCodeLine{23 \textcolor{comment}{   JUCE IS PROVIDED "{}AS IS"{} WITHOUT ANY WARRANTY, AND ALL WARRANTIES, WHETHER}}
\DoxyCodeLine{24 \textcolor{comment}{   EXPRESSED OR IMPLIED, INCLUDING MERCHANTABILITY AND FITNESS FOR PURPOSE, ARE}}
\DoxyCodeLine{25 \textcolor{comment}{   DISCLAIMED.}}
\DoxyCodeLine{26 \textcolor{comment}{}}
\DoxyCodeLine{27 \textcolor{comment}{  ==============================================================================}}
\DoxyCodeLine{28 \textcolor{comment}{*/}}
\DoxyCodeLine{29 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespacedsp}{dsp}}}
\DoxyCodeLine{30 \{}
\DoxyCodeLine{31 }
\DoxyCodeLine{42 \textcolor{keyword}{template} <\textcolor{keyword}{typename} SampleType>}
\DoxyCodeLine{43 \textcolor{keyword}{class }\mbox{\hyperlink{classdsp_1_1_phaser}{Phaser}}}
\DoxyCodeLine{44 \{}
\DoxyCodeLine{45 \textcolor{keyword}{public}:}
\DoxyCodeLine{46     \textcolor{comment}{//==============================================================================}}
\DoxyCodeLine{48 \textcolor{comment}{}    \mbox{\hyperlink{classdsp_1_1_phaser_ae3309c491d9a2cc9e6f0bc1c62309c2c}{Phaser}}();}
\DoxyCodeLine{49 }
\DoxyCodeLine{50     \textcolor{comment}{//==============================================================================}}
\DoxyCodeLine{54 \textcolor{comment}{}    \textcolor{keywordtype}{void} \mbox{\hyperlink{classdsp_1_1_phaser_a366b2454c1a7fc71003f138247c90bec}{setRate}} (SampleType newRateHz);}
\DoxyCodeLine{55 }
\DoxyCodeLine{59     \textcolor{keywordtype}{void} \mbox{\hyperlink{classdsp_1_1_phaser_a8c84f76fcb5adf21ab9218929e87dac7}{setDepth}} (SampleType newDepth);}
\DoxyCodeLine{60 }
\DoxyCodeLine{63     \textcolor{keywordtype}{void} \mbox{\hyperlink{classdsp_1_1_phaser_aa555231326461035f853fbb3a4e0754b}{setCentreFrequency}} (SampleType newCentreHz);}
\DoxyCodeLine{64 }
\DoxyCodeLine{68     \textcolor{keywordtype}{void} \mbox{\hyperlink{classdsp_1_1_phaser_aa75111061be84246bca3c765c50ea4b0}{setFeedback}} (SampleType newFeedback);}
\DoxyCodeLine{69 }
\DoxyCodeLine{73     \textcolor{keywordtype}{void} \mbox{\hyperlink{classdsp_1_1_phaser_ae7fc37bae7d30fdf01269bd51473237d}{setMix}} (SampleType newMix);}
\DoxyCodeLine{74 }
\DoxyCodeLine{75     \textcolor{comment}{//==============================================================================}}
\DoxyCodeLine{77 \textcolor{comment}{}    \textcolor{keywordtype}{void} \mbox{\hyperlink{classdsp_1_1_phaser_a767cba226ae1a0ca090a7602299b3b30}{prepare}} (\textcolor{keyword}{const} \mbox{\hyperlink{structdsp_1_1_process_spec}{ProcessSpec}}\& spec);}
\DoxyCodeLine{78 }
\DoxyCodeLine{80     \textcolor{keywordtype}{void} \mbox{\hyperlink{classdsp_1_1_phaser_a57354dcf53c82f42f2c7e90a34e10d32}{reset}}();}
\DoxyCodeLine{81 }
\DoxyCodeLine{82     \textcolor{comment}{//==============================================================================}}
\DoxyCodeLine{84 \textcolor{comment}{}    \textcolor{keyword}{template} <\textcolor{keyword}{typename} ProcessContext>}
\DoxyCodeLine{85     \textcolor{keywordtype}{void} \mbox{\hyperlink{classdsp_1_1_phaser_a7d08c3cc10e5a674a8cce126698f026a}{process}} (\textcolor{keyword}{const} ProcessContext\& context) \textcolor{keyword}{noexcept}}
\DoxyCodeLine{86     \{}
\DoxyCodeLine{87         \textcolor{keyword}{const} \textcolor{keyword}{auto}\& inputBlock = context.getInputBlock();}
\DoxyCodeLine{88         \textcolor{keyword}{auto}\& outputBlock      = context.getOutputBlock();}
\DoxyCodeLine{89         \textcolor{keyword}{const} \textcolor{keyword}{auto} numChannels = outputBlock.getNumChannels();}
\DoxyCodeLine{90         \textcolor{keyword}{const} \textcolor{keyword}{auto} numSamples  = outputBlock.getNumSamples();}
\DoxyCodeLine{91 }
\DoxyCodeLine{92         \mbox{\hyperlink{group__juce__core-system_ga1f96ab6751237979b907a54f52a7296a}{jassert}} (inputBlock.getNumChannels() == numChannels);}
\DoxyCodeLine{93         \mbox{\hyperlink{group__juce__core-system_ga1f96ab6751237979b907a54f52a7296a}{jassert}} (inputBlock.getNumChannels() == lastOutput.size());}
\DoxyCodeLine{94         \mbox{\hyperlink{group__juce__core-system_ga1f96ab6751237979b907a54f52a7296a}{jassert}} (inputBlock.getNumSamples()  == numSamples);}
\DoxyCodeLine{95 }
\DoxyCodeLine{96         \textcolor{keywordflow}{if} (context.isBypassed)}
\DoxyCodeLine{97         \{}
\DoxyCodeLine{98             outputBlock.copyFrom (inputBlock);}
\DoxyCodeLine{99             \textcolor{keywordflow}{return};}
\DoxyCodeLine{100         \}}
\DoxyCodeLine{101 }
\DoxyCodeLine{102         \textcolor{keywordtype}{int} numSamplesDown = 0;}
\DoxyCodeLine{103         \textcolor{keyword}{auto} \mbox{\hyperlink{namespacegl_a5009ba5617a3183d3e70c6ca4770cc75}{counter}} = updateCounter;}
\DoxyCodeLine{104 }
\DoxyCodeLine{105         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < numSamples; ++i)}
\DoxyCodeLine{106         \{}
\DoxyCodeLine{107             \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespacegl_a5009ba5617a3183d3e70c6ca4770cc75}{counter}} == 0)}
\DoxyCodeLine{108                 numSamplesDown++;}
\DoxyCodeLine{109 }
\DoxyCodeLine{110             \mbox{\hyperlink{namespacegl_a5009ba5617a3183d3e70c6ca4770cc75}{counter}}++;}
\DoxyCodeLine{111 }
\DoxyCodeLine{112             \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespacegl_a5009ba5617a3183d3e70c6ca4770cc75}{counter}} == maxUpdateCounter)}
\DoxyCodeLine{113                 \mbox{\hyperlink{namespacegl_a5009ba5617a3183d3e70c6ca4770cc75}{counter}} = 0;}
\DoxyCodeLine{114         \}}
\DoxyCodeLine{115 }
\DoxyCodeLine{116         \textcolor{keywordflow}{if} (numSamplesDown > 0)}
\DoxyCodeLine{117         \{}
\DoxyCodeLine{118             \textcolor{keyword}{auto} freqBlock = \mbox{\hyperlink{classdsp_1_1_audio_block}{AudioBlock<SampleType>}}(bufferFrequency).\mbox{\hyperlink{classdsp_1_1_audio_block_a299c2ac84fd87eef264aa0f0d39cc426}{getSubBlock}} (0, (\textcolor{keywordtype}{size\_t}) numSamplesDown);}
\DoxyCodeLine{119             \textcolor{keyword}{auto} contextFreq = \mbox{\hyperlink{structdsp_1_1_process_context_replacing}{ProcessContextReplacing<SampleType>}} (freqBlock);}
\DoxyCodeLine{120             freqBlock.clear();}
\DoxyCodeLine{121 }
\DoxyCodeLine{122             osc.process (contextFreq);}
\DoxyCodeLine{123             freqBlock.multiplyBy (oscVolume);}
\DoxyCodeLine{124         \}}
\DoxyCodeLine{125 }
\DoxyCodeLine{126         \textcolor{keyword}{auto}* freqSamples = bufferFrequency.getWritePointer (0);}
\DoxyCodeLine{127 }
\DoxyCodeLine{128         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < numSamplesDown; ++i)}
\DoxyCodeLine{129         \{}
\DoxyCodeLine{130             \textcolor{keyword}{auto} lfo = \mbox{\hyperlink{group__juce__core-maths_gacf7cd562ab136d15d3bf5c3be047cf96}{jlimit}} (\textcolor{keyword}{static\_cast<}SampleType\textcolor{keyword}{>} (0.0),}
\DoxyCodeLine{131                                \textcolor{keyword}{static\_cast<}SampleType\textcolor{keyword}{>} (1.0),}
\DoxyCodeLine{132                                freqSamples[i] + normCentreFrequency);}
\DoxyCodeLine{133 }
\DoxyCodeLine{134             freqSamples[i] = \mbox{\hyperlink{group__juce__core-maths_ga0fb8d4f154ec362be912c96e7287e232}{mapToLog10}} (lfo, \textcolor{keyword}{static\_cast<}SampleType\textcolor{keyword}{>} (20.0),}
\DoxyCodeLine{135                                          \textcolor{keyword}{static\_cast<}SampleType\textcolor{keyword}{>} (\mbox{\hyperlink{group__juce__core-maths_gae8394cdf11279b266f4aa741758c1669}{jmin}} (20000.0, 0.49 * sampleRate)));}
\DoxyCodeLine{136         \}}
\DoxyCodeLine{137 }
\DoxyCodeLine{138         \textcolor{keyword}{auto} currentFrequency = filters[0]-\/>getCutoffFrequency();}
\DoxyCodeLine{139         dryWet.pushDrySamples (inputBlock);}
\DoxyCodeLine{140 }
\DoxyCodeLine{141         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} channel = 0; channel < numChannels; ++channel)}
\DoxyCodeLine{142         \{}
\DoxyCodeLine{143             \mbox{\hyperlink{namespacegl_a5009ba5617a3183d3e70c6ca4770cc75}{counter}} = updateCounter;}
\DoxyCodeLine{144             \textcolor{keywordtype}{int} k = 0;}
\DoxyCodeLine{145 }
\DoxyCodeLine{146             \textcolor{keyword}{auto}* inputSamples  = inputBlock .getChannelPointer (channel);}
\DoxyCodeLine{147             \textcolor{keyword}{auto}* outputSamples = outputBlock.getChannelPointer (channel);}
\DoxyCodeLine{148 }
\DoxyCodeLine{149             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < numSamples; ++i)}
\DoxyCodeLine{150             \{}
\DoxyCodeLine{151                 \textcolor{keyword}{auto} \mbox{\hyperlink{namespacegl_ae94d0a99dc3426b5ac5fc7d881691a61}{input}} = inputSamples[i];}
\DoxyCodeLine{152                 \textcolor{keyword}{auto} \mbox{\hyperlink{namespacegl_a6feaa3453ce5f1535f7b2709b198b7b6}{output}} = \mbox{\hyperlink{namespacegl_ae94d0a99dc3426b5ac5fc7d881691a61}{input}} -\/ lastOutput[channel];}
\DoxyCodeLine{153 }
\DoxyCodeLine{154                 \textcolor{keywordflow}{if} (i == 0 \&\& \mbox{\hyperlink{namespacegl_a5009ba5617a3183d3e70c6ca4770cc75}{counter}} != 0)}
\DoxyCodeLine{155                     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} \mbox{\hyperlink{namespacegl_a1f71d238be3cdf94fc21bd0a832f074a}{n}} = 0; \mbox{\hyperlink{namespacegl_a1f71d238be3cdf94fc21bd0a832f074a}{n}} < numStages; ++\mbox{\hyperlink{namespacegl_a1f71d238be3cdf94fc21bd0a832f074a}{n}})}
\DoxyCodeLine{156                         filters[\mbox{\hyperlink{namespacegl_a1f71d238be3cdf94fc21bd0a832f074a}{n}}]-\/>setCutoffFrequency (currentFrequency);}
\DoxyCodeLine{157 }
\DoxyCodeLine{158                 \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespacegl_a5009ba5617a3183d3e70c6ca4770cc75}{counter}} == 0)}
\DoxyCodeLine{159                 \{}
\DoxyCodeLine{160                     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} \mbox{\hyperlink{namespacegl_a1f71d238be3cdf94fc21bd0a832f074a}{n}} = 0; \mbox{\hyperlink{namespacegl_a1f71d238be3cdf94fc21bd0a832f074a}{n}} < numStages; ++\mbox{\hyperlink{namespacegl_a1f71d238be3cdf94fc21bd0a832f074a}{n}})}
\DoxyCodeLine{161                         filters[\mbox{\hyperlink{namespacegl_a1f71d238be3cdf94fc21bd0a832f074a}{n}}]-\/>setCutoffFrequency (freqSamples[k]);}
\DoxyCodeLine{162 }
\DoxyCodeLine{163                     k++;}
\DoxyCodeLine{164                 \}}
\DoxyCodeLine{165 }
\DoxyCodeLine{166                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} \mbox{\hyperlink{namespacegl_a1f71d238be3cdf94fc21bd0a832f074a}{n}} = 0; \mbox{\hyperlink{namespacegl_a1f71d238be3cdf94fc21bd0a832f074a}{n}} < numStages; ++\mbox{\hyperlink{namespacegl_a1f71d238be3cdf94fc21bd0a832f074a}{n}})}
\DoxyCodeLine{167                     \mbox{\hyperlink{namespacegl_a6feaa3453ce5f1535f7b2709b198b7b6}{output}} = filters[\mbox{\hyperlink{namespacegl_a1f71d238be3cdf94fc21bd0a832f074a}{n}}]-\/>processSample ((\textcolor{keywordtype}{int}) channel, \mbox{\hyperlink{namespacegl_a6feaa3453ce5f1535f7b2709b198b7b6}{output}});}
\DoxyCodeLine{168 }
\DoxyCodeLine{169                 outputSamples[i] = \mbox{\hyperlink{namespacegl_a6feaa3453ce5f1535f7b2709b198b7b6}{output}};}
\DoxyCodeLine{170                 lastOutput[channel] = \mbox{\hyperlink{namespacegl_a6feaa3453ce5f1535f7b2709b198b7b6}{output}} * feedbackVolume[channel].getNextValue();}
\DoxyCodeLine{171 }
\DoxyCodeLine{172                 \mbox{\hyperlink{namespacegl_a5009ba5617a3183d3e70c6ca4770cc75}{counter}}++;}
\DoxyCodeLine{173 }
\DoxyCodeLine{174                 \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespacegl_a5009ba5617a3183d3e70c6ca4770cc75}{counter}} == maxUpdateCounter)}
\DoxyCodeLine{175                     \mbox{\hyperlink{namespacegl_a5009ba5617a3183d3e70c6ca4770cc75}{counter}} = 0;}
\DoxyCodeLine{176             \}}
\DoxyCodeLine{177         \}}
\DoxyCodeLine{178 }
\DoxyCodeLine{179         dryWet.mixWetSamples (outputBlock);}
\DoxyCodeLine{180         updateCounter = (updateCounter + (\mbox{\hyperlink{group__juce__audio__plugin__client-_unity_ga966b05a42d98c7296097e073c627dcd0}{int}}) numSamples) \% maxUpdateCounter;}
\DoxyCodeLine{181     \}}
\DoxyCodeLine{182 }
\DoxyCodeLine{183 \textcolor{keyword}{private}:}
\DoxyCodeLine{184     \textcolor{comment}{//==============================================================================}}
\DoxyCodeLine{185     \textcolor{keywordtype}{void} update();}
\DoxyCodeLine{186 }
\DoxyCodeLine{187     \textcolor{comment}{//==============================================================================}}
\DoxyCodeLine{188     \mbox{\hyperlink{classdsp_1_1_oscillator}{Oscillator<SampleType>}} osc;}
\DoxyCodeLine{189     \mbox{\hyperlink{class_owned_array}{OwnedArray<FirstOrderTPTFilter<SampleType>}}> filters;}
\DoxyCodeLine{190     \mbox{\hyperlink{class_smoothed_value}{SmoothedValue<SampleType, ValueSmoothingTypes::Linear>}} oscVolume;}
\DoxyCodeLine{191     std::vector<SmoothedValue<SampleType, ValueSmoothingTypes::Linear>> feedbackVolume \{ 2 \};}
\DoxyCodeLine{192     DryWetMixer<SampleType> dryWet;}
\DoxyCodeLine{193     std::vector<SampleType> lastOutput \{ 2 \};}
\DoxyCodeLine{194     \mbox{\hyperlink{class_audio_buffer}{AudioBuffer<SampleType>}} bufferFrequency;}
\DoxyCodeLine{195     SampleType normCentreFrequency = 0.5;}
\DoxyCodeLine{196     \textcolor{keywordtype}{double} sampleRate = 44100.0;}
\DoxyCodeLine{197 }
\DoxyCodeLine{198     \textcolor{keywordtype}{int} updateCounter = 0;}
\DoxyCodeLine{199     \textcolor{keyword}{static} \textcolor{keyword}{constexpr} \textcolor{keywordtype}{int} maxUpdateCounter = 4;}
\DoxyCodeLine{200 }
\DoxyCodeLine{201     SampleType rate = 1.0, depth = 0.5, feedback = 0.0, mix = 0.5;}
\DoxyCodeLine{202     SampleType centreFrequency = 1300.0;}
\DoxyCodeLine{203     \textcolor{keyword}{static} \textcolor{keyword}{constexpr} \textcolor{keywordtype}{int} numStages = 6;}
\DoxyCodeLine{204 \};}
\DoxyCodeLine{205 }
\DoxyCodeLine{206 \} \textcolor{comment}{// namespace dsp}}
\DoxyCodeLine{207  \textcolor{comment}{// namespace juce}}
\DoxyCodeLine{208 }

\end{DoxyCode}
