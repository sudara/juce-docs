\hypertarget{_audio_clock_8h_source}{}\doxysection{Audio\+Clock.\+h}
\label{_audio_clock_8h_source}\index{build/juce\_audio\_devices/native/oboe/src/common/AudioClock.h@{build/juce\_audio\_devices/native/oboe/src/common/AudioClock.h}}
\mbox{\hyperlink{_audio_clock_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{/*}}
\DoxyCodeLine{2 \textcolor{comment}{ * Copyright (C) 2016 The Android Open Source Project}}
\DoxyCodeLine{3 \textcolor{comment}{ *}}
\DoxyCodeLine{4 \textcolor{comment}{ * Licensed under the Apache License, Version 2.0 (the "{}License"{});}}
\DoxyCodeLine{5 \textcolor{comment}{ * you may not use this file except in compliance with the License.}}
\DoxyCodeLine{6 \textcolor{comment}{ * You may obtain a copy of the License at}}
\DoxyCodeLine{7 \textcolor{comment}{ *}}
\DoxyCodeLine{8 \textcolor{comment}{ *      http://www.apache.org/licenses/LICENSE-\/2.0}}
\DoxyCodeLine{9 \textcolor{comment}{ *}}
\DoxyCodeLine{10 \textcolor{comment}{ * Unless required by applicable law or agreed to in writing, software}}
\DoxyCodeLine{11 \textcolor{comment}{ * distributed under the License is distributed on an "{}AS IS"{} BASIS,}}
\DoxyCodeLine{12 \textcolor{comment}{ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.}}
\DoxyCodeLine{13 \textcolor{comment}{ * See the License for the specific language governing permissions and}}
\DoxyCodeLine{14 \textcolor{comment}{ * limitations under the License.}}
\DoxyCodeLine{15 \textcolor{comment}{ */}}
\DoxyCodeLine{16 }
\DoxyCodeLine{17 \textcolor{preprocessor}{\#ifndef OBOE\_AUDIO\_CLOCK\_H}}
\DoxyCodeLine{18 \textcolor{preprocessor}{\#define OBOE\_AUDIO\_CLOCK\_H}}
\DoxyCodeLine{19 }
\DoxyCodeLine{20 \textcolor{preprocessor}{\#include <sys/types.h>}}
\DoxyCodeLine{21 \textcolor{preprocessor}{\#include <ctime>}}
\DoxyCodeLine{22 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_definitions_8h}{oboe/Definitions.h}}"{}}}
\DoxyCodeLine{23 }
\DoxyCodeLine{24 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespaceoboe}{oboe}} \{}
\DoxyCodeLine{25 }
\DoxyCodeLine{26 \textcolor{comment}{// TODO: Move this class into the public headers because it is useful when calculating stream latency}}
\DoxyCodeLine{27 \textcolor{keyword}{class }\mbox{\hyperlink{classoboe_1_1_audio_clock}{AudioClock}} \{}
\DoxyCodeLine{28 \textcolor{keyword}{public}:}
\DoxyCodeLine{29     \textcolor{keyword}{static} int64\_t \mbox{\hyperlink{classoboe_1_1_audio_clock_a1de9b96a03770e527758402408f60f65}{getNanoseconds}}(clockid\_t clockId = CLOCK\_MONOTONIC) \{}
\DoxyCodeLine{30         \textcolor{keyword}{struct }timespec time;}
\DoxyCodeLine{31         \textcolor{keywordtype}{int} \mbox{\hyperlink{namespacegl_a7cb1126dbc1cb105bcce082cff5ae633}{result}} = clock\_gettime(clockId, \&time);}
\DoxyCodeLine{32         \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespacegl_a7cb1126dbc1cb105bcce082cff5ae633}{result}} < 0) \{}
\DoxyCodeLine{33             \textcolor{keywordflow}{return} \mbox{\hyperlink{namespacegl_a7cb1126dbc1cb105bcce082cff5ae633}{result}};}
\DoxyCodeLine{34         \}}
\DoxyCodeLine{35         \textcolor{keywordflow}{return} (time.tv\_sec * \mbox{\hyperlink{namespaceoboe_a5948466b593c4eab65f7025846a39f51}{kNanosPerSecond}}) + time.tv\_nsec;}
\DoxyCodeLine{36     \}}
\DoxyCodeLine{37 }
\DoxyCodeLine{46     \textcolor{keyword}{static} \textcolor{keywordtype}{int} \mbox{\hyperlink{classoboe_1_1_audio_clock_a37e5b60143ca51bad9ac787858b4931a}{sleepUntilNanoTime}}(int64\_t nanoTime, clockid\_t clockId = CLOCK\_MONOTONIC) \{}
\DoxyCodeLine{47         \textcolor{keyword}{struct }timespec time;}
\DoxyCodeLine{48         time.tv\_sec = nanoTime / \mbox{\hyperlink{namespaceoboe_a5948466b593c4eab65f7025846a39f51}{kNanosPerSecond}};}
\DoxyCodeLine{49         time.tv\_nsec = nanoTime -\/ (time.tv\_sec * \mbox{\hyperlink{namespaceoboe_a5948466b593c4eab65f7025846a39f51}{kNanosPerSecond}});}
\DoxyCodeLine{50         \textcolor{keywordflow}{return} 0 -\/ clock\_nanosleep(clockId, TIMER\_ABSTIME, \&time, NULL);}
\DoxyCodeLine{51     \}}
\DoxyCodeLine{52 }
\DoxyCodeLine{62     \textcolor{keyword}{static} \textcolor{keywordtype}{int} \mbox{\hyperlink{classoboe_1_1_audio_clock_acb3b78ed36bde7209c6ab9f96504aa86}{sleepForNanos}}(int64\_t nanoseconds, clockid\_t clockId = CLOCK\_REALTIME) \{}
\DoxyCodeLine{63         \textcolor{keywordflow}{if} (nanoseconds > 0) \{}
\DoxyCodeLine{64             \textcolor{keyword}{struct }timespec time;}
\DoxyCodeLine{65             time.tv\_sec = nanoseconds / \mbox{\hyperlink{namespaceoboe_a5948466b593c4eab65f7025846a39f51}{kNanosPerSecond}};}
\DoxyCodeLine{66             time.tv\_nsec = nanoseconds -\/ (time.tv\_sec * \mbox{\hyperlink{namespaceoboe_a5948466b593c4eab65f7025846a39f51}{kNanosPerSecond}});}
\DoxyCodeLine{67             \textcolor{keywordflow}{return} 0 -\/ clock\_nanosleep(clockId, 0, \&time, NULL);}
\DoxyCodeLine{68         \}}
\DoxyCodeLine{69         \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{70     \}}
\DoxyCodeLine{71 \};}
\DoxyCodeLine{72 }
\DoxyCodeLine{73 \} \textcolor{comment}{// namespace oboe}}
\DoxyCodeLine{74 }
\DoxyCodeLine{75 \textcolor{preprocessor}{\#endif }\textcolor{comment}{//OBOE\_AUDIO\_CLOCK\_H}}

\end{DoxyCode}
