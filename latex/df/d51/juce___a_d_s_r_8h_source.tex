\hypertarget{juce___a_d_s_r_8h_source}{}\doxysection{juce\+\_\+\+ADSR.\+h}
\label{juce___a_d_s_r_8h_source}\index{build/juce\_audio\_basics/utilities/juce\_ADSR.h@{build/juce\_audio\_basics/utilities/juce\_ADSR.h}}
\mbox{\hyperlink{juce___a_d_s_r_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 }
\DoxyCodeLine{5 \textcolor{comment}{/*}}
\DoxyCodeLine{6 \textcolor{comment}{  ==============================================================================}}
\DoxyCodeLine{7 \textcolor{comment}{}}
\DoxyCodeLine{8 \textcolor{comment}{   This file is part of the JUCE library.}}
\DoxyCodeLine{9 \textcolor{comment}{   Copyright (c) 2020 -\/ Raw Material Software Limited}}
\DoxyCodeLine{10 \textcolor{comment}{}}
\DoxyCodeLine{11 \textcolor{comment}{   JUCE is an open source library subject to commercial or open-\/source}}
\DoxyCodeLine{12 \textcolor{comment}{   licensing.}}
\DoxyCodeLine{13 \textcolor{comment}{}}
\DoxyCodeLine{14 \textcolor{comment}{   The code included in this file is provided under the terms of the ISC license}}
\DoxyCodeLine{15 \textcolor{comment}{   http://www.isc.org/downloads/software-\/support-\/policy/isc-\/license. Permission}}
\DoxyCodeLine{16 \textcolor{comment}{   To use, copy, modify, and/or distribute this software for any purpose with or}}
\DoxyCodeLine{17 \textcolor{comment}{   without fee is hereby granted provided that the above copyright notice and}}
\DoxyCodeLine{18 \textcolor{comment}{   this permission notice appear in all copies.}}
\DoxyCodeLine{19 \textcolor{comment}{}}
\DoxyCodeLine{20 \textcolor{comment}{   JUCE IS PROVIDED "{}AS IS"{} WITHOUT ANY WARRANTY, AND ALL WARRANTIES, WHETHER}}
\DoxyCodeLine{21 \textcolor{comment}{   EXPRESSED OR IMPLIED, INCLUDING MERCHANTABILITY AND FITNESS FOR PURPOSE, ARE}}
\DoxyCodeLine{22 \textcolor{comment}{   DISCLAIMED.}}
\DoxyCodeLine{23 \textcolor{comment}{}}
\DoxyCodeLine{24 \textcolor{comment}{  ==============================================================================}}
\DoxyCodeLine{25 \textcolor{comment}{*/}}
\DoxyCodeLine{26 }
\DoxyCodeLine{27 \textcolor{comment}{//==============================================================================}}
\DoxyCodeLine{37 \textcolor{comment}{}\textcolor{keyword}{class }\mbox{\hyperlink{group__juce__core-system_ga65961b3bfbda0ffb83750d914cee38fb}{JUCE\_API}}  \mbox{\hyperlink{class_a_d_s_r}{ADSR}}}
\DoxyCodeLine{38 \{}
\DoxyCodeLine{39 \textcolor{keyword}{public}:}
\DoxyCodeLine{40     \textcolor{comment}{//==============================================================================}}
\DoxyCodeLine{41     \mbox{\hyperlink{class_a_d_s_r_a23264ae8eb79a35c57f648c589b218ae}{ADSR}}()}
\DoxyCodeLine{42     \{}
\DoxyCodeLine{43         recalculateRates();}
\DoxyCodeLine{44     \}}
\DoxyCodeLine{45 }
\DoxyCodeLine{46     \textcolor{comment}{//==============================================================================}}
\DoxyCodeLine{52 \textcolor{comment}{}    \textcolor{keyword}{struct }\mbox{\hyperlink{group__juce__core-system_ga65961b3bfbda0ffb83750d914cee38fb}{JUCE\_API}}  \mbox{\hyperlink{struct_a_d_s_r_1_1_parameters}{Parameters}}}
\DoxyCodeLine{53     \{}
\DoxyCodeLine{54         \mbox{\hyperlink{struct_a_d_s_r_1_1_parameters_a33646efa57f2ea9793533e71dd4d2f02}{Parameters}}() = \textcolor{keywordflow}{default};}
\DoxyCodeLine{55 }
\DoxyCodeLine{56         \mbox{\hyperlink{struct_a_d_s_r_1_1_parameters_a8d8efb94830094b236bb1bf043dba8b2}{Parameters}} (\textcolor{keywordtype}{float} attackTimeSeconds,}
\DoxyCodeLine{57                     \textcolor{keywordtype}{float} decayTimeSeconds,}
\DoxyCodeLine{58                     \textcolor{keywordtype}{float} sustainLevel,}
\DoxyCodeLine{59                     \textcolor{keywordtype}{float} releaseTimeSeconds)}
\DoxyCodeLine{60             : attack (attackTimeSeconds),}
\DoxyCodeLine{61               decay (decayTimeSeconds),}
\DoxyCodeLine{62               sustain (sustainLevel),}
\DoxyCodeLine{63               release (releaseTimeSeconds)}
\DoxyCodeLine{64         \{}
\DoxyCodeLine{65         \}}
\DoxyCodeLine{66 }
\DoxyCodeLine{67         \textcolor{keywordtype}{float} attack = 0.1f, decay = 0.1f, sustain = 1.0f, release = 0.1f;}
\DoxyCodeLine{68     \};}
\DoxyCodeLine{69 }
\DoxyCodeLine{77     \textcolor{keywordtype}{void} \mbox{\hyperlink{class_a_d_s_r_a621c70a6324e9bfaa3926f3da557ade9}{setParameters}} (\textcolor{keyword}{const} \mbox{\hyperlink{struct_a_d_s_r_1_1_parameters}{Parameters}}\& newParameters)}
\DoxyCodeLine{78     \{}
\DoxyCodeLine{79         \textcolor{comment}{// need to call setSampleRate() first!}}
\DoxyCodeLine{80         \mbox{\hyperlink{group__juce__core-system_ga1f96ab6751237979b907a54f52a7296a}{jassert}} (\mbox{\hyperlink{juce__linux___a_l_s_a_8cpp_a2bd79d2ab2dfb6aeaf75c2878ad30e1f}{sampleRate}} > 0.0);}
\DoxyCodeLine{81 }
\DoxyCodeLine{82         parameters = newParameters;}
\DoxyCodeLine{83         recalculateRates();}
\DoxyCodeLine{84     \}}
\DoxyCodeLine{85 }
\DoxyCodeLine{90     \textcolor{keyword}{const} \mbox{\hyperlink{struct_a_d_s_r_1_1_parameters}{Parameters}}\& \mbox{\hyperlink{class_a_d_s_r_aedcdefb629ae380b42c34b237770633f}{getParameters}}() \mbox{\hyperlink{zconf_8h_a2c212835823e3c54a8ab6d95c652660e}{const}} noexcept  \{ \textcolor{keywordflow}{return} parameters; \}}
\DoxyCodeLine{91 }
\DoxyCodeLine{93     \textcolor{keywordtype}{bool} \mbox{\hyperlink{class_a_d_s_r_a1422645c27f3ce0caedd2afa57bf19ef}{isActive}}() \mbox{\hyperlink{zconf_8h_a2c212835823e3c54a8ab6d95c652660e}{const}} noexcept                    \{ \textcolor{keywordflow}{return} state != State::idle; \}}
\DoxyCodeLine{94 }
\DoxyCodeLine{95     \textcolor{comment}{//==============================================================================}}
\DoxyCodeLine{100 \textcolor{comment}{}    \textcolor{keywordtype}{void} \mbox{\hyperlink{class_a_d_s_r_a570f2705d7584d8489b01db8e9cf4485}{setSampleRate}} (\textcolor{keywordtype}{double} newSampleRate) \textcolor{keyword}{noexcept}}
\DoxyCodeLine{101     \{}
\DoxyCodeLine{102         \mbox{\hyperlink{group__juce__core-system_ga1f96ab6751237979b907a54f52a7296a}{jassert}} (newSampleRate > 0.0);}
\DoxyCodeLine{103         \mbox{\hyperlink{juce__linux___a_l_s_a_8cpp_a2bd79d2ab2dfb6aeaf75c2878ad30e1f}{sampleRate}} = newSampleRate;}
\DoxyCodeLine{104     \}}
\DoxyCodeLine{105 }
\DoxyCodeLine{106     \textcolor{comment}{//==============================================================================}}
\DoxyCodeLine{108 \textcolor{comment}{}    \textcolor{keywordtype}{void} \mbox{\hyperlink{class_a_d_s_r_a4e9c3982630809f8873b9dc9058d6db0}{reset}}() noexcept}
\DoxyCodeLine{109     \{}
\DoxyCodeLine{110         envelopeVal = 0.0f;}
\DoxyCodeLine{111         state = State::idle;}
\DoxyCodeLine{112     \}}
\DoxyCodeLine{113 }
\DoxyCodeLine{115     \textcolor{keywordtype}{void} \mbox{\hyperlink{class_a_d_s_r_a1287f2258b4ba31325ac653acaee7036}{noteOn}}() noexcept}
\DoxyCodeLine{116     \{}
\DoxyCodeLine{117         \textcolor{keywordflow}{if} (attackRate > 0.0f)}
\DoxyCodeLine{118         \{}
\DoxyCodeLine{119             state = State::attack;}
\DoxyCodeLine{120         \}}
\DoxyCodeLine{121         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (decayRate > 0.0f)}
\DoxyCodeLine{122         \{}
\DoxyCodeLine{123             envelopeVal = 1.0f;}
\DoxyCodeLine{124             state = State::decay;}
\DoxyCodeLine{125         \}}
\DoxyCodeLine{126         \textcolor{keywordflow}{else}}
\DoxyCodeLine{127         \{}
\DoxyCodeLine{128             envelopeVal = parameters.sustain;}
\DoxyCodeLine{129             state = State::sustain;}
\DoxyCodeLine{130         \}}
\DoxyCodeLine{131     \}}
\DoxyCodeLine{132 }
\DoxyCodeLine{134     \textcolor{keywordtype}{void} \mbox{\hyperlink{class_a_d_s_r_add32ca96bdec031db3ac454e090cf04f}{noteOff}}() noexcept}
\DoxyCodeLine{135     \{}
\DoxyCodeLine{136         \textcolor{keywordflow}{if} (state != State::idle)}
\DoxyCodeLine{137         \{}
\DoxyCodeLine{138             \textcolor{keywordflow}{if} (parameters.release > 0.0f)}
\DoxyCodeLine{139             \{}
\DoxyCodeLine{140                 releaseRate = (float) (envelopeVal / (parameters.release * \mbox{\hyperlink{juce__linux___a_l_s_a_8cpp_a2bd79d2ab2dfb6aeaf75c2878ad30e1f}{sampleRate}}));}
\DoxyCodeLine{141                 state = State::release;}
\DoxyCodeLine{142             \}}
\DoxyCodeLine{143             \textcolor{keywordflow}{else}}
\DoxyCodeLine{144             \{}
\DoxyCodeLine{145                 \mbox{\hyperlink{namespacegl_a3b437ea454d772211296e220c025bdd2}{reset}}();}
\DoxyCodeLine{146             \}}
\DoxyCodeLine{147         \}}
\DoxyCodeLine{148     \}}
\DoxyCodeLine{149 }
\DoxyCodeLine{150     \textcolor{comment}{//==============================================================================}}
\DoxyCodeLine{155 \textcolor{comment}{}    \textcolor{keywordtype}{float} \mbox{\hyperlink{class_a_d_s_r_a75be2a724854a7f591d0b7960dfeb10f}{getNextSample}}() noexcept}
\DoxyCodeLine{156     \{}
\DoxyCodeLine{157         \textcolor{keywordflow}{if} (state == State::idle)}
\DoxyCodeLine{158             \textcolor{keywordflow}{return} 0.0f;}
\DoxyCodeLine{159 }
\DoxyCodeLine{160         \textcolor{keywordflow}{if} (state == State::attack)}
\DoxyCodeLine{161         \{}
\DoxyCodeLine{162             envelopeVal += attackRate;}
\DoxyCodeLine{163 }
\DoxyCodeLine{164             \textcolor{keywordflow}{if} (envelopeVal >= 1.0f)}
\DoxyCodeLine{165             \{}
\DoxyCodeLine{166                 envelopeVal = 1.0f;}
\DoxyCodeLine{167                 goToNextState();}
\DoxyCodeLine{168             \}}
\DoxyCodeLine{169         \}}
\DoxyCodeLine{170         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (state == State::decay)}
\DoxyCodeLine{171         \{}
\DoxyCodeLine{172             envelopeVal -\/= decayRate;}
\DoxyCodeLine{173 }
\DoxyCodeLine{174             \textcolor{keywordflow}{if} (envelopeVal <= parameters.sustain)}
\DoxyCodeLine{175             \{}
\DoxyCodeLine{176                 envelopeVal = parameters.sustain;}
\DoxyCodeLine{177                 goToNextState();}
\DoxyCodeLine{178             \}}
\DoxyCodeLine{179         \}}
\DoxyCodeLine{180         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (state == State::sustain)}
\DoxyCodeLine{181         \{}
\DoxyCodeLine{182             envelopeVal = parameters.sustain;}
\DoxyCodeLine{183         \}}
\DoxyCodeLine{184         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (state == State::release)}
\DoxyCodeLine{185         \{}
\DoxyCodeLine{186             envelopeVal -\/= releaseRate;}
\DoxyCodeLine{187 }
\DoxyCodeLine{188             \textcolor{keywordflow}{if} (envelopeVal <= 0.0f)}
\DoxyCodeLine{189                 goToNextState();}
\DoxyCodeLine{190         \}}
\DoxyCodeLine{191 }
\DoxyCodeLine{192         \textcolor{keywordflow}{return} envelopeVal;}
\DoxyCodeLine{193     \}}
\DoxyCodeLine{194 }
\DoxyCodeLine{200     \textcolor{keyword}{template} <\textcolor{keyword}{typename} FloatType>}
\DoxyCodeLine{201     \textcolor{keywordtype}{void} \mbox{\hyperlink{class_a_d_s_r_a883ba7e39999c2c77786cca1b7926694}{applyEnvelopeToBuffer}} (\mbox{\hyperlink{class_audio_buffer}{AudioBuffer<FloatType>}}\& buffer, \textcolor{keywordtype}{int} startSample, \textcolor{keywordtype}{int} numSamples)}
\DoxyCodeLine{202     \{}
\DoxyCodeLine{203         \mbox{\hyperlink{group__juce__core-system_ga1f96ab6751237979b907a54f52a7296a}{jassert}} (startSample + numSamples <= buffer.getNumSamples());}
\DoxyCodeLine{204 }
\DoxyCodeLine{205         \textcolor{keywordflow}{if} (state == State::idle)}
\DoxyCodeLine{206         \{}
\DoxyCodeLine{207             buffer.clear (startSample, numSamples);}
\DoxyCodeLine{208             \textcolor{keywordflow}{return};}
\DoxyCodeLine{209         \}}
\DoxyCodeLine{210 }
\DoxyCodeLine{211         \textcolor{keywordflow}{if} (state == State::sustain)}
\DoxyCodeLine{212         \{}
\DoxyCodeLine{213             buffer.applyGain (startSample, numSamples, parameters.sustain);}
\DoxyCodeLine{214             \textcolor{keywordflow}{return};}
\DoxyCodeLine{215         \}}
\DoxyCodeLine{216 }
\DoxyCodeLine{217         \textcolor{keyword}{auto} numChannels = buffer.getNumChannels();}
\DoxyCodeLine{218 }
\DoxyCodeLine{219         \textcolor{keywordflow}{while} (-\/-\/numSamples >= 0)}
\DoxyCodeLine{220         \{}
\DoxyCodeLine{221             \textcolor{keyword}{auto} env = getNextSample();}
\DoxyCodeLine{222 }
\DoxyCodeLine{223             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < numChannels; ++i)}
\DoxyCodeLine{224                 buffer.getWritePointer (i)[startSample] *= env;}
\DoxyCodeLine{225 }
\DoxyCodeLine{226             ++startSample;}
\DoxyCodeLine{227         \}}
\DoxyCodeLine{228     \}}
\DoxyCodeLine{229 }
\DoxyCodeLine{230 \textcolor{keyword}{private}:}
\DoxyCodeLine{231     \textcolor{comment}{//==============================================================================}}
\DoxyCodeLine{232     \textcolor{keywordtype}{void} recalculateRates() noexcept}
\DoxyCodeLine{233     \{}
\DoxyCodeLine{234         \textcolor{keyword}{auto} getRate = [] (\textcolor{keywordtype}{float} \mbox{\hyperlink{namespacegl_a183930cfb90912db497a30515e33eb70}{distance}}, \textcolor{keywordtype}{float} timeInSeconds, \textcolor{keywordtype}{double} sr)}
\DoxyCodeLine{235         \{}
\DoxyCodeLine{236             \textcolor{keywordflow}{return} timeInSeconds > 0.0f ? (float) (\mbox{\hyperlink{namespacegl_a183930cfb90912db497a30515e33eb70}{distance}} / (timeInSeconds * sr)) : -\/1.0f;}
\DoxyCodeLine{237         \};}
\DoxyCodeLine{238 }
\DoxyCodeLine{239         attackRate  = getRate (1.0f, parameters.attack, \mbox{\hyperlink{juce__linux___a_l_s_a_8cpp_a2bd79d2ab2dfb6aeaf75c2878ad30e1f}{sampleRate}});}
\DoxyCodeLine{240         decayRate   = getRate (1.0f -\/ parameters.sustain, parameters.decay, \mbox{\hyperlink{juce__linux___a_l_s_a_8cpp_a2bd79d2ab2dfb6aeaf75c2878ad30e1f}{sampleRate}});}
\DoxyCodeLine{241         releaseRate = getRate (parameters.sustain, parameters.release, \mbox{\hyperlink{juce__linux___a_l_s_a_8cpp_a2bd79d2ab2dfb6aeaf75c2878ad30e1f}{sampleRate}});}
\DoxyCodeLine{242 }
\DoxyCodeLine{243         \textcolor{keywordflow}{if} ((state == State::attack \&\& attackRate <= 0.0f)}
\DoxyCodeLine{244             || (state == State::decay \&\& (decayRate <= 0.0f || envelopeVal <= parameters.sustain))}
\DoxyCodeLine{245             || (state == State::release \&\& releaseRate <= 0.0f))}
\DoxyCodeLine{246         \{}
\DoxyCodeLine{247             goToNextState();}
\DoxyCodeLine{248         \}}
\DoxyCodeLine{249     \}}
\DoxyCodeLine{250 }
\DoxyCodeLine{251     \textcolor{keywordtype}{void} goToNextState() noexcept}
\DoxyCodeLine{252     \{}
\DoxyCodeLine{253         \textcolor{keywordflow}{if} (state == State::attack)}
\DoxyCodeLine{254             state = (decayRate > 0.0f ? State::decay : State::sustain);}
\DoxyCodeLine{255         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (state == State::decay)}
\DoxyCodeLine{256             state = State::sustain;}
\DoxyCodeLine{257         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (state == State::release)}
\DoxyCodeLine{258             \mbox{\hyperlink{namespacegl_a3b437ea454d772211296e220c025bdd2}{reset}}();}
\DoxyCodeLine{259     \}}
\DoxyCodeLine{260 }
\DoxyCodeLine{261     \textcolor{comment}{//==============================================================================}}
\DoxyCodeLine{262     \textcolor{keyword}{enum class} State \{ idle, attack, decay, sustain, release \};}
\DoxyCodeLine{263 }
\DoxyCodeLine{264     State state = State::idle;}
\DoxyCodeLine{265     Parameters parameters;}
\DoxyCodeLine{266 }
\DoxyCodeLine{267     \textcolor{keywordtype}{double} \mbox{\hyperlink{juce__linux___a_l_s_a_8cpp_a2bd79d2ab2dfb6aeaf75c2878ad30e1f}{sampleRate}} = 44100.0;}
\DoxyCodeLine{268     \textcolor{keywordtype}{float} envelopeVal = 0.0f, attackRate = 0.0f, decayRate = 0.0f, releaseRate = 0.0f;}
\DoxyCodeLine{269 \};}
\DoxyCodeLine{270 }
\DoxyCodeLine{271  \textcolor{comment}{// namespace juce}}
\DoxyCodeLine{272 }

\end{DoxyCode}
