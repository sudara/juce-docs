\hypertarget{_quirks_manager_8h_source}{}\doxysection{Quirks\+Manager.\+h}
\label{_quirks_manager_8h_source}\index{build/juce\_audio\_devices/native/oboe/src/common/QuirksManager.h@{build/juce\_audio\_devices/native/oboe/src/common/QuirksManager.h}}
\mbox{\hyperlink{_quirks_manager_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{/*}}
\DoxyCodeLine{2 \textcolor{comment}{ * Copyright 2019 The Android Open Source Project}}
\DoxyCodeLine{3 \textcolor{comment}{ *}}
\DoxyCodeLine{4 \textcolor{comment}{ * Licensed under the Apache License, Version 2.0 (the "{}License"{});}}
\DoxyCodeLine{5 \textcolor{comment}{ * you may not use this file except in compliance with the License.}}
\DoxyCodeLine{6 \textcolor{comment}{ * You may obtain a copy of the License at}}
\DoxyCodeLine{7 \textcolor{comment}{ *}}
\DoxyCodeLine{8 \textcolor{comment}{ *      http://www.apache.org/licenses/LICENSE-\/2.0}}
\DoxyCodeLine{9 \textcolor{comment}{ *}}
\DoxyCodeLine{10 \textcolor{comment}{ * Unless required by applicable law or agreed to in writing, software}}
\DoxyCodeLine{11 \textcolor{comment}{ * distributed under the License is distributed on an "{}AS IS"{} BASIS,}}
\DoxyCodeLine{12 \textcolor{comment}{ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.}}
\DoxyCodeLine{13 \textcolor{comment}{ * See the License for the specific language governing permissions and}}
\DoxyCodeLine{14 \textcolor{comment}{ * limitations under the License.}}
\DoxyCodeLine{15 \textcolor{comment}{ */}}
\DoxyCodeLine{16 }
\DoxyCodeLine{17 \textcolor{preprocessor}{\#ifndef OBOE\_QUIRKS\_MANAGER\_H}}
\DoxyCodeLine{18 \textcolor{preprocessor}{\#define OBOE\_QUIRKS\_MANAGER\_H}}
\DoxyCodeLine{19 }
\DoxyCodeLine{20 \textcolor{preprocessor}{\#include <memory>}}
\DoxyCodeLine{21 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{_audio_stream_builder_8h}{oboe/AudioStreamBuilder.h}}>}}
\DoxyCodeLine{22 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{_audio_stream_a_audio_8h}{aaudio/AudioStreamAAudio.h}}>}}
\DoxyCodeLine{23 }
\DoxyCodeLine{24 \textcolor{preprocessor}{\#ifndef \_\_ANDROID\_API\_R\_\_}}
\DoxyCodeLine{25 \textcolor{preprocessor}{\#define \_\_ANDROID\_API\_R\_\_ 30}}
\DoxyCodeLine{26 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{27 }
\DoxyCodeLine{28 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespaceoboe}{oboe}} \{}
\DoxyCodeLine{29 }
\DoxyCodeLine{39 \textcolor{keyword}{class }\mbox{\hyperlink{classoboe_1_1_quirks_manager}{QuirksManager}} \{}
\DoxyCodeLine{40 \textcolor{keyword}{public}:}
\DoxyCodeLine{41 }
\DoxyCodeLine{42     \textcolor{keyword}{static} \mbox{\hyperlink{classoboe_1_1_quirks_manager}{QuirksManager}} \&\mbox{\hyperlink{classoboe_1_1_quirks_manager_a8e927e62feb600eab1cfcb521ba2671c}{getInstance}}() \{}
\DoxyCodeLine{43         \textcolor{keyword}{static} \mbox{\hyperlink{classoboe_1_1_quirks_manager}{QuirksManager}} instance; \textcolor{comment}{// singleton}}
\DoxyCodeLine{44         \textcolor{keywordflow}{return} instance;}
\DoxyCodeLine{45     \}}
\DoxyCodeLine{46 }
\DoxyCodeLine{47     \mbox{\hyperlink{classoboe_1_1_quirks_manager_a19b22860cc2df557e7aadf79fe396082}{QuirksManager}}();}
\DoxyCodeLine{48     \textcolor{keyword}{virtual} \mbox{\hyperlink{classoboe_1_1_quirks_manager_a0d1607c46e496aa23d6e1f1e159bb9d6}{\string~QuirksManager}}() = \textcolor{keywordflow}{default};}
\DoxyCodeLine{49 }
\DoxyCodeLine{59     \textcolor{keywordtype}{bool} \mbox{\hyperlink{classoboe_1_1_quirks_manager_a82be77612bbb7dd0cdd04a92b3d28883}{isConversionNeeded}}(\textcolor{keyword}{const} \mbox{\hyperlink{classoboe_1_1_audio_stream_builder}{AudioStreamBuilder}} \&builder, \mbox{\hyperlink{classoboe_1_1_audio_stream_builder}{AudioStreamBuilder}} \&childBuilder);}
\DoxyCodeLine{60 }
\DoxyCodeLine{61     \textcolor{keyword}{static} \textcolor{keywordtype}{bool} \mbox{\hyperlink{classoboe_1_1_quirks_manager_a0222fd10db4debe0a7c17d9f0a087cef}{isMMapUsed}}(\mbox{\hyperlink{classoboe_1_1_audio_stream}{AudioStream}} \&\mbox{\hyperlink{namespacegl_a3a0f500782e4461d09f1e29189835b3d}{stream}}) \{}
\DoxyCodeLine{62         \textcolor{keywordtype}{bool} answer = \textcolor{keyword}{false};}
\DoxyCodeLine{63         \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespacegl_a3a0f500782e4461d09f1e29189835b3d}{stream}}.getAudioApi() == \mbox{\hyperlink{namespaceoboe_a92972414867c81d5974cb2ed7abefbf6a99780b1e8d754eb42abed0ca5253e55b}{AudioApi::AAudio}}) \{}
\DoxyCodeLine{64             \mbox{\hyperlink{classoboe_1_1_audio_stream_a_audio}{AudioStreamAAudio}} *streamAAudio =}
\DoxyCodeLine{65                     \textcolor{keyword}{reinterpret\_cast<}\mbox{\hyperlink{classoboe_1_1_audio_stream_a_audio}{AudioStreamAAudio}} *\textcolor{keyword}{>}(\&\mbox{\hyperlink{namespacegl_a3a0f500782e4461d09f1e29189835b3d}{stream}});}
\DoxyCodeLine{66             answer = streamAAudio-\/>\mbox{\hyperlink{classoboe_1_1_audio_stream_a_audio_aa68e63179fe07749d29bc31bb03bc6b9}{isMMapUsed}}();}
\DoxyCodeLine{67         \}}
\DoxyCodeLine{68         \textcolor{keywordflow}{return} answer;}
\DoxyCodeLine{69     \}}
\DoxyCodeLine{70 }
\DoxyCodeLine{71     \textcolor{keyword}{virtual} int32\_t \mbox{\hyperlink{classoboe_1_1_quirks_manager_a9b2c61643c5c3229837a4844ca4d1f96}{clipBufferSize}}(\mbox{\hyperlink{classoboe_1_1_audio_stream}{AudioStream}} \&\mbox{\hyperlink{namespacegl_a3a0f500782e4461d09f1e29189835b3d}{stream}}, int32\_t \mbox{\hyperlink{juce__linux___a_l_s_a_8cpp_a8556d19b129aa550f5b2819ed0320e83}{bufferSize}}) \{}
\DoxyCodeLine{72         \textcolor{keywordflow}{return} mDeviceQuirks-\/>clipBufferSize(\mbox{\hyperlink{namespacegl_a3a0f500782e4461d09f1e29189835b3d}{stream}}, \mbox{\hyperlink{juce__linux___a_l_s_a_8cpp_a8556d19b129aa550f5b2819ed0320e83}{bufferSize}});}
\DoxyCodeLine{73     \}}
\DoxyCodeLine{74 }
\DoxyCodeLine{75     \textcolor{keyword}{class }\mbox{\hyperlink{classoboe_1_1_quirks_manager_1_1_device_quirks}{DeviceQuirks}} \{}
\DoxyCodeLine{76     \textcolor{keyword}{public}:}
\DoxyCodeLine{77         \textcolor{keyword}{virtual} \mbox{\hyperlink{classoboe_1_1_quirks_manager_1_1_device_quirks_ab5b36c8cada4caa0d90c63cf2f9e5eb4}{\string~DeviceQuirks}}() = \textcolor{keywordflow}{default};}
\DoxyCodeLine{78 }
\DoxyCodeLine{86         int32\_t \mbox{\hyperlink{classoboe_1_1_quirks_manager_1_1_device_quirks_a12e5851528ad98c024ecfad84ae34823}{clipBufferSize}}(\mbox{\hyperlink{classoboe_1_1_audio_stream}{AudioStream}} \&\mbox{\hyperlink{namespacegl_a3a0f500782e4461d09f1e29189835b3d}{stream}}, int32\_t requestedSize);}
\DoxyCodeLine{87 }
\DoxyCodeLine{88         \textcolor{comment}{// Exclusive MMAP streams can have glitches because they are using a timing}}
\DoxyCodeLine{89         \textcolor{comment}{// model of the DSP to control IO instead of direct synchronization.}}
\DoxyCodeLine{90         \textcolor{keyword}{virtual} int32\_t \mbox{\hyperlink{classoboe_1_1_quirks_manager_1_1_device_quirks_a7388931e91647d40cfd563e8f2f5df52}{getExclusiveBottomMarginInBursts}}()\textcolor{keyword}{ const }\{}
\DoxyCodeLine{91             \textcolor{keywordflow}{return} \mbox{\hyperlink{classoboe_1_1_quirks_manager_1_1_device_quirks_aeb4c6772047183278551f7e97b1e0a70}{kDefaultBottomMarginInBursts}};}
\DoxyCodeLine{92         \}}
\DoxyCodeLine{93 }
\DoxyCodeLine{94         \textcolor{keyword}{virtual} int32\_t \mbox{\hyperlink{classoboe_1_1_quirks_manager_1_1_device_quirks_a4d6f2dc23efad55506890b3d60f6f60a}{getExclusiveTopMarginInBursts}}()\textcolor{keyword}{ const }\{}
\DoxyCodeLine{95             \textcolor{keywordflow}{return} \mbox{\hyperlink{classoboe_1_1_quirks_manager_1_1_device_quirks_ab59bd2901a9a7ea4c703ebd93cc233a8}{kDefaultTopMarginInBursts}};}
\DoxyCodeLine{96         \}}
\DoxyCodeLine{97 }
\DoxyCodeLine{98         \textcolor{comment}{// On some devices, you can open a mono stream but it is actually running in stereo!}}
\DoxyCodeLine{99         \textcolor{keyword}{virtual} \textcolor{keywordtype}{bool} \mbox{\hyperlink{classoboe_1_1_quirks_manager_1_1_device_quirks_a1c9570f29ccd31f64a81289a386fde01}{isMonoMMapActuallyStereo}}()\textcolor{keyword}{ const }\{}
\DoxyCodeLine{100             \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{101         \}}
\DoxyCodeLine{102 }
\DoxyCodeLine{103         \textcolor{keyword}{virtual} \textcolor{keywordtype}{bool} \mbox{\hyperlink{classoboe_1_1_quirks_manager_1_1_device_quirks_ab51f1e830912c318f2af146f3f535135}{isAAudioMMapPossible}}(\textcolor{keyword}{const} \mbox{\hyperlink{classoboe_1_1_audio_stream_builder}{AudioStreamBuilder}} \&builder) \textcolor{keyword}{const};}
\DoxyCodeLine{104 }
\DoxyCodeLine{105         \textcolor{keyword}{virtual} \textcolor{keywordtype}{bool} \mbox{\hyperlink{classoboe_1_1_quirks_manager_1_1_device_quirks_a8f5d0fae0caa0e6a90747b849b5585c0}{isMMapSafe}}(\textcolor{keyword}{const} \mbox{\hyperlink{classoboe_1_1_audio_stream_builder}{AudioStreamBuilder}} \& \textcolor{comment}{/* builder */} ) \{}
\DoxyCodeLine{106             \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{107         \}}
\DoxyCodeLine{108 }
\DoxyCodeLine{109         \textcolor{keyword}{static} \textcolor{keyword}{constexpr} int32\_t \mbox{\hyperlink{classoboe_1_1_quirks_manager_1_1_device_quirks_aeb4c6772047183278551f7e97b1e0a70}{kDefaultBottomMarginInBursts}} = 0;}
\DoxyCodeLine{110         \textcolor{keyword}{static} \textcolor{keyword}{constexpr} int32\_t \mbox{\hyperlink{classoboe_1_1_quirks_manager_1_1_device_quirks_ab59bd2901a9a7ea4c703ebd93cc233a8}{kDefaultTopMarginInBursts}} = 0;}
\DoxyCodeLine{111 }
\DoxyCodeLine{112         \textcolor{comment}{// For Legacy streams, do not let the buffer go below one burst.}}
\DoxyCodeLine{113         \textcolor{comment}{// b/129545119 | AAudio Legacy allows setBufferSizeInFrames too low}}
\DoxyCodeLine{114         \textcolor{comment}{// Fixed in Q}}
\DoxyCodeLine{115         \textcolor{keyword}{static} \textcolor{keyword}{constexpr} int32\_t \mbox{\hyperlink{classoboe_1_1_quirks_manager_1_1_device_quirks_ad89794146504211ce05227eed19236a4}{kLegacyBottomMarginInBursts}} = 1;}
\DoxyCodeLine{116         \textcolor{keyword}{static} \textcolor{keyword}{constexpr} int32\_t \mbox{\hyperlink{classoboe_1_1_quirks_manager_1_1_device_quirks_a027cb833b05d2bcaff73bc5706d2857b}{kCommonNativeRate}} = 48000; \textcolor{comment}{// very typical native sample rate}}
\DoxyCodeLine{117     \};}
\DoxyCodeLine{118 }
\DoxyCodeLine{119     \textcolor{keywordtype}{bool} \mbox{\hyperlink{classoboe_1_1_quirks_manager_aea579024a90d30fb71052ceb8f1ac3c1}{isMMapSafe}}(\mbox{\hyperlink{classoboe_1_1_audio_stream_builder}{AudioStreamBuilder}} \&builder);}
\DoxyCodeLine{120 }
\DoxyCodeLine{121 \textcolor{keyword}{private}:}
\DoxyCodeLine{122 }
\DoxyCodeLine{123     \textcolor{keyword}{static} \textcolor{keyword}{constexpr} int32\_t kChannelCountMono = 1;}
\DoxyCodeLine{124     \textcolor{keyword}{static} \textcolor{keyword}{constexpr} int32\_t kChannelCountStereo = 2;}
\DoxyCodeLine{125 }
\DoxyCodeLine{126     std::unique\_ptr<DeviceQuirks> mDeviceQuirks\{\};}
\DoxyCodeLine{127 }
\DoxyCodeLine{128 \};}
\DoxyCodeLine{129 }
\DoxyCodeLine{130 \}}
\DoxyCodeLine{131 \textcolor{preprocessor}{\#endif }\textcolor{comment}{//OBOE\_QUIRKS\_MANAGER\_H}}

\end{DoxyCode}
