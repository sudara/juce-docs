\hypertarget{juce___u_m_p_midi1_to_bytestream_translator_8h_source}{}\doxysection{juce\+\_\+\+UMPMidi1\+To\+Bytestream\+Translator.\+h}
\label{juce___u_m_p_midi1_to_bytestream_translator_8h_source}\index{build/juce\_audio\_basics/midi/ump/juce\_UMPMidi1ToBytestreamTranslator.h@{build/juce\_audio\_basics/midi/ump/juce\_UMPMidi1ToBytestreamTranslator.h}}
\mbox{\hyperlink{juce___u_m_p_midi1_to_bytestream_translator_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 }
\DoxyCodeLine{5 \textcolor{comment}{/*}}
\DoxyCodeLine{6 \textcolor{comment}{  ==============================================================================}}
\DoxyCodeLine{7 \textcolor{comment}{}}
\DoxyCodeLine{8 \textcolor{comment}{   This file is part of the JUCE library.}}
\DoxyCodeLine{9 \textcolor{comment}{   Copyright (c) 2020 -\/ Raw Material Software Limited}}
\DoxyCodeLine{10 \textcolor{comment}{}}
\DoxyCodeLine{11 \textcolor{comment}{   JUCE is an open source library subject to commercial or open-\/source}}
\DoxyCodeLine{12 \textcolor{comment}{   licensing.}}
\DoxyCodeLine{13 \textcolor{comment}{}}
\DoxyCodeLine{14 \textcolor{comment}{   The code included in this file is provided under the terms of the ISC license}}
\DoxyCodeLine{15 \textcolor{comment}{   http://www.isc.org/downloads/software-\/support-\/policy/isc-\/license. Permission}}
\DoxyCodeLine{16 \textcolor{comment}{   To use, copy, modify, and/or distribute this software for any purpose with or}}
\DoxyCodeLine{17 \textcolor{comment}{   without fee is hereby granted provided that the above copyright notice and}}
\DoxyCodeLine{18 \textcolor{comment}{   this permission notice appear in all copies.}}
\DoxyCodeLine{19 \textcolor{comment}{}}
\DoxyCodeLine{20 \textcolor{comment}{   JUCE IS PROVIDED "{}AS IS"{} WITHOUT ANY WARRANTY, AND ALL WARRANTIES, WHETHER}}
\DoxyCodeLine{21 \textcolor{comment}{   EXPRESSED OR IMPLIED, INCLUDING MERCHANTABILITY AND FITNESS FOR PURPOSE, ARE}}
\DoxyCodeLine{22 \textcolor{comment}{   DISCLAIMED.}}
\DoxyCodeLine{23 \textcolor{comment}{}}
\DoxyCodeLine{24 \textcolor{comment}{  ==============================================================================}}
\DoxyCodeLine{25 \textcolor{comment}{*/}}
\DoxyCodeLine{26 }
\DoxyCodeLine{27 \textcolor{preprocessor}{\#ifndef DOXYGEN}}
\DoxyCodeLine{28 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespaceuniversal__midi__packets}{universal\_midi\_packets}}}
\DoxyCodeLine{29 \{}
\DoxyCodeLine{30 }
\DoxyCodeLine{37 \textcolor{keyword}{class }\mbox{\hyperlink{classuniversal__midi__packets_1_1_midi1_to_bytestream_translator}{Midi1ToBytestreamTranslator}}}
\DoxyCodeLine{38 \{}
\DoxyCodeLine{39 \textcolor{keyword}{public}:}
\DoxyCodeLine{43     \textcolor{keyword}{explicit} \mbox{\hyperlink{classuniversal__midi__packets_1_1_midi1_to_bytestream_translator_a3123dfbb52e2bfc79e191b38f297c9d8}{Midi1ToBytestreamTranslator}} (\textcolor{keywordtype}{int} initialBufferSize)}
\DoxyCodeLine{44     \{}
\DoxyCodeLine{45         pendingSysExData.reserve (\textcolor{keywordtype}{size\_t} (initialBufferSize));}
\DoxyCodeLine{46     \}}
\DoxyCodeLine{47 }
\DoxyCodeLine{49     \textcolor{keywordtype}{void} \mbox{\hyperlink{classuniversal__midi__packets_1_1_midi1_to_bytestream_translator_a5f362659e25a4653f695a3394b7b512d}{reset}}()}
\DoxyCodeLine{50     \{}
\DoxyCodeLine{51         pendingSysExData.clear();}
\DoxyCodeLine{52         pendingSysExTime = 0.0;}
\DoxyCodeLine{53     \}}
\DoxyCodeLine{54 }
\DoxyCodeLine{63     \textcolor{keyword}{template} <\textcolor{keyword}{typename} MessageCallback>}
\DoxyCodeLine{64     \textcolor{keywordtype}{void} \mbox{\hyperlink{classuniversal__midi__packets_1_1_midi1_to_bytestream_translator_ac7120940a85193b3535f1ba57368b3e5}{dispatch}} (\textcolor{keyword}{const} \mbox{\hyperlink{classuniversal__midi__packets_1_1_view}{View}}\& packet, \textcolor{keywordtype}{double} time, MessageCallback\&\& \mbox{\hyperlink{juce__linux___a_l_s_a_8cpp_a7d161ccbd94169c2108f6a40711e3a76}{callback}})}
\DoxyCodeLine{65     \{}
\DoxyCodeLine{66         \textcolor{keyword}{const} \textcolor{keyword}{auto} firstWord = *packet.\mbox{\hyperlink{classuniversal__midi__packets_1_1_view_a6194325c6240fd4a8f3f84731a185493}{data}}();}
\DoxyCodeLine{67 }
\DoxyCodeLine{68         \textcolor{keywordflow}{if} (! pendingSysExData.empty() \&\& shouldPacketTerminateSysExEarly (firstWord))}
\DoxyCodeLine{69             pendingSysExData.clear();}
\DoxyCodeLine{70 }
\DoxyCodeLine{71         \textcolor{keywordflow}{switch} (packet.\mbox{\hyperlink{classuniversal__midi__packets_1_1_view_a3a2f852c4d57056eafd03105c5283ef3}{size}}())}
\DoxyCodeLine{72         \{}
\DoxyCodeLine{73             \textcolor{keywordflow}{case} 1:}
\DoxyCodeLine{74             \{}
\DoxyCodeLine{75                 \textcolor{comment}{// Utility messages don't translate to bytestream format}}
\DoxyCodeLine{76                 \textcolor{keywordflow}{if} (\mbox{\hyperlink{structuniversal__midi__packets_1_1_utils_aa8f83c90a4548bcb1f078f0fad117fbc}{Utils::getMessageType}} (firstWord) != 0x00)}
\DoxyCodeLine{77                     \mbox{\hyperlink{juce__linux___a_l_s_a_8cpp_a7d161ccbd94169c2108f6a40711e3a76}{callback}} (\mbox{\hyperlink{classuniversal__midi__packets_1_1_midi1_to_bytestream_translator_ad028f6448c258029bcc4a088909e7680}{fromUmp}} (\mbox{\hyperlink{classuniversal__midi__packets_1_1_packet}{PacketX1}} \{ firstWord \}, time));}
\DoxyCodeLine{78 }
\DoxyCodeLine{79                 \textcolor{keywordflow}{break};}
\DoxyCodeLine{80             \}}
\DoxyCodeLine{81 }
\DoxyCodeLine{82             \textcolor{keywordflow}{case} 2:}
\DoxyCodeLine{83             \{}
\DoxyCodeLine{84                 \textcolor{keywordflow}{if} (\mbox{\hyperlink{structuniversal__midi__packets_1_1_utils_aa8f83c90a4548bcb1f078f0fad117fbc}{Utils::getMessageType}} (firstWord) == 0x3)}
\DoxyCodeLine{85                     processSysEx (\mbox{\hyperlink{classuniversal__midi__packets_1_1_packet}{PacketX2}} \{ packet[0], packet[1] \}, time, \mbox{\hyperlink{juce__linux___a_l_s_a_8cpp_a7d161ccbd94169c2108f6a40711e3a76}{callback}});}
\DoxyCodeLine{86 }
\DoxyCodeLine{87                 \textcolor{keywordflow}{break};}
\DoxyCodeLine{88             \}}
\DoxyCodeLine{89 }
\DoxyCodeLine{90             \textcolor{keywordflow}{case} 3:  \textcolor{comment}{// no 3-\/word packets in the current spec}}
\DoxyCodeLine{91             \textcolor{keywordflow}{case} 4:  \textcolor{comment}{// no 4-\/word packets translate to bytestream format}}
\DoxyCodeLine{92             \textcolor{keywordflow}{default}:}
\DoxyCodeLine{93                 \textcolor{keywordflow}{break};}
\DoxyCodeLine{94         \}}
\DoxyCodeLine{95     \}}
\DoxyCodeLine{96 }
\DoxyCodeLine{107     \textcolor{keyword}{static} \mbox{\hyperlink{class_midi_message}{MidiMessage}} \mbox{\hyperlink{classuniversal__midi__packets_1_1_midi1_to_bytestream_translator_ad028f6448c258029bcc4a088909e7680}{fromUmp}} (\textcolor{keyword}{const} \mbox{\hyperlink{classuniversal__midi__packets_1_1_packet}{PacketX1}}\& \mbox{\hyperlink{namespacegl_a0927a7b4232e61481fa501d12209467e}{m}}, \textcolor{keywordtype}{double} time = 0)}
\DoxyCodeLine{108     \{}
\DoxyCodeLine{109         \textcolor{keyword}{const} \textcolor{keyword}{auto} word = \mbox{\hyperlink{namespacegl_a0927a7b4232e61481fa501d12209467e}{m}}.front();}
\DoxyCodeLine{110         \mbox{\hyperlink{group__juce__core-system_ga1f96ab6751237979b907a54f52a7296a}{jassert}} (\mbox{\hyperlink{structuniversal__midi__packets_1_1_utils_ab8be369da2c35963dda3db2221d660f4}{Utils::getNumWordsForMessageType}} (word) == 1);}
\DoxyCodeLine{111 }
\DoxyCodeLine{112         \textcolor{keyword}{const} std::array<uint8\_t, 3> bytes \{ \{ uint8\_t ((word >> 0x10) \& 0xff),}
\DoxyCodeLine{113                                                uint8\_t ((word >> 0x08) \& 0xff),}
\DoxyCodeLine{114                                                uint8\_t ((word >> 0x00) \& 0xff) \} \};}
\DoxyCodeLine{115         \textcolor{keyword}{const} \textcolor{keyword}{auto} numBytes = \mbox{\hyperlink{class_midi_message_a5e312ea62140d65cb63af27e9469e183}{MidiMessage::getMessageLengthFromFirstByte}} (bytes.front());}
\DoxyCodeLine{116         \textcolor{keywordflow}{return} \mbox{\hyperlink{class_midi_message}{MidiMessage}} (bytes.data(), numBytes, time);}
\DoxyCodeLine{117     \}}
\DoxyCodeLine{118 }
\DoxyCodeLine{119 \textcolor{keyword}{private}:}
\DoxyCodeLine{120     \textcolor{keyword}{template} <\textcolor{keyword}{typename} MessageCallback>}
\DoxyCodeLine{121     \textcolor{keywordtype}{void} processSysEx (\textcolor{keyword}{const} \mbox{\hyperlink{classuniversal__midi__packets_1_1_packet}{PacketX2}}\& packet,}
\DoxyCodeLine{122                        \textcolor{keywordtype}{double} time,}
\DoxyCodeLine{123                        MessageCallback\&\& \mbox{\hyperlink{juce__linux___a_l_s_a_8cpp_a7d161ccbd94169c2108f6a40711e3a76}{callback}})}
\DoxyCodeLine{124     \{}
\DoxyCodeLine{125         \textcolor{keywordflow}{switch} (getSysEx7Kind (packet[0]))}
\DoxyCodeLine{126         \{}
\DoxyCodeLine{127             \textcolor{keywordflow}{case} \mbox{\hyperlink{structuniversal__midi__packets_1_1_sys_ex7_a67bd6a32171669c700c401784e38da00ad9a22d7a8178d5b42a8750123cbfe5b1}{SysEx7::Kind::complete}}:}
\DoxyCodeLine{128                 startSysExMessage (time);}
\DoxyCodeLine{129                 pushBytes (packet);}
\DoxyCodeLine{130                 terminateSysExMessage (\mbox{\hyperlink{juce__linux___a_l_s_a_8cpp_a7d161ccbd94169c2108f6a40711e3a76}{callback}});}
\DoxyCodeLine{131                 \textcolor{keywordflow}{break};}
\DoxyCodeLine{132 }
\DoxyCodeLine{133             \textcolor{keywordflow}{case} \mbox{\hyperlink{structuniversal__midi__packets_1_1_sys_ex7_a67bd6a32171669c700c401784e38da00a8d589afa4dfaeeed85fff5aa78e5ff6a}{SysEx7::Kind::begin}}:}
\DoxyCodeLine{134                 startSysExMessage (time);}
\DoxyCodeLine{135                 pushBytes (packet);}
\DoxyCodeLine{136                 \textcolor{keywordflow}{break};}
\DoxyCodeLine{137 }
\DoxyCodeLine{138             \textcolor{keywordflow}{case} \mbox{\hyperlink{structuniversal__midi__packets_1_1_sys_ex7_a67bd6a32171669c700c401784e38da00a8b822ac5b82aa7c75a7f7f37fe6ff797}{SysEx7::Kind::continuation}}:}
\DoxyCodeLine{139                 \textcolor{keywordflow}{if} (pendingSysExData.empty())}
\DoxyCodeLine{140                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{141 }
\DoxyCodeLine{142                 pushBytes (packet);}
\DoxyCodeLine{143                 \textcolor{keywordflow}{break};}
\DoxyCodeLine{144 }
\DoxyCodeLine{145             \textcolor{keywordflow}{case} \mbox{\hyperlink{structuniversal__midi__packets_1_1_sys_ex7_a67bd6a32171669c700c401784e38da00a7f021a1415b86f2d013b2618fb31ae53}{SysEx7::Kind::end}}:}
\DoxyCodeLine{146                 \textcolor{keywordflow}{if} (pendingSysExData.empty())}
\DoxyCodeLine{147                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{148 }
\DoxyCodeLine{149                 pushBytes (packet);}
\DoxyCodeLine{150                 terminateSysExMessage (\mbox{\hyperlink{juce__linux___a_l_s_a_8cpp_a7d161ccbd94169c2108f6a40711e3a76}{callback}});}
\DoxyCodeLine{151                 \textcolor{keywordflow}{break};}
\DoxyCodeLine{152         \}}
\DoxyCodeLine{153     \}}
\DoxyCodeLine{154 }
\DoxyCodeLine{155     \textcolor{keywordtype}{void} pushBytes (\textcolor{keyword}{const} \mbox{\hyperlink{namespaceuniversal__midi__packets_aaed1d831a4a30fb100391efde3aae458}{PacketX2}}\& packet)}
\DoxyCodeLine{156     \{}
\DoxyCodeLine{157         \textcolor{keyword}{const} \textcolor{keyword}{auto} bytes = \mbox{\hyperlink{structuniversal__midi__packets_1_1_sys_ex7_a6446b6a130ba1437bc73f57d03770ac3}{SysEx7::getDataBytes}} (packet);}
\DoxyCodeLine{158         pendingSysExData.insert (pendingSysExData.end(),}
\DoxyCodeLine{159                                  bytes.data.begin(),}
\DoxyCodeLine{160                                  bytes.data.begin() + bytes.size);}
\DoxyCodeLine{161     \}}
\DoxyCodeLine{162 }
\DoxyCodeLine{163     \textcolor{keywordtype}{void} startSysExMessage (\textcolor{keywordtype}{double} time)}
\DoxyCodeLine{164     \{}
\DoxyCodeLine{165         pendingSysExTime = time;}
\DoxyCodeLine{166         pendingSysExData.push\_back (0xf0);}
\DoxyCodeLine{167     \}}
\DoxyCodeLine{168 }
\DoxyCodeLine{169     \textcolor{keyword}{template} <\textcolor{keyword}{typename} MessageCallback>}
\DoxyCodeLine{170     \textcolor{keywordtype}{void} terminateSysExMessage (MessageCallback\&\& \mbox{\hyperlink{juce__linux___a_l_s_a_8cpp_a7d161ccbd94169c2108f6a40711e3a76}{callback}})}
\DoxyCodeLine{171     \{}
\DoxyCodeLine{172         pendingSysExData.push\_back (0xf7);}
\DoxyCodeLine{173         \mbox{\hyperlink{juce__linux___a_l_s_a_8cpp_a7d161ccbd94169c2108f6a40711e3a76}{callback}} (\mbox{\hyperlink{class_midi_message}{MidiMessage}} (pendingSysExData.data(),}
\DoxyCodeLine{174                                \mbox{\hyperlink{group__juce__audio__plugin__client-_unity_ga966b05a42d98c7296097e073c627dcd0}{int}} (pendingSysExData.size()),}
\DoxyCodeLine{175                                pendingSysExTime));}
\DoxyCodeLine{176         pendingSysExData.clear();}
\DoxyCodeLine{177     \}}
\DoxyCodeLine{178 }
\DoxyCodeLine{179     \textcolor{keyword}{static} \textcolor{keywordtype}{bool} shouldPacketTerminateSysExEarly (uint32\_t firstWord)}
\DoxyCodeLine{180     \{}
\DoxyCodeLine{181         \textcolor{keywordflow}{return} ! (isSysExContinuation (firstWord)}
\DoxyCodeLine{182                   || isSystemRealTime (firstWord)}
\DoxyCodeLine{183                   || isJROrNOP (firstWord));}
\DoxyCodeLine{184     \}}
\DoxyCodeLine{185 }
\DoxyCodeLine{186     \textcolor{keyword}{static} \mbox{\hyperlink{structuniversal__midi__packets_1_1_sys_ex7_a67bd6a32171669c700c401784e38da00}{SysEx7::Kind}} getSysEx7Kind (uint32\_t word)}
\DoxyCodeLine{187     \{}
\DoxyCodeLine{188         \textcolor{keywordflow}{return} \mbox{\hyperlink{structuniversal__midi__packets_1_1_sys_ex7_a67bd6a32171669c700c401784e38da00}{SysEx7::Kind}} ((word >> 0x14) \& 0xf);}
\DoxyCodeLine{189     \}}
\DoxyCodeLine{190 }
\DoxyCodeLine{191     \textcolor{keyword}{static} \textcolor{keywordtype}{bool} isJROrNOP (uint32\_t word)}
\DoxyCodeLine{192     \{}
\DoxyCodeLine{193         \textcolor{keywordflow}{return} \mbox{\hyperlink{structuniversal__midi__packets_1_1_utils_aa8f83c90a4548bcb1f078f0fad117fbc}{Utils::getMessageType}} (word) == 0x0;}
\DoxyCodeLine{194     \}}
\DoxyCodeLine{195 }
\DoxyCodeLine{196     \textcolor{keyword}{static} \textcolor{keywordtype}{bool} isSysExContinuation (uint32\_t word)}
\DoxyCodeLine{197     \{}
\DoxyCodeLine{198         \textcolor{keywordflow}{if} (\mbox{\hyperlink{structuniversal__midi__packets_1_1_utils_aa8f83c90a4548bcb1f078f0fad117fbc}{Utils::getMessageType}} (word) != 0x3)}
\DoxyCodeLine{199             \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{200 }
\DoxyCodeLine{201         \textcolor{keyword}{const} \textcolor{keyword}{auto} kind = getSysEx7Kind (word);}
\DoxyCodeLine{202         \textcolor{keywordflow}{return} kind == \mbox{\hyperlink{structuniversal__midi__packets_1_1_sys_ex7_a67bd6a32171669c700c401784e38da00a8b822ac5b82aa7c75a7f7f37fe6ff797}{SysEx7::Kind::continuation}} || kind == \mbox{\hyperlink{structuniversal__midi__packets_1_1_sys_ex7_a67bd6a32171669c700c401784e38da00a7f021a1415b86f2d013b2618fb31ae53}{SysEx7::Kind::end}};}
\DoxyCodeLine{203     \}}
\DoxyCodeLine{204 }
\DoxyCodeLine{205     \textcolor{keyword}{static} \textcolor{keywordtype}{bool} isSystemRealTime (uint32\_t word)}
\DoxyCodeLine{206     \{}
\DoxyCodeLine{207         \textcolor{keywordflow}{return} \mbox{\hyperlink{structuniversal__midi__packets_1_1_utils_aa8f83c90a4548bcb1f078f0fad117fbc}{Utils::getMessageType}} (word) == 0x1 \&\& ((\mbox{\hyperlink{namespacejuce_1_1_accessibility_text_helpers_a0457151ade54fef761e98bf17098a104ac47d187067c6cf953245f128b5fde62a}{word}} >> 0x10) \& 0xff) >= 0xf8;}
\DoxyCodeLine{208     \}}
\DoxyCodeLine{209 }
\DoxyCodeLine{210     std::vector<uint8\_t> pendingSysExData;}
\DoxyCodeLine{211 }
\DoxyCodeLine{212     \textcolor{keywordtype}{double} pendingSysExTime = 0.0;}
\DoxyCodeLine{213 \};}
\DoxyCodeLine{214 }
\DoxyCodeLine{215 \}}
\DoxyCodeLine{216 }
\DoxyCodeLine{217 }
\DoxyCodeLine{218 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{219 }

\end{DoxyCode}
