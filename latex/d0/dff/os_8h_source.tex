\hypertarget{os_8h_source}{}\doxysection{os.\+h}
\label{os_8h_source}\index{build/juce\_audio\_formats/codecs/oggvorbis/libvorbis-\/1.3.7/lib/os.h@{build/juce\_audio\_formats/codecs/oggvorbis/libvorbis-\/1.3.7/lib/os.h}}
\mbox{\hyperlink{os_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{preprocessor}{\#ifndef \_OS\_H}}
\DoxyCodeLine{2 \textcolor{preprocessor}{\#define \_OS\_H}}
\DoxyCodeLine{3 \textcolor{comment}{/********************************************************************}}
\DoxyCodeLine{4 \textcolor{comment}{ *                                                                  *}}
\DoxyCodeLine{5 \textcolor{comment}{ * THIS FILE IS PART OF THE OggVorbis SOFTWARE CODEC SOURCE CODE.   *}}
\DoxyCodeLine{6 \textcolor{comment}{ * USE, DISTRIBUTION AND REPRODUCTION OF THIS LIBRARY SOURCE IS     *}}
\DoxyCodeLine{7 \textcolor{comment}{ * GOVERNED BY A BSD-\/STYLE SOURCE LICENSE INCLUDED WITH THIS SOURCE *}}
\DoxyCodeLine{8 \textcolor{comment}{ * IN 'COPYING'. PLEASE READ THESE TERMS BEFORE DISTRIBUTING.       *}}
\DoxyCodeLine{9 \textcolor{comment}{ *                                                                  *}}
\DoxyCodeLine{10 \textcolor{comment}{ * THE OggVorbis SOURCE CODE IS (C) COPYRIGHT 1994-\/2015             *}}
\DoxyCodeLine{11 \textcolor{comment}{ * by the Xiph.Org Foundation https://xiph.org/                     *}}
\DoxyCodeLine{12 \textcolor{comment}{ *                                                                  *}}
\DoxyCodeLine{13 \textcolor{comment}{ ********************************************************************}}
\DoxyCodeLine{14 \textcolor{comment}{}}
\DoxyCodeLine{15 \textcolor{comment}{ function: \#ifdef jail to whip a few platforms into the UNIX ideal.}}
\DoxyCodeLine{16 \textcolor{comment}{}}
\DoxyCodeLine{17 \textcolor{comment}{ ********************************************************************/}}
\DoxyCodeLine{18 }
\DoxyCodeLine{19 \textcolor{preprocessor}{\#ifdef HAVE\_CONFIG\_H}}
\DoxyCodeLine{20 \textcolor{preprocessor}{\#include "{}config.h"{}}}
\DoxyCodeLine{21 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{22 }
\DoxyCodeLine{23 \textcolor{preprocessor}{\#include <math.h>}}
\DoxyCodeLine{24 \textcolor{preprocessor}{\#include "{}../../os\_types.h"{}}}
\DoxyCodeLine{25 }
\DoxyCodeLine{26 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{misc_8h}{misc.h}}"{}}}
\DoxyCodeLine{27 }
\DoxyCodeLine{28 \textcolor{preprocessor}{\#ifndef \_V\_IFDEFJAIL\_H\_}}
\DoxyCodeLine{29 \textcolor{preprocessor}{\#  define \_V\_IFDEFJAIL\_H\_}}
\DoxyCodeLine{30 }
\DoxyCodeLine{31 \textcolor{preprocessor}{\#  ifdef \_\_GNUC\_\_}}
\DoxyCodeLine{32 \textcolor{preprocessor}{\#    define STIN static \_\_inline\_\_}}
\DoxyCodeLine{33 \textcolor{preprocessor}{\#  elif \_WIN32}}
\DoxyCodeLine{34 \textcolor{preprocessor}{\#    define STIN static \_\_inline}}
\DoxyCodeLine{35 \textcolor{preprocessor}{\#  else}}
\DoxyCodeLine{36 \textcolor{preprocessor}{\#    define STIN static}}
\DoxyCodeLine{37 \textcolor{preprocessor}{\#  endif}}
\DoxyCodeLine{38 }
\DoxyCodeLine{39 \textcolor{preprocessor}{\#ifdef DJGPP}}
\DoxyCodeLine{40 \textcolor{preprocessor}{\#  define rint(x)   (floor((x)+0.5f))}}
\DoxyCodeLine{41 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{42 }
\DoxyCodeLine{43 \textcolor{preprocessor}{\#ifndef M\_PI}}
\DoxyCodeLine{44 \textcolor{preprocessor}{\#  define M\_PI (3.1415926536f)}}
\DoxyCodeLine{45 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{46 }
\DoxyCodeLine{47 \textcolor{preprocessor}{\#if defined(\_WIN32) \&\& !defined(\_\_SYMBIAN32\_\_)}}
\DoxyCodeLine{48 \textcolor{preprocessor}{\#  include <malloc.h>}}
\DoxyCodeLine{49 \textcolor{preprocessor}{\#  define rint(x)   (floor((x)+0.5f))}}
\DoxyCodeLine{50 \textcolor{preprocessor}{\#  define NO\_FLOAT\_MATH\_LIB}}
\DoxyCodeLine{51 \textcolor{preprocessor}{\#  define FAST\_HYPOT(a, b) sqrt((a)*(a) + (b)*(b))}}
\DoxyCodeLine{52 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{53 }
\DoxyCodeLine{54 \textcolor{preprocessor}{\#if defined(\_\_SYMBIAN32\_\_) \&\& defined(\_\_WINS\_\_)}}
\DoxyCodeLine{55 \textcolor{keywordtype}{void} *\_alloca(\textcolor{keywordtype}{size\_t} \mbox{\hyperlink{namespacegl_a441d79156826d7dfbf89100bb934a38d}{size}});}
\DoxyCodeLine{56 \textcolor{preprocessor}{\#  define alloca \_alloca}}
\DoxyCodeLine{57 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{58 }
\DoxyCodeLine{59 \textcolor{preprocessor}{\#ifndef FAST\_HYPOT}}
\DoxyCodeLine{60 \textcolor{preprocessor}{\#  define FAST\_HYPOT hypot}}
\DoxyCodeLine{61 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{62 }
\DoxyCodeLine{63 \textcolor{preprocessor}{\#endif }\textcolor{comment}{/* \_V\_IFDEFJAIL\_H\_ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{64 }
\DoxyCodeLine{65 \textcolor{preprocessor}{\#ifdef HAVE\_ALLOCA\_H}}
\DoxyCodeLine{66 \textcolor{preprocessor}{\#  include <alloca.h>}}
\DoxyCodeLine{67 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{68 }
\DoxyCodeLine{69 \textcolor{preprocessor}{\#ifdef USE\_MEMORY\_H}}
\DoxyCodeLine{70 \textcolor{preprocessor}{\#  include <\mbox{\hyperlink{memory_8h}{memory.h}}>}}
\DoxyCodeLine{71 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{72 }
\DoxyCodeLine{73 \textcolor{preprocessor}{\#ifndef min}}
\DoxyCodeLine{74 \textcolor{preprocessor}{\#  define min(x,y)  ((x)>(y)?(y):(x))}}
\DoxyCodeLine{75 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{76 }
\DoxyCodeLine{77 \textcolor{preprocessor}{\#ifndef max}}
\DoxyCodeLine{78 \textcolor{preprocessor}{\#  define max(x,y)  ((x)<(y)?(y):(x))}}
\DoxyCodeLine{79 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{80 }
\DoxyCodeLine{81 }
\DoxyCodeLine{82 \textcolor{comment}{/* Special i386 GCC implementation */}}
\DoxyCodeLine{83 \textcolor{preprocessor}{\#if defined(\_\_i386\_\_) \&\& defined(\_\_GNUC\_\_) \&\& !defined(\_\_BEOS\_\_)}}
\DoxyCodeLine{84 \textcolor{preprocessor}{\#  define VORBIS\_FPU\_CONTROL}}
\DoxyCodeLine{85 \textcolor{comment}{/* both GCC and MSVC are kinda stupid about rounding/casting to int.}}
\DoxyCodeLine{86 \textcolor{comment}{   Because of encapsulation constraints (GCC can't see inside the asm}}
\DoxyCodeLine{87 \textcolor{comment}{   block and so we end up doing stupid things like a store/load that}}
\DoxyCodeLine{88 \textcolor{comment}{   is collectively a noop), we do it this way */}}
\DoxyCodeLine{89 }
\DoxyCodeLine{90 \textcolor{comment}{/* we must set up the fpu before this works!! */}}
\DoxyCodeLine{91 }
\DoxyCodeLine{92 \textcolor{keyword}{typedef} \mbox{\hyperlink{config__types_8h_a0c3ed569a9b7ecd176140e0af4b40ed7}{ogg\_int16\_t}} \mbox{\hyperlink{os_8h_aab8c4bf1d74a78283d1becfe683171e4}{vorbis\_fpu\_control}};}
\DoxyCodeLine{93 }
\DoxyCodeLine{94 \textcolor{keyword}{static} \textcolor{keyword}{inline} \textcolor{keywordtype}{void} \mbox{\hyperlink{os_8h_a2810b290d777bd34e300a3af10497796}{vorbis\_fpu\_setround}}(\mbox{\hyperlink{os_8h_aab8c4bf1d74a78283d1becfe683171e4}{vorbis\_fpu\_control}} *fpu)\{}
\DoxyCodeLine{95   \mbox{\hyperlink{config__types_8h_a0c3ed569a9b7ecd176140e0af4b40ed7}{ogg\_int16\_t}} ret;}
\DoxyCodeLine{96   \mbox{\hyperlink{config__types_8h_a0c3ed569a9b7ecd176140e0af4b40ed7}{ogg\_int16\_t}} temp = 0;}
\DoxyCodeLine{97   \_\_asm\_\_ \_\_volatile\_\_(\textcolor{stringliteral}{"{}fnstcw \%0\(\backslash\)n\(\backslash\)t"{}}}
\DoxyCodeLine{98           \textcolor{stringliteral}{"{}movw \%0,\%\%dx\(\backslash\)n\(\backslash\)t"{}}}
\DoxyCodeLine{99           \textcolor{stringliteral}{"{}andw \$62463,\%\%dx\(\backslash\)n\(\backslash\)t"{}}}
\DoxyCodeLine{100           \textcolor{stringliteral}{"{}movw \%\%dx,\%1\(\backslash\)n\(\backslash\)t"{}}}
\DoxyCodeLine{101           \textcolor{stringliteral}{"{}fldcw \%1\(\backslash\)n\(\backslash\)t"{}}:\textcolor{stringliteral}{"{}=m"{}}(ret):\textcolor{stringliteral}{"{}m"{}}(temp): \textcolor{stringliteral}{"{}dx"{}});}
\DoxyCodeLine{102   *fpu=ret;}
\DoxyCodeLine{103 \}}
\DoxyCodeLine{104 }
\DoxyCodeLine{105 \textcolor{keyword}{static} \textcolor{keyword}{inline} \textcolor{keywordtype}{void} \mbox{\hyperlink{os_8h_a890fc27c4b30233656c1195799203e83}{vorbis\_fpu\_restore}}(\mbox{\hyperlink{os_8h_aab8c4bf1d74a78283d1becfe683171e4}{vorbis\_fpu\_control}} fpu)\{}
\DoxyCodeLine{106   \_\_asm\_\_ \_\_volatile\_\_(\textcolor{stringliteral}{"{}fldcw \%0"{}}:: \textcolor{stringliteral}{"{}m"{}}(fpu));}
\DoxyCodeLine{107 \}}
\DoxyCodeLine{108 }
\DoxyCodeLine{109 \textcolor{comment}{/* assumes the FPU is in round mode! */}}
\DoxyCodeLine{110 \textcolor{keyword}{static} \textcolor{keyword}{inline} \textcolor{keywordtype}{int} vorbis\_ftoi(\textcolor{keywordtype}{double} \mbox{\hyperlink{namespacegl_a36f31b2741707f905f4a62d054da4931}{f}})\{  \textcolor{comment}{/* yes, double!  Otherwise,}}
\DoxyCodeLine{111 \textcolor{comment}{                                             we get extra fst/fld to}}
\DoxyCodeLine{112 \textcolor{comment}{                                             truncate precision */}}
\DoxyCodeLine{113   \textcolor{keywordtype}{int} i;}
\DoxyCodeLine{114   \_\_asm\_\_(\textcolor{stringliteral}{"{}fistl \%0"{}}: \textcolor{stringliteral}{"{}=m"{}}(i) : \textcolor{stringliteral}{"{}t"{}}(\mbox{\hyperlink{namespacegl_a36f31b2741707f905f4a62d054da4931}{f}}));}
\DoxyCodeLine{115   \textcolor{keywordflow}{return}(i);}
\DoxyCodeLine{116 \}}
\DoxyCodeLine{117 \textcolor{preprocessor}{\#endif }\textcolor{comment}{/* Special i386 GCC implementation */}\textcolor{preprocessor}{}}
\DoxyCodeLine{118 }
\DoxyCodeLine{119 }
\DoxyCodeLine{120 \textcolor{comment}{/* MSVC inline assembly. 32 bit only; inline ASM isn't implemented in the}}
\DoxyCodeLine{121 \textcolor{comment}{ * 64 bit compiler and doesn't work on arm. */}}
\DoxyCodeLine{122 \textcolor{preprocessor}{\#if defined(\_MSC\_VER) \&\& defined(\_M\_IX86) \&\& !defined(\_WIN32\_WCE)}}
\DoxyCodeLine{123 \textcolor{preprocessor}{\#  define VORBIS\_FPU\_CONTROL}}
\DoxyCodeLine{124 }
\DoxyCodeLine{125 \textcolor{keyword}{typedef} \mbox{\hyperlink{config__types_8h_a0c3ed569a9b7ecd176140e0af4b40ed7}{ogg\_int16\_t}} \mbox{\hyperlink{os_8h_aab8c4bf1d74a78283d1becfe683171e4}{vorbis\_fpu\_control}};}
\DoxyCodeLine{126 }
\DoxyCodeLine{127 \textcolor{keyword}{static} \_\_inline \textcolor{keywordtype}{int} vorbis\_ftoi(\textcolor{keywordtype}{double} \mbox{\hyperlink{namespacegl_a36f31b2741707f905f4a62d054da4931}{f}})\{}
\DoxyCodeLine{128         \textcolor{keywordtype}{int} i;}
\DoxyCodeLine{129         \_\_asm\{}
\DoxyCodeLine{130                 fld \mbox{\hyperlink{namespacegl_a36f31b2741707f905f4a62d054da4931}{f}}}
\DoxyCodeLine{131                 fistp i}
\DoxyCodeLine{132         \}}
\DoxyCodeLine{133         \textcolor{keywordflow}{return} i;}
\DoxyCodeLine{134 \}}
\DoxyCodeLine{135 }
\DoxyCodeLine{136 \textcolor{keyword}{static} \_\_inline \textcolor{keywordtype}{void} \mbox{\hyperlink{os_8h_a2810b290d777bd34e300a3af10497796}{vorbis\_fpu\_setround}}(\mbox{\hyperlink{os_8h_aab8c4bf1d74a78283d1becfe683171e4}{vorbis\_fpu\_control}} *fpu)\{}
\DoxyCodeLine{137   (\mbox{\hyperlink{png_8h_aa8c59027f9ab2769342f248709d68d17}{void}})fpu;}
\DoxyCodeLine{138 \}}
\DoxyCodeLine{139 }
\DoxyCodeLine{140 \textcolor{keyword}{static} \_\_inline \textcolor{keywordtype}{void} \mbox{\hyperlink{os_8h_a890fc27c4b30233656c1195799203e83}{vorbis\_fpu\_restore}}(\mbox{\hyperlink{os_8h_aab8c4bf1d74a78283d1becfe683171e4}{vorbis\_fpu\_control}} fpu)\{}
\DoxyCodeLine{141   (\mbox{\hyperlink{png_8h_aa8c59027f9ab2769342f248709d68d17}{void}})fpu;}
\DoxyCodeLine{142 \}}
\DoxyCodeLine{143 }
\DoxyCodeLine{144 \textcolor{preprocessor}{\#endif }\textcolor{comment}{/* Special MSVC 32 bit implementation */}\textcolor{preprocessor}{}}
\DoxyCodeLine{145 }
\DoxyCodeLine{146 }
\DoxyCodeLine{147 \textcolor{comment}{/* Optimized code path for x86\_64 builds. Uses SSE2 intrinsics. This can be}}
\DoxyCodeLine{148 \textcolor{comment}{   done safely because all x86\_64 CPUs supports SSE2. */}}
\DoxyCodeLine{149 \textcolor{preprocessor}{\#if ((JUCE\_MSVC \&\& JUCE\_64BIT) || (JUCE\_GCC \&\& defined (\_\_x86\_64\_\_)))}}
\DoxyCodeLine{150 \textcolor{preprocessor}{\#  define VORBIS\_FPU\_CONTROL}}
\DoxyCodeLine{151 }
\DoxyCodeLine{152 \textcolor{keyword}{typedef} \mbox{\hyperlink{config__types_8h_a0c3ed569a9b7ecd176140e0af4b40ed7}{ogg\_int16\_t}} \mbox{\hyperlink{os_8h_aab8c4bf1d74a78283d1becfe683171e4}{vorbis\_fpu\_control}};}
\DoxyCodeLine{153 }
\DoxyCodeLine{154 \textcolor{preprocessor}{\#include <emmintrin.h>}}
\DoxyCodeLine{155 \textcolor{keyword}{static} \_\_inline \textcolor{keywordtype}{int} vorbis\_ftoi(\textcolor{keywordtype}{double} \mbox{\hyperlink{namespacegl_a36f31b2741707f905f4a62d054da4931}{f}})\{}
\DoxyCodeLine{156         \textcolor{keywordflow}{return} \_mm\_cvtsd\_si32(\_mm\_load\_sd(\&\mbox{\hyperlink{namespacegl_a36f31b2741707f905f4a62d054da4931}{f}}));}
\DoxyCodeLine{157 \}}
\DoxyCodeLine{158 }
\DoxyCodeLine{159 \textcolor{keyword}{static} \_\_inline \textcolor{keywordtype}{void} \mbox{\hyperlink{os_8h_a2810b290d777bd34e300a3af10497796}{vorbis\_fpu\_setround}}(\mbox{\hyperlink{os_8h_aab8c4bf1d74a78283d1becfe683171e4}{vorbis\_fpu\_control}} *fpu)\{}
\DoxyCodeLine{160   (\mbox{\hyperlink{png_8h_aa8c59027f9ab2769342f248709d68d17}{void}})fpu;}
\DoxyCodeLine{161 \}}
\DoxyCodeLine{162 }
\DoxyCodeLine{163 \textcolor{keyword}{static} \_\_inline \textcolor{keywordtype}{void} \mbox{\hyperlink{os_8h_a890fc27c4b30233656c1195799203e83}{vorbis\_fpu\_restore}}(\mbox{\hyperlink{os_8h_aab8c4bf1d74a78283d1becfe683171e4}{vorbis\_fpu\_control}} fpu)\{}
\DoxyCodeLine{164   (\mbox{\hyperlink{png_8h_aa8c59027f9ab2769342f248709d68d17}{void}})fpu;}
\DoxyCodeLine{165 \}}
\DoxyCodeLine{166 }
\DoxyCodeLine{167 \textcolor{preprocessor}{\#endif }\textcolor{comment}{/* Special MSVC x64 implementation */}\textcolor{preprocessor}{}}
\DoxyCodeLine{168 }
\DoxyCodeLine{169 }
\DoxyCodeLine{170 \textcolor{comment}{/* If no special implementation was found for the current compiler / platform,}}
\DoxyCodeLine{171 \textcolor{comment}{   use the default implementation here: */}}
\DoxyCodeLine{172 \textcolor{preprocessor}{\#ifndef VORBIS\_FPU\_CONTROL}}
\DoxyCodeLine{173 }
\DoxyCodeLine{174 \textcolor{keyword}{typedef} \textcolor{keywordtype}{int} \mbox{\hyperlink{os_8h_aab8c4bf1d74a78283d1becfe683171e4}{vorbis\_fpu\_control}};}
\DoxyCodeLine{175 }
\DoxyCodeLine{176 \textcolor{keyword}{static} \textcolor{keywordtype}{int} vorbis\_ftoi(\textcolor{keywordtype}{double} \mbox{\hyperlink{namespacegl_a36f31b2741707f905f4a62d054da4931}{f}})\{}
\DoxyCodeLine{177         \textcolor{comment}{/* Note: MSVC and GCC (at least on some systems) round towards zero, thus,}}
\DoxyCodeLine{178 \textcolor{comment}{           the floor() call is required to ensure correct roudning of}}
\DoxyCodeLine{179 \textcolor{comment}{           negative numbers */}}
\DoxyCodeLine{180         \textcolor{keywordflow}{return} (\textcolor{keywordtype}{int})floor(\mbox{\hyperlink{namespacegl_a36f31b2741707f905f4a62d054da4931}{f}}+.5);}
\DoxyCodeLine{181 \}}
\DoxyCodeLine{182 }
\DoxyCodeLine{183 \textcolor{comment}{/* We don't have special code for this compiler/arch, so do it the slow way */}}
\DoxyCodeLine{184 \textcolor{preprocessor}{\#  define vorbis\_fpu\_setround(vorbis\_fpu\_control) \{\}}}
\DoxyCodeLine{185 \textcolor{preprocessor}{\#  define vorbis\_fpu\_restore(vorbis\_fpu\_control) \{\}}}
\DoxyCodeLine{186 }
\DoxyCodeLine{187 \textcolor{preprocessor}{\#endif }\textcolor{comment}{/* default implementation */}\textcolor{preprocessor}{}}
\DoxyCodeLine{188 }
\DoxyCodeLine{189 \textcolor{preprocessor}{\#endif }\textcolor{comment}{/* \_OS\_H */}\textcolor{preprocessor}{}}

\end{DoxyCode}
