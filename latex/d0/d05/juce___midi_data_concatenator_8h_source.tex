\hypertarget{juce___midi_data_concatenator_8h_source}{}\doxysection{juce\+\_\+\+Midi\+Data\+Concatenator.\+h}
\label{juce___midi_data_concatenator_8h_source}\index{build/juce\_audio\_basics/midi/juce\_MidiDataConcatenator.h@{build/juce\_audio\_basics/midi/juce\_MidiDataConcatenator.h}}
\mbox{\hyperlink{juce___midi_data_concatenator_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 }
\DoxyCodeLine{5 \textcolor{comment}{/*}}
\DoxyCodeLine{6 \textcolor{comment}{  ==============================================================================}}
\DoxyCodeLine{7 \textcolor{comment}{}}
\DoxyCodeLine{8 \textcolor{comment}{   This file is part of the JUCE library.}}
\DoxyCodeLine{9 \textcolor{comment}{   Copyright (c) 2020 -\/ Raw Material Software Limited}}
\DoxyCodeLine{10 \textcolor{comment}{}}
\DoxyCodeLine{11 \textcolor{comment}{   JUCE is an open source library subject to commercial or open-\/source}}
\DoxyCodeLine{12 \textcolor{comment}{   licensing.}}
\DoxyCodeLine{13 \textcolor{comment}{}}
\DoxyCodeLine{14 \textcolor{comment}{   The code included in this file is provided under the terms of the ISC license}}
\DoxyCodeLine{15 \textcolor{comment}{   http://www.isc.org/downloads/software-\/support-\/policy/isc-\/license. Permission}}
\DoxyCodeLine{16 \textcolor{comment}{   To use, copy, modify, and/or distribute this software for any purpose with or}}
\DoxyCodeLine{17 \textcolor{comment}{   without fee is hereby granted provided that the above copyright notice and}}
\DoxyCodeLine{18 \textcolor{comment}{   this permission notice appear in all copies.}}
\DoxyCodeLine{19 \textcolor{comment}{}}
\DoxyCodeLine{20 \textcolor{comment}{   JUCE IS PROVIDED "{}AS IS"{} WITHOUT ANY WARRANTY, AND ALL WARRANTIES, WHETHER}}
\DoxyCodeLine{21 \textcolor{comment}{   EXPRESSED OR IMPLIED, INCLUDING MERCHANTABILITY AND FITNESS FOR PURPOSE, ARE}}
\DoxyCodeLine{22 \textcolor{comment}{   DISCLAIMED.}}
\DoxyCodeLine{23 \textcolor{comment}{}}
\DoxyCodeLine{24 \textcolor{comment}{  ==============================================================================}}
\DoxyCodeLine{25 \textcolor{comment}{*/}}
\DoxyCodeLine{26 }
\DoxyCodeLine{27 \textcolor{comment}{//==============================================================================}}
\DoxyCodeLine{34 \textcolor{comment}{}\textcolor{keyword}{class }\mbox{\hyperlink{class_midi_data_concatenator}{MidiDataConcatenator}}}
\DoxyCodeLine{35 \{}
\DoxyCodeLine{36 \textcolor{keyword}{public}:}
\DoxyCodeLine{37     \mbox{\hyperlink{class_midi_data_concatenator_a4ef6c5e4b962d82434475d11ff0020e5}{MidiDataConcatenator}} (\textcolor{keywordtype}{int} initialBufferSize)}
\DoxyCodeLine{38         : pendingSysexData ((size\_t) initialBufferSize)}
\DoxyCodeLine{39     \{}
\DoxyCodeLine{40     \}}
\DoxyCodeLine{41 }
\DoxyCodeLine{42     \textcolor{keywordtype}{void} \mbox{\hyperlink{class_midi_data_concatenator_a1d3eaa05ed79ca3a6fec638a46a29f3c}{reset}}()}
\DoxyCodeLine{43     \{}
\DoxyCodeLine{44         currentMessageLen = 0;}
\DoxyCodeLine{45         pendingSysexSize = 0;}
\DoxyCodeLine{46         pendingSysexTime = 0;}
\DoxyCodeLine{47     \}}
\DoxyCodeLine{48 }
\DoxyCodeLine{49     \textcolor{keyword}{template} <\textcolor{keyword}{typename} UserDataType, \textcolor{keyword}{typename} CallbackType>}
\DoxyCodeLine{50     \textcolor{keywordtype}{void} \mbox{\hyperlink{class_midi_data_concatenator_a886ed5f92950c02e7e1343c6aee415b9}{pushMidiData}} (\textcolor{keyword}{const} \textcolor{keywordtype}{void}* inputData, \textcolor{keywordtype}{int} numBytes, \textcolor{keywordtype}{double} time,}
\DoxyCodeLine{51                        UserDataType* \mbox{\hyperlink{namespacegl_ae94d0a99dc3426b5ac5fc7d881691a61}{input}}, CallbackType\& \mbox{\hyperlink{juce__linux___a_l_s_a_8cpp_a7d161ccbd94169c2108f6a40711e3a76}{callback}})}
\DoxyCodeLine{52     \{}
\DoxyCodeLine{53         \textcolor{keyword}{auto} d = \textcolor{keyword}{static\_cast<}\textcolor{keyword}{const }\mbox{\hyperlink{juce__box2d_8cpp_a4a0dc603b03692b2e16aca65cd3f7c35}{uint8}}*\textcolor{keyword}{>} (inputData);}
\DoxyCodeLine{54 }
\DoxyCodeLine{55         \textcolor{keywordflow}{while} (numBytes > 0)}
\DoxyCodeLine{56         \{}
\DoxyCodeLine{57             \textcolor{keyword}{auto} nextByte = *d;}
\DoxyCodeLine{58 }
\DoxyCodeLine{59             \textcolor{keywordflow}{if} (pendingSysexSize != 0 || nextByte == 0xf0)}
\DoxyCodeLine{60             \{}
\DoxyCodeLine{61                 processSysex (d, numBytes, time, \mbox{\hyperlink{namespacegl_ae94d0a99dc3426b5ac5fc7d881691a61}{input}}, \mbox{\hyperlink{juce__linux___a_l_s_a_8cpp_a7d161ccbd94169c2108f6a40711e3a76}{callback}});}
\DoxyCodeLine{62                 currentMessageLen = 0;}
\DoxyCodeLine{63                 \textcolor{keywordflow}{continue};}
\DoxyCodeLine{64             \}}
\DoxyCodeLine{65 }
\DoxyCodeLine{66             ++d;}
\DoxyCodeLine{67             -\/-\/numBytes;}
\DoxyCodeLine{68 }
\DoxyCodeLine{69             \textcolor{keywordflow}{if} (isRealtimeMessage (nextByte))}
\DoxyCodeLine{70             \{}
\DoxyCodeLine{71                 \mbox{\hyperlink{juce__linux___a_l_s_a_8cpp_a7d161ccbd94169c2108f6a40711e3a76}{callback}}.handleIncomingMidiMessage (\mbox{\hyperlink{namespacegl_ae94d0a99dc3426b5ac5fc7d881691a61}{input}}, \mbox{\hyperlink{class_midi_message}{MidiMessage}} (nextByte, time));}
\DoxyCodeLine{72                 \textcolor{comment}{// These can be embedded in the middle of a normal message, so we won't}}
\DoxyCodeLine{73                 \textcolor{comment}{// reset the currentMessageLen here.}}
\DoxyCodeLine{74                 \textcolor{keywordflow}{continue};}
\DoxyCodeLine{75             \}}
\DoxyCodeLine{76 }
\DoxyCodeLine{77             \textcolor{keywordflow}{if} (isInitialByte (nextByte))}
\DoxyCodeLine{78             \{}
\DoxyCodeLine{79                 currentMessage[0] = nextByte;}
\DoxyCodeLine{80                 currentMessageLen = 1;}
\DoxyCodeLine{81             \}}
\DoxyCodeLine{82             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (currentMessageLen > 0 \&\& currentMessageLen < 3)}
\DoxyCodeLine{83             \{}
\DoxyCodeLine{84                 currentMessage[currentMessageLen++] = nextByte;}
\DoxyCodeLine{85             \}}
\DoxyCodeLine{86             \textcolor{keywordflow}{else}}
\DoxyCodeLine{87             \{}
\DoxyCodeLine{88                 \textcolor{comment}{// message is too long or invalid MIDI -\/ abandon it and start again with the next byte}}
\DoxyCodeLine{89                 currentMessageLen = 0;}
\DoxyCodeLine{90                 \textcolor{keywordflow}{continue};}
\DoxyCodeLine{91             \}}
\DoxyCodeLine{92 }
\DoxyCodeLine{93             \textcolor{keyword}{auto} expectedLength = \mbox{\hyperlink{class_midi_message_a5e312ea62140d65cb63af27e9469e183}{MidiMessage::getMessageLengthFromFirstByte}} (currentMessage[0]);}
\DoxyCodeLine{94 }
\DoxyCodeLine{95             \textcolor{keywordflow}{if} (expectedLength == currentMessageLen)}
\DoxyCodeLine{96             \{}
\DoxyCodeLine{97                 \mbox{\hyperlink{juce__linux___a_l_s_a_8cpp_a7d161ccbd94169c2108f6a40711e3a76}{callback}}.handleIncomingMidiMessage (\mbox{\hyperlink{namespacegl_ae94d0a99dc3426b5ac5fc7d881691a61}{input}}, \mbox{\hyperlink{class_midi_message}{MidiMessage}} (currentMessage, expectedLength, time));}
\DoxyCodeLine{98                 currentMessageLen = 1; \textcolor{comment}{// reset, but leave the first byte to use as the running status byte}}
\DoxyCodeLine{99             \}}
\DoxyCodeLine{100         \}}
\DoxyCodeLine{101     \}}
\DoxyCodeLine{102 }
\DoxyCodeLine{103 \textcolor{keyword}{private}:}
\DoxyCodeLine{104     \textcolor{keyword}{template} <\textcolor{keyword}{typename} UserDataType, \textcolor{keyword}{typename} CallbackType>}
\DoxyCodeLine{105     \textcolor{keywordtype}{void} processSysex (\textcolor{keyword}{const} \mbox{\hyperlink{juce__box2d_8cpp_a4a0dc603b03692b2e16aca65cd3f7c35}{uint8}}*\& d, \textcolor{keywordtype}{int}\& numBytes, \textcolor{keywordtype}{double} time,}
\DoxyCodeLine{106                        UserDataType* \mbox{\hyperlink{namespacegl_ae94d0a99dc3426b5ac5fc7d881691a61}{input}}, CallbackType\& \mbox{\hyperlink{juce__linux___a_l_s_a_8cpp_a7d161ccbd94169c2108f6a40711e3a76}{callback}})}
\DoxyCodeLine{107     \{}
\DoxyCodeLine{108         \textcolor{keywordflow}{if} (*d == 0xf0)}
\DoxyCodeLine{109         \{}
\DoxyCodeLine{110             pendingSysexSize = 0;}
\DoxyCodeLine{111             pendingSysexTime = time;}
\DoxyCodeLine{112         \}}
\DoxyCodeLine{113 }
\DoxyCodeLine{114         pendingSysexData.\mbox{\hyperlink{class_memory_block_a62cb5792aa70e8eb83d96fce1fa7a51d}{ensureSize}} ((\textcolor{keywordtype}{size\_t}) (pendingSysexSize + numBytes), \textcolor{keyword}{false});}
\DoxyCodeLine{115         \textcolor{keyword}{auto} totalMessage = \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{juce__box2d_8cpp_a4a0dc603b03692b2e16aca65cd3f7c35}{uint8}}*\textcolor{keyword}{>} (pendingSysexData.\mbox{\hyperlink{class_memory_block_a26dd79a85e203273959bcdeb8bba572d}{getData}}());}
\DoxyCodeLine{116         \textcolor{keyword}{auto} dest = totalMessage + pendingSysexSize;}
\DoxyCodeLine{117 }
\DoxyCodeLine{118         \textcolor{keywordflow}{do}}
\DoxyCodeLine{119         \{}
\DoxyCodeLine{120             \textcolor{keywordflow}{if} (pendingSysexSize > 0 \&\& isStatusByte (*d))}
\DoxyCodeLine{121             \{}
\DoxyCodeLine{122                 \textcolor{keywordflow}{if} (*d == 0xf7)}
\DoxyCodeLine{123                 \{}
\DoxyCodeLine{124                     *dest++ = *d++;}
\DoxyCodeLine{125                     ++pendingSysexSize;}
\DoxyCodeLine{126                     -\/-\/numBytes;}
\DoxyCodeLine{127                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{128                 \}}
\DoxyCodeLine{129 }
\DoxyCodeLine{130                 \textcolor{keywordflow}{if} (*d >= 0xfa || *d == 0xf8)}
\DoxyCodeLine{131                 \{}
\DoxyCodeLine{132                     \mbox{\hyperlink{juce__linux___a_l_s_a_8cpp_a7d161ccbd94169c2108f6a40711e3a76}{callback}}.handleIncomingMidiMessage (\mbox{\hyperlink{namespacegl_ae94d0a99dc3426b5ac5fc7d881691a61}{input}}, \mbox{\hyperlink{class_midi_message}{MidiMessage}} (*d, time));}
\DoxyCodeLine{133                     ++d;}
\DoxyCodeLine{134                     -\/-\/numBytes;}
\DoxyCodeLine{135                 \}}
\DoxyCodeLine{136                 \textcolor{keywordflow}{else}}
\DoxyCodeLine{137                 \{}
\DoxyCodeLine{138                     pendingSysexSize = 0;}
\DoxyCodeLine{139                     \textcolor{keywordtype}{int} used = 0;}
\DoxyCodeLine{140                     \textcolor{keyword}{const} \mbox{\hyperlink{class_midi_message}{MidiMessage}} \mbox{\hyperlink{namespacegl_a0927a7b4232e61481fa501d12209467e}{m}} (d, numBytes, used, 0, time);}
\DoxyCodeLine{141 }
\DoxyCodeLine{142                     \textcolor{keywordflow}{if} (used > 0)}
\DoxyCodeLine{143                     \{}
\DoxyCodeLine{144                         \mbox{\hyperlink{juce__linux___a_l_s_a_8cpp_a7d161ccbd94169c2108f6a40711e3a76}{callback}}.handleIncomingMidiMessage (\mbox{\hyperlink{namespacegl_ae94d0a99dc3426b5ac5fc7d881691a61}{input}}, \mbox{\hyperlink{namespacegl_a0927a7b4232e61481fa501d12209467e}{m}});}
\DoxyCodeLine{145                         numBytes -\/= used;}
\DoxyCodeLine{146                         d += used;}
\DoxyCodeLine{147                     \}}
\DoxyCodeLine{148 }
\DoxyCodeLine{149                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{150                 \}}
\DoxyCodeLine{151             \}}
\DoxyCodeLine{152             \textcolor{keywordflow}{else}}
\DoxyCodeLine{153             \{}
\DoxyCodeLine{154                 *dest++ = *d++;}
\DoxyCodeLine{155                 ++pendingSysexSize;}
\DoxyCodeLine{156                 -\/-\/numBytes;}
\DoxyCodeLine{157             \}}
\DoxyCodeLine{158         \}}
\DoxyCodeLine{159         \textcolor{keywordflow}{while} (numBytes > 0);}
\DoxyCodeLine{160 }
\DoxyCodeLine{161         \textcolor{keywordflow}{if} (pendingSysexSize > 0)}
\DoxyCodeLine{162         \{}
\DoxyCodeLine{163             \textcolor{keywordflow}{if} (totalMessage [pendingSysexSize -\/ 1] == 0xf7)}
\DoxyCodeLine{164             \{}
\DoxyCodeLine{165                 \mbox{\hyperlink{juce__linux___a_l_s_a_8cpp_a7d161ccbd94169c2108f6a40711e3a76}{callback}}.handleIncomingMidiMessage (\mbox{\hyperlink{namespacegl_ae94d0a99dc3426b5ac5fc7d881691a61}{input}}, \mbox{\hyperlink{class_midi_message}{MidiMessage}} (totalMessage, pendingSysexSize, pendingSysexTime));}
\DoxyCodeLine{166                 pendingSysexSize = 0;}
\DoxyCodeLine{167             \}}
\DoxyCodeLine{168             \textcolor{keywordflow}{else}}
\DoxyCodeLine{169             \{}
\DoxyCodeLine{170                 \mbox{\hyperlink{juce__linux___a_l_s_a_8cpp_a7d161ccbd94169c2108f6a40711e3a76}{callback}}.handlePartialSysexMessage (\mbox{\hyperlink{namespacegl_ae94d0a99dc3426b5ac5fc7d881691a61}{input}}, totalMessage, pendingSysexSize, pendingSysexTime);}
\DoxyCodeLine{171             \}}
\DoxyCodeLine{172         \}}
\DoxyCodeLine{173     \}}
\DoxyCodeLine{174 }
\DoxyCodeLine{175     \textcolor{keyword}{static} \textcolor{keywordtype}{bool} isRealtimeMessage (\mbox{\hyperlink{juce__box2d_8cpp_a4a0dc603b03692b2e16aca65cd3f7c35}{uint8}} \textcolor{keywordtype}{byte})  \{ \textcolor{keywordflow}{return} \textcolor{keywordtype}{byte} >= 0xf8 \&\& \textcolor{keywordtype}{byte} <= 0xfe; \}}
\DoxyCodeLine{176     \textcolor{keyword}{static} \textcolor{keywordtype}{bool} isStatusByte (\mbox{\hyperlink{juce__box2d_8cpp_a4a0dc603b03692b2e16aca65cd3f7c35}{uint8}} \textcolor{keywordtype}{byte})       \{ \textcolor{keywordflow}{return} \textcolor{keywordtype}{byte} >= 0x80; \}}
\DoxyCodeLine{177     \textcolor{keyword}{static} \textcolor{keywordtype}{bool} isInitialByte (\mbox{\hyperlink{juce__box2d_8cpp_a4a0dc603b03692b2e16aca65cd3f7c35}{uint8}} \textcolor{keywordtype}{byte})      \{ \textcolor{keywordflow}{return} isStatusByte (\textcolor{keywordtype}{byte}) \&\& \textcolor{keywordtype}{byte} != 0xf7; \}}
\DoxyCodeLine{178 }
\DoxyCodeLine{179     \mbox{\hyperlink{juce__box2d_8cpp_a4a0dc603b03692b2e16aca65cd3f7c35}{uint8}} currentMessage[3];}
\DoxyCodeLine{180     \textcolor{keywordtype}{int} currentMessageLen = 0;}
\DoxyCodeLine{181 }
\DoxyCodeLine{182     \mbox{\hyperlink{class_memory_block}{MemoryBlock}} pendingSysexData;}
\DoxyCodeLine{183     \textcolor{keywordtype}{double} pendingSysexTime = 0;}
\DoxyCodeLine{184     \textcolor{keywordtype}{int} pendingSysexSize = 0;}
\DoxyCodeLine{185 }
\DoxyCodeLine{186     \mbox{\hyperlink{group__juce__core-system_ga6ab7a603bf4435c7cb286b1744366eb2}{JUCE\_DECLARE\_NON\_COPYABLE}} (\mbox{\hyperlink{class_midi_data_concatenator}{MidiDataConcatenator}})}
\DoxyCodeLine{187 \};}
\DoxyCodeLine{188 }
\DoxyCodeLine{189  \textcolor{comment}{// namespace juce}}
\DoxyCodeLine{190 }

\end{DoxyCode}
