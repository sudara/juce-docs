\hypertarget{juce___singleton_8h_source}{}\doxysection{juce\+\_\+\+Singleton.\+h}
\label{juce___singleton_8h_source}\index{build/juce\_core/memory/juce\_Singleton.h@{build/juce\_core/memory/juce\_Singleton.h}}
\mbox{\hyperlink{juce___singleton_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 }
\DoxyCodeLine{5 \textcolor{comment}{/*}}
\DoxyCodeLine{6 \textcolor{comment}{  ==============================================================================}}
\DoxyCodeLine{7 \textcolor{comment}{}}
\DoxyCodeLine{8 \textcolor{comment}{   This file is part of the JUCE library.}}
\DoxyCodeLine{9 \textcolor{comment}{   Copyright (c) 2020 -\/ Raw Material Software Limited}}
\DoxyCodeLine{10 \textcolor{comment}{}}
\DoxyCodeLine{11 \textcolor{comment}{   JUCE is an open source library subject to commercial or open-\/source}}
\DoxyCodeLine{12 \textcolor{comment}{   licensing.}}
\DoxyCodeLine{13 \textcolor{comment}{}}
\DoxyCodeLine{14 \textcolor{comment}{   The code included in this file is provided under the terms of the ISC license}}
\DoxyCodeLine{15 \textcolor{comment}{   http://www.isc.org/downloads/software-\/support-\/policy/isc-\/license. Permission}}
\DoxyCodeLine{16 \textcolor{comment}{   To use, copy, modify, and/or distribute this software for any purpose with or}}
\DoxyCodeLine{17 \textcolor{comment}{   without fee is hereby granted provided that the above copyright notice and}}
\DoxyCodeLine{18 \textcolor{comment}{   this permission notice appear in all copies.}}
\DoxyCodeLine{19 \textcolor{comment}{}}
\DoxyCodeLine{20 \textcolor{comment}{   JUCE IS PROVIDED "{}AS IS"{} WITHOUT ANY WARRANTY, AND ALL WARRANTIES, WHETHER}}
\DoxyCodeLine{21 \textcolor{comment}{   EXPRESSED OR IMPLIED, INCLUDING MERCHANTABILITY AND FITNESS FOR PURPOSE, ARE}}
\DoxyCodeLine{22 \textcolor{comment}{   DISCLAIMED.}}
\DoxyCodeLine{23 \textcolor{comment}{}}
\DoxyCodeLine{24 \textcolor{comment}{  ==============================================================================}}
\DoxyCodeLine{25 \textcolor{comment}{*/}}
\DoxyCodeLine{26 }
\DoxyCodeLine{27 \textcolor{comment}{//==============================================================================}}
\DoxyCodeLine{38 \textcolor{comment}{}\textcolor{keyword}{template} <\textcolor{keyword}{typename} Type, \textcolor{keyword}{typename} MutexType, \textcolor{keywordtype}{bool} onlyCreateOncePerRun>}
\DoxyCodeLine{39 \textcolor{keyword}{struct }\mbox{\hyperlink{struct_singleton_holder}{SingletonHolder}}  : \textcolor{keyword}{private} MutexType \textcolor{comment}{// (inherited so we can use the empty-\/base-\/class optimisation)}}
\DoxyCodeLine{40 \{}
\DoxyCodeLine{41     \mbox{\hyperlink{struct_singleton_holder_a782298a0332211a7639450b15a36e7a6}{SingletonHolder}}() = \textcolor{keywordflow}{default};}
\DoxyCodeLine{42 }
\DoxyCodeLine{43     \mbox{\hyperlink{struct_singleton_holder_a54c1eb5fe706ba88cfbc5edc04b72c5d}{\string~SingletonHolder}}()}
\DoxyCodeLine{44     \{}
\DoxyCodeLine{45         \textcolor{comment}{/* The static singleton holder is being deleted before the object that it holds}}
\DoxyCodeLine{46 \textcolor{comment}{           has been deleted. This could mean that you've forgotten to call clearSingletonInstance()}}
\DoxyCodeLine{47 \textcolor{comment}{           in the class's destructor, or have failed to delete it before your app shuts down.}}
\DoxyCodeLine{48 \textcolor{comment}{           If you're having trouble cleaning up your singletons, perhaps consider using the}}
\DoxyCodeLine{49 \textcolor{comment}{           SharedResourcePointer class instead.}}
\DoxyCodeLine{50 \textcolor{comment}{        */}}
\DoxyCodeLine{51         \mbox{\hyperlink{group__juce__core-system_ga1f96ab6751237979b907a54f52a7296a}{jassert}} (\mbox{\hyperlink{struct_singleton_holder_ac1f03afb7774c5788ed946d4dfa73cc6}{instance}}.load() == \textcolor{keyword}{nullptr});}
\DoxyCodeLine{52     \}}
\DoxyCodeLine{53 }
\DoxyCodeLine{55     Type* \mbox{\hyperlink{struct_singleton_holder_a4967938749c3bdc5b161304b2e0cc94c}{get}}()}
\DoxyCodeLine{56     \{}
\DoxyCodeLine{57         \textcolor{keywordflow}{if} (\textcolor{keyword}{auto}* \mbox{\hyperlink{namespacejuce_ae427f5199e2d1a5f8091defa1a86f1fc}{ptr}} = \mbox{\hyperlink{struct_singleton_holder_ac1f03afb7774c5788ed946d4dfa73cc6}{instance}}.load())}
\DoxyCodeLine{58             \textcolor{keywordflow}{return} \mbox{\hyperlink{namespacejuce_ae427f5199e2d1a5f8091defa1a86f1fc}{ptr}};}
\DoxyCodeLine{59 }
\DoxyCodeLine{60         \textcolor{keyword}{typename} MutexType::ScopedLockType sl (*\textcolor{keyword}{this});}
\DoxyCodeLine{61 }
\DoxyCodeLine{62         \textcolor{keywordflow}{if} (\textcolor{keyword}{auto}* \mbox{\hyperlink{namespacejuce_ae427f5199e2d1a5f8091defa1a86f1fc}{ptr}} = \mbox{\hyperlink{struct_singleton_holder_ac1f03afb7774c5788ed946d4dfa73cc6}{instance}}.load())}
\DoxyCodeLine{63             \textcolor{keywordflow}{return} \mbox{\hyperlink{namespacejuce_ae427f5199e2d1a5f8091defa1a86f1fc}{ptr}};}
\DoxyCodeLine{64 }
\DoxyCodeLine{65         \textcolor{keyword}{auto} once = onlyCreateOncePerRun; \textcolor{comment}{// (local copy avoids VS compiler warning about this being constant)}}
\DoxyCodeLine{66 }
\DoxyCodeLine{67         \textcolor{keywordflow}{if} (once)}
\DoxyCodeLine{68         \{}
\DoxyCodeLine{69             \textcolor{keyword}{static} \textcolor{keywordtype}{bool} createdOnceAlready = \textcolor{keyword}{false};}
\DoxyCodeLine{70 }
\DoxyCodeLine{71             \textcolor{keywordflow}{if} (createdOnceAlready)}
\DoxyCodeLine{72             \{}
\DoxyCodeLine{73                 \textcolor{comment}{// This means that the doNotRecreateAfterDeletion flag was set}}
\DoxyCodeLine{74                 \textcolor{comment}{// and you tried to create the singleton more than once.}}
\DoxyCodeLine{75                 \mbox{\hyperlink{group__juce__core-system_gadc044ce5efecbecf2f5a44cd00db67b3}{jassertfalse}};}
\DoxyCodeLine{76                 \textcolor{keywordflow}{return} \textcolor{keyword}{nullptr};}
\DoxyCodeLine{77             \}}
\DoxyCodeLine{78 }
\DoxyCodeLine{79             createdOnceAlready = \textcolor{keyword}{true};}
\DoxyCodeLine{80         \}}
\DoxyCodeLine{81 }
\DoxyCodeLine{82         \textcolor{keyword}{static} \textcolor{keywordtype}{bool} alreadyInside = \textcolor{keyword}{false};}
\DoxyCodeLine{83 }
\DoxyCodeLine{84         \textcolor{keywordflow}{if} (alreadyInside)}
\DoxyCodeLine{85         \{}
\DoxyCodeLine{86             \textcolor{comment}{// This means that your object's constructor has done something which has}}
\DoxyCodeLine{87             \textcolor{comment}{// ended up causing a recursive loop of singleton creation.}}
\DoxyCodeLine{88             \mbox{\hyperlink{group__juce__core-system_gadc044ce5efecbecf2f5a44cd00db67b3}{jassertfalse}};}
\DoxyCodeLine{89             \textcolor{keywordflow}{return} \textcolor{keyword}{nullptr};}
\DoxyCodeLine{90         \}}
\DoxyCodeLine{91 }
\DoxyCodeLine{92         \textcolor{keyword}{const} \mbox{\hyperlink{class_scoped_value_setter}{ScopedValueSetter<bool>}} scope (alreadyInside, \textcolor{keyword}{true});}
\DoxyCodeLine{93         \textcolor{keywordflow}{return} \mbox{\hyperlink{struct_singleton_holder_affdeae5afb5c6050e68ac256ce04f7ab}{getWithoutChecking}}();}
\DoxyCodeLine{94     \}}
\DoxyCodeLine{95 }
\DoxyCodeLine{99     Type* \mbox{\hyperlink{struct_singleton_holder_affdeae5afb5c6050e68ac256ce04f7ab}{getWithoutChecking}}()}
\DoxyCodeLine{100     \{}
\DoxyCodeLine{101         \textcolor{keywordflow}{if} (\textcolor{keyword}{auto}* \mbox{\hyperlink{namespacegl_ab8b154a639177df172c80eddeb09a533}{p}} = \mbox{\hyperlink{struct_singleton_holder_ac1f03afb7774c5788ed946d4dfa73cc6}{instance}}.load())}
\DoxyCodeLine{102             \textcolor{keywordflow}{return} \mbox{\hyperlink{namespacegl_ab8b154a639177df172c80eddeb09a533}{p}};}
\DoxyCodeLine{103 }
\DoxyCodeLine{104         \textcolor{keyword}{auto}* newObject = \textcolor{keyword}{new} Type(); \textcolor{comment}{// (create into a local so that instance is still null during construction)}}
\DoxyCodeLine{105         \mbox{\hyperlink{struct_singleton_holder_ac1f03afb7774c5788ed946d4dfa73cc6}{instance}}.store (newObject);}
\DoxyCodeLine{106         \textcolor{keywordflow}{return} newObject;}
\DoxyCodeLine{107     \}}
\DoxyCodeLine{108 }
\DoxyCodeLine{110     \textcolor{keywordtype}{void} \mbox{\hyperlink{struct_singleton_holder_a8b4154ab3ecd3d0b433ab64ec37e3590}{deleteInstance}}()}
\DoxyCodeLine{111     \{}
\DoxyCodeLine{112         \textcolor{keyword}{typename} MutexType::ScopedLockType sl (*\textcolor{keyword}{this});}
\DoxyCodeLine{113         \textcolor{keyword}{delete} \mbox{\hyperlink{struct_singleton_holder_ac1f03afb7774c5788ed946d4dfa73cc6}{instance}}.exchange (\textcolor{keyword}{nullptr});}
\DoxyCodeLine{114     \}}
\DoxyCodeLine{115 }
\DoxyCodeLine{117     \textcolor{keywordtype}{void} \mbox{\hyperlink{struct_singleton_holder_a66dddd01ec3e261fb083cbdcc52c8259}{clear}} (Type* expectedObject) \textcolor{keyword}{noexcept}}
\DoxyCodeLine{118     \{}
\DoxyCodeLine{119         \mbox{\hyperlink{struct_singleton_holder_ac1f03afb7774c5788ed946d4dfa73cc6}{instance}}.compare\_exchange\_strong (expectedObject, \textcolor{keyword}{nullptr});}
\DoxyCodeLine{120     \}}
\DoxyCodeLine{121 }
\DoxyCodeLine{122     \textcolor{comment}{// This must be atomic, otherwise a late call to get() may attempt to read instance while it is}}
\DoxyCodeLine{123     \textcolor{comment}{// being modified by the very first call to get().}}
\DoxyCodeLine{124     std::atomic<Type*> \mbox{\hyperlink{struct_singleton_holder_ac1f03afb7774c5788ed946d4dfa73cc6}{instance}} \{ \textcolor{keyword}{nullptr} \};}
\DoxyCodeLine{125 \};}
\DoxyCodeLine{126 }
\DoxyCodeLine{127 }
\DoxyCodeLine{128 \textcolor{comment}{//==============================================================================}}
\DoxyCodeLine{185 \textcolor{comment}{}\textcolor{preprocessor}{\#define JUCE\_DECLARE\_SINGLETON(Classname, doNotRecreateAfterDeletion) \(\backslash\)}}
\DoxyCodeLine{186 \textcolor{preprocessor}{\(\backslash\)}}
\DoxyCodeLine{187 \textcolor{preprocessor}{    static juce::SingletonHolder<Classname, juce::CriticalSection, doNotRecreateAfterDeletion> singletonHolder; \(\backslash\)}}
\DoxyCodeLine{188 \textcolor{preprocessor}{    friend decltype (singletonHolder); \(\backslash\)}}
\DoxyCodeLine{189 \textcolor{preprocessor}{\(\backslash\)}}
\DoxyCodeLine{190 \textcolor{preprocessor}{    static Classname* JUCE\_CALLTYPE getInstance()                           \{ return singletonHolder.get(); \} \(\backslash\)}}
\DoxyCodeLine{191 \textcolor{preprocessor}{    static Classname* JUCE\_CALLTYPE getInstanceWithoutCreating() noexcept   \{ return singletonHolder.instance; \} \(\backslash\)}}
\DoxyCodeLine{192 \textcolor{preprocessor}{    static void JUCE\_CALLTYPE deleteInstance() noexcept                     \{ singletonHolder.deleteInstance(); \} \(\backslash\)}}
\DoxyCodeLine{193 \textcolor{preprocessor}{    void clearSingletonInstance() noexcept                                  \{ singletonHolder.clear (this); \}}}
\DoxyCodeLine{194 }
\DoxyCodeLine{195 }
\DoxyCodeLine{196 \textcolor{comment}{//==============================================================================}}
\DoxyCodeLine{202 \textcolor{comment}{}\textcolor{preprocessor}{\#define JUCE\_IMPLEMENT\_SINGLETON(Classname) \(\backslash\)}}
\DoxyCodeLine{203 \textcolor{preprocessor}{\(\backslash\)}}
\DoxyCodeLine{204 \textcolor{preprocessor}{    decltype (Classname::singletonHolder) Classname::singletonHolder;}}
\DoxyCodeLine{205 }
\DoxyCodeLine{206 }
\DoxyCodeLine{207 \textcolor{comment}{//==============================================================================}}
\DoxyCodeLine{227 \textcolor{comment}{}\textcolor{preprocessor}{\#define JUCE\_DECLARE\_SINGLETON\_SINGLETHREADED(Classname, doNotRecreateAfterDeletion) \(\backslash\)}}
\DoxyCodeLine{228 \textcolor{preprocessor}{\(\backslash\)}}
\DoxyCodeLine{229 \textcolor{preprocessor}{    static juce::SingletonHolder<Classname, juce::DummyCriticalSection, doNotRecreateAfterDeletion> singletonHolder; \(\backslash\)}}
\DoxyCodeLine{230 \textcolor{preprocessor}{    friend decltype (singletonHolder); \(\backslash\)}}
\DoxyCodeLine{231 \textcolor{preprocessor}{\(\backslash\)}}
\DoxyCodeLine{232 \textcolor{preprocessor}{    static Classname* JUCE\_CALLTYPE getInstance()                           \{ return singletonHolder.get(); \} \(\backslash\)}}
\DoxyCodeLine{233 \textcolor{preprocessor}{    static Classname* JUCE\_CALLTYPE getInstanceWithoutCreating() noexcept   \{ return singletonHolder.instance; \} \(\backslash\)}}
\DoxyCodeLine{234 \textcolor{preprocessor}{    static void JUCE\_CALLTYPE deleteInstance() noexcept                     \{ singletonHolder.deleteInstance(); \} \(\backslash\)}}
\DoxyCodeLine{235 \textcolor{preprocessor}{    void clearSingletonInstance() noexcept                                  \{ singletonHolder.clear (this); \}}}
\DoxyCodeLine{236 }
\DoxyCodeLine{237 }
\DoxyCodeLine{238 \textcolor{comment}{//==============================================================================}}
\DoxyCodeLine{253 \textcolor{comment}{}\textcolor{preprocessor}{\#define JUCE\_DECLARE\_SINGLETON\_SINGLETHREADED\_MINIMAL(Classname) \(\backslash\)}}
\DoxyCodeLine{254 \textcolor{preprocessor}{\(\backslash\)}}
\DoxyCodeLine{255 \textcolor{preprocessor}{    static juce::SingletonHolder<Classname, juce::DummyCriticalSection, false> singletonHolder; \(\backslash\)}}
\DoxyCodeLine{256 \textcolor{preprocessor}{    friend decltype (singletonHolder); \(\backslash\)}}
\DoxyCodeLine{257 \textcolor{preprocessor}{\(\backslash\)}}
\DoxyCodeLine{258 \textcolor{preprocessor}{    static Classname* JUCE\_CALLTYPE getInstance()                           \{ return singletonHolder.getWithoutChecking(); \} \(\backslash\)}}
\DoxyCodeLine{259 \textcolor{preprocessor}{    static Classname* JUCE\_CALLTYPE getInstanceWithoutCreating() noexcept   \{ return singletonHolder.instance; \} \(\backslash\)}}
\DoxyCodeLine{260 \textcolor{preprocessor}{    static void JUCE\_CALLTYPE deleteInstance() noexcept                     \{ singletonHolder.deleteInstance(); \} \(\backslash\)}}
\DoxyCodeLine{261 \textcolor{preprocessor}{    void clearSingletonInstance() noexcept                                  \{ singletonHolder.clear (this); \}}}
\DoxyCodeLine{262 }
\DoxyCodeLine{263 }
\DoxyCodeLine{264 \textcolor{comment}{//==============================================================================}}
\DoxyCodeLine{265 \textcolor{preprocessor}{\#ifndef DOXYGEN}}
\DoxyCodeLine{266  \textcolor{comment}{// These are ancient macros, and have now been updated with new names to match the JUCE style guide,}}
\DoxyCodeLine{267  \textcolor{comment}{// so please update your code to use the newer versions!}}
\DoxyCodeLine{268 \textcolor{preprocessor}{ \#define juce\_DeclareSingleton(Classname, doNotRecreate)                JUCE\_DECLARE\_SINGLETON(Classname, doNotRecreate)}}
\DoxyCodeLine{269 \textcolor{preprocessor}{ \#define juce\_DeclareSingleton\_SingleThreaded(Classname, doNotRecreate) JUCE\_DECLARE\_SINGLETON\_SINGLETHREADED(Classname, doNotRecreate)}}
\DoxyCodeLine{270 \textcolor{preprocessor}{ \#define juce\_DeclareSingleton\_SingleThreaded\_Minimal(Classname)        JUCE\_DECLARE\_SINGLETON\_SINGLETHREADED\_MINIMAL(Classname)}}
\DoxyCodeLine{271 \textcolor{preprocessor}{ \#define juce\_ImplementSingleton(Classname)                             JUCE\_IMPLEMENT\_SINGLETON(Classname)}}
\DoxyCodeLine{272 \textcolor{preprocessor}{ \#define juce\_ImplementSingleton\_SingleThreaded(Classname)              JUCE\_IMPLEMENT\_SINGLETON(Classname)}}
\DoxyCodeLine{273 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{274 }
\DoxyCodeLine{275  \textcolor{comment}{// namespace juce}}
\DoxyCodeLine{276 }

\end{DoxyCode}
