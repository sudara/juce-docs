\hypertarget{_audio_stream_a_audio_8h_source}{}\doxysection{Audio\+Stream\+AAudio.\+h}
\label{_audio_stream_a_audio_8h_source}\index{build/juce\_audio\_devices/native/oboe/src/aaudio/AudioStreamAAudio.h@{build/juce\_audio\_devices/native/oboe/src/aaudio/AudioStreamAAudio.h}}
\mbox{\hyperlink{_audio_stream_a_audio_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{/*}}
\DoxyCodeLine{2 \textcolor{comment}{ * Copyright 2016 The Android Open Source Project}}
\DoxyCodeLine{3 \textcolor{comment}{ *}}
\DoxyCodeLine{4 \textcolor{comment}{ * Licensed under the Apache License, Version 2.0 (the "{}License"{});}}
\DoxyCodeLine{5 \textcolor{comment}{ * you may not use this file except in compliance with the License.}}
\DoxyCodeLine{6 \textcolor{comment}{ * You may obtain a copy of the License at}}
\DoxyCodeLine{7 \textcolor{comment}{ *}}
\DoxyCodeLine{8 \textcolor{comment}{ *      http://www.apache.org/licenses/LICENSE-\/2.0}}
\DoxyCodeLine{9 \textcolor{comment}{ *}}
\DoxyCodeLine{10 \textcolor{comment}{ * Unless required by applicable law or agreed to in writing, software}}
\DoxyCodeLine{11 \textcolor{comment}{ * distributed under the License is distributed on an "{}AS IS"{} BASIS,}}
\DoxyCodeLine{12 \textcolor{comment}{ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.}}
\DoxyCodeLine{13 \textcolor{comment}{ * See the License for the specific language governing permissions and}}
\DoxyCodeLine{14 \textcolor{comment}{ * limitations under the License.}}
\DoxyCodeLine{15 \textcolor{comment}{ */}}
\DoxyCodeLine{16 }
\DoxyCodeLine{17 \textcolor{preprocessor}{\#ifndef OBOE\_STREAM\_AAUDIO\_H\_}}
\DoxyCodeLine{18 \textcolor{preprocessor}{\#define OBOE\_STREAM\_AAUDIO\_H\_}}
\DoxyCodeLine{19 }
\DoxyCodeLine{20 \textcolor{preprocessor}{\#include <atomic>}}
\DoxyCodeLine{21 \textcolor{preprocessor}{\#include <shared\_mutex>}}
\DoxyCodeLine{22 \textcolor{preprocessor}{\#include <mutex>}}
\DoxyCodeLine{23 \textcolor{preprocessor}{\#include <thread>}}
\DoxyCodeLine{24 }
\DoxyCodeLine{25 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_audio_stream_builder_8h}{oboe/AudioStreamBuilder.h}}"{}}}
\DoxyCodeLine{26 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_audio_stream_8h}{oboe/AudioStream.h}}"{}}}
\DoxyCodeLine{27 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_definitions_8h}{oboe/Definitions.h}}"{}}}
\DoxyCodeLine{28 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_a_audio_loader_8h}{AAudioLoader.h}}"{}}}
\DoxyCodeLine{29 }
\DoxyCodeLine{30 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespaceoboe}{oboe}} \{}
\DoxyCodeLine{31 }
\DoxyCodeLine{38 \textcolor{keyword}{class }\mbox{\hyperlink{classoboe_1_1_audio_stream_a_audio}{AudioStreamAAudio}} : \textcolor{keyword}{public} \mbox{\hyperlink{classoboe_1_1_audio_stream}{AudioStream}} \{}
\DoxyCodeLine{39 \textcolor{keyword}{public}:}
\DoxyCodeLine{40     \mbox{\hyperlink{classoboe_1_1_audio_stream_a_audio_a81d0316139a0f89e10cb6e5d982d72be}{AudioStreamAAudio}}();}
\DoxyCodeLine{41     \textcolor{keyword}{explicit} \mbox{\hyperlink{classoboe_1_1_audio_stream_a_audio_a81d0316139a0f89e10cb6e5d982d72be}{AudioStreamAAudio}}(\textcolor{keyword}{const} \mbox{\hyperlink{classoboe_1_1_audio_stream_builder}{AudioStreamBuilder}} \&builder);}
\DoxyCodeLine{42 }
\DoxyCodeLine{43     \textcolor{keyword}{virtual} \mbox{\hyperlink{classoboe_1_1_audio_stream_a_audio_adac27103285954a6aa66a7ee9a080fad}{\string~AudioStreamAAudio}}() = \textcolor{keywordflow}{default};}
\DoxyCodeLine{44 }
\DoxyCodeLine{49     \textcolor{keyword}{static} \textcolor{keywordtype}{bool} \mbox{\hyperlink{classoboe_1_1_audio_stream_a_audio_affa6df6e0721b47ba0de62d07e2603bd}{isSupported}}();}
\DoxyCodeLine{50 }
\DoxyCodeLine{51     \textcolor{comment}{// These functions override methods in AudioStream.}}
\DoxyCodeLine{52     \textcolor{comment}{// See AudioStream for documentation.}}
\DoxyCodeLine{53     \mbox{\hyperlink{class_result}{Result}} \mbox{\hyperlink{classoboe_1_1_audio_stream_a_audio_a86b1a9511f4f0e5229329505608ec7b5}{open}}() \textcolor{keyword}{override};}
\DoxyCodeLine{54     \mbox{\hyperlink{class_result}{Result}} \mbox{\hyperlink{classoboe_1_1_audio_stream_a_audio_a0f4c297432622748a249cc094dc958f6}{close}}() \textcolor{keyword}{override};}
\DoxyCodeLine{55 }
\DoxyCodeLine{56     \mbox{\hyperlink{class_result}{Result}} \mbox{\hyperlink{classoboe_1_1_audio_stream_a_audio_a8c01f5f9303b734f054e7f5b9a7c89f9}{requestStart}}() \textcolor{keyword}{override};}
\DoxyCodeLine{57     \mbox{\hyperlink{class_result}{Result}} \mbox{\hyperlink{classoboe_1_1_audio_stream_a_audio_a83a3e6645ca9f2cc84667a9938504624}{requestPause}}() \textcolor{keyword}{override};}
\DoxyCodeLine{58     \mbox{\hyperlink{class_result}{Result}} \mbox{\hyperlink{classoboe_1_1_audio_stream_a_audio_a457c83d292ebf950d0b9d5536b4fee0b}{requestFlush}}() \textcolor{keyword}{override};}
\DoxyCodeLine{59     \mbox{\hyperlink{class_result}{Result}} \mbox{\hyperlink{classoboe_1_1_audio_stream_a_audio_a223e0d757e20d4e5dafa84653b7f80f3}{requestStop}}() \textcolor{keyword}{override};}
\DoxyCodeLine{60 }
\DoxyCodeLine{61     \mbox{\hyperlink{classoboe_1_1_result_with_value}{ResultWithValue<int32\_t>}} \mbox{\hyperlink{classoboe_1_1_audio_stream_a_audio_a335698d7135b2c24c87a2fd88163b845}{write}}(\textcolor{keyword}{const} \textcolor{keywordtype}{void} *buffer,}
\DoxyCodeLine{62                   int32\_t numFrames,}
\DoxyCodeLine{63                   int64\_t timeoutNanoseconds) \textcolor{keyword}{override};}
\DoxyCodeLine{64 }
\DoxyCodeLine{65     \mbox{\hyperlink{classoboe_1_1_result_with_value}{ResultWithValue<int32\_t>}} \mbox{\hyperlink{classoboe_1_1_audio_stream_a_audio_a5203bd78d02daef74bfcaadd5cf6b0f5}{read}}(\textcolor{keywordtype}{void} *buffer,}
\DoxyCodeLine{66                  int32\_t numFrames,}
\DoxyCodeLine{67                  int64\_t timeoutNanoseconds) \textcolor{keyword}{override};}
\DoxyCodeLine{68 }
\DoxyCodeLine{69     \mbox{\hyperlink{classoboe_1_1_result_with_value}{ResultWithValue<int32\_t>}} \mbox{\hyperlink{classoboe_1_1_audio_stream_a_audio_a618fbac4c8677ea3b5bfee9b25d7d2de}{setBufferSizeInFrames}}(int32\_t requestedFrames) \textcolor{keyword}{override};}
\DoxyCodeLine{70     int32\_t \mbox{\hyperlink{classoboe_1_1_audio_stream_a_audio_ae82151bbe15bc3c9cfd8dcfb7e06a8c9}{getBufferSizeInFrames}}() \textcolor{keyword}{override};}
\DoxyCodeLine{71     \mbox{\hyperlink{classoboe_1_1_result_with_value}{ResultWithValue<int32\_t>}} \mbox{\hyperlink{classoboe_1_1_audio_stream_a_audio_af6e4f0cc1ef9290a2bcec3411608f082}{getXRunCount}}()  \textcolor{keyword}{override};}
\DoxyCodeLine{72     \textcolor{keywordtype}{bool} \mbox{\hyperlink{classoboe_1_1_audio_stream_a_audio_aa4b01b21030d1b9e813af8ed21222ad3}{isXRunCountSupported}}()\textcolor{keyword}{ const override }\{ \textcolor{keywordflow}{return} \textcolor{keyword}{true}; \}}
\DoxyCodeLine{73 }
\DoxyCodeLine{74     \mbox{\hyperlink{classoboe_1_1_result_with_value}{ResultWithValue<double>}} \mbox{\hyperlink{classoboe_1_1_audio_stream_a_audio_acc3c8fb4affd322a0bd6dda6547eda5b}{calculateLatencyMillis}}() \textcolor{keyword}{override};}
\DoxyCodeLine{75 }
\DoxyCodeLine{76     \mbox{\hyperlink{class_result}{Result}} \mbox{\hyperlink{classoboe_1_1_audio_stream_a_audio_a4a34fe906f8090630a40028e2db2c6b2}{waitForStateChange}}(\mbox{\hyperlink{namespaceoboe_a89fa2ce046723764618c29db737917f6}{StreamState}} currentState,}
\DoxyCodeLine{77                               \mbox{\hyperlink{namespaceoboe_a89fa2ce046723764618c29db737917f6}{StreamState}} *nextState,}
\DoxyCodeLine{78                               int64\_t timeoutNanoseconds) \textcolor{keyword}{override};}
\DoxyCodeLine{79 }
\DoxyCodeLine{80     \mbox{\hyperlink{class_result}{Result}} \mbox{\hyperlink{classoboe_1_1_audio_stream_a_audio_aa7dda173622af670d6f9c4616aff2c19}{getTimestamp}}(clockid\_t clockId,}
\DoxyCodeLine{81                                        int64\_t *framePosition,}
\DoxyCodeLine{82                                        int64\_t *timeNanoseconds) \textcolor{keyword}{override};}
\DoxyCodeLine{83 }
\DoxyCodeLine{84     \mbox{\hyperlink{namespaceoboe_a89fa2ce046723764618c29db737917f6}{StreamState}} \mbox{\hyperlink{classoboe_1_1_audio_stream_a_audio_a6ae37fc1840f804b711b19cf6b22fb01}{getState}}() \textcolor{keyword}{override};}
\DoxyCodeLine{85 }
\DoxyCodeLine{86     \mbox{\hyperlink{namespaceoboe_a92972414867c81d5974cb2ed7abefbf6}{AudioApi}} \mbox{\hyperlink{classoboe_1_1_audio_stream_a_audio_acedde7d7c9708b8977a171597e041425}{getAudioApi}}()\textcolor{keyword}{ const override }\{}
\DoxyCodeLine{87         \textcolor{keywordflow}{return} \mbox{\hyperlink{namespaceoboe_a92972414867c81d5974cb2ed7abefbf6a99780b1e8d754eb42abed0ca5253e55b}{AudioApi::AAudio}};}
\DoxyCodeLine{88     \}}
\DoxyCodeLine{89 }
\DoxyCodeLine{90     \mbox{\hyperlink{namespaceoboe_af85fc9910a287df6c5df0ed396bb75cd}{DataCallbackResult}} \mbox{\hyperlink{classoboe_1_1_audio_stream_a_audio_aa8bd876ad7f2173d7af5a932cf941a64}{callOnAudioReady}}(\mbox{\hyperlink{namespaceoboe_ac7cdd4062ef770523057fef4aaf96abf}{AAudioStream}} *\mbox{\hyperlink{namespacegl_a3a0f500782e4461d09f1e29189835b3d}{stream}},}
\DoxyCodeLine{91                                                    \textcolor{keywordtype}{void} *audioData,}
\DoxyCodeLine{92                                                    int32\_t numFrames);}
\DoxyCodeLine{93 }
\DoxyCodeLine{94     \textcolor{keywordtype}{bool}                 \mbox{\hyperlink{classoboe_1_1_audio_stream_a_audio_aa68e63179fe07749d29bc31bb03bc6b9}{isMMapUsed}}();}
\DoxyCodeLine{95 }
\DoxyCodeLine{96 \textcolor{keyword}{protected}:}
\DoxyCodeLine{97     \textcolor{keyword}{static} \textcolor{keywordtype}{void} \mbox{\hyperlink{classoboe_1_1_audio_stream_a_audio_a6f02dfa061f261c385b511dfe7601db3}{internalErrorCallback}}(}
\DoxyCodeLine{98             \mbox{\hyperlink{namespaceoboe_ac7cdd4062ef770523057fef4aaf96abf}{AAudioStream}} *\mbox{\hyperlink{namespacegl_a3a0f500782e4461d09f1e29189835b3d}{stream}},}
\DoxyCodeLine{99             \textcolor{keywordtype}{void} *userData,}
\DoxyCodeLine{100             aaudio\_result\_t \mbox{\hyperlink{juce__linux___a_l_s_a_8cpp_af44443f87d7b66dff07b3d884445dca1}{error}});}
\DoxyCodeLine{101 }
\DoxyCodeLine{102     \textcolor{keywordtype}{void} *\mbox{\hyperlink{classoboe_1_1_audio_stream_a_audio_a6f1005ed951f598210de7bcdbb24b71d}{getUnderlyingStream}}()\textcolor{keyword}{ const override }\{}
\DoxyCodeLine{103         \textcolor{keywordflow}{return} mAAudioStream.load();}
\DoxyCodeLine{104     \}}
\DoxyCodeLine{105 }
\DoxyCodeLine{106     \textcolor{keywordtype}{void} \mbox{\hyperlink{classoboe_1_1_audio_stream_a_audio_a8117ebbffaf75b4c8bffa123502e08f3}{updateFramesRead}}() \textcolor{keyword}{override};}
\DoxyCodeLine{107     \textcolor{keywordtype}{void} \mbox{\hyperlink{classoboe_1_1_audio_stream_a_audio_ac2ff0d10d16e23281d27f5e5c3d4bfce}{updateFramesWritten}}() \textcolor{keyword}{override};}
\DoxyCodeLine{108 }
\DoxyCodeLine{109     \textcolor{keywordtype}{void} \mbox{\hyperlink{classoboe_1_1_audio_stream_a_audio_ace4fb95cdb9cad8eb1118a69461fd2a0}{logUnsupportedAttributes}}();}
\DoxyCodeLine{110 }
\DoxyCodeLine{111 \textcolor{keyword}{private}:}
\DoxyCodeLine{112     \textcolor{comment}{// Must call under mLock. And stream must NOT be nullptr.}}
\DoxyCodeLine{113     \mbox{\hyperlink{class_result}{Result}} requestStop\_l(\mbox{\hyperlink{namespaceoboe_ac7cdd4062ef770523057fef4aaf96abf}{AAudioStream}} *\mbox{\hyperlink{namespacegl_a3a0f500782e4461d09f1e29189835b3d}{stream}});}
\DoxyCodeLine{114 }
\DoxyCodeLine{118     \textcolor{keywordtype}{void} launchStopThread();}
\DoxyCodeLine{119 }
\DoxyCodeLine{120     \textcolor{comment}{// Time to sleep in order to prevent a race condition with a callback after a close().}}
\DoxyCodeLine{121     \textcolor{comment}{// Two milliseconds may be enough but 10 msec is even safer.}}
\DoxyCodeLine{122     \textcolor{keyword}{static} \textcolor{keyword}{constexpr} \textcolor{keywordtype}{int} kDelayBeforeCloseMillis = 10;}
\DoxyCodeLine{123 }
\DoxyCodeLine{124     std::atomic<bool>    mCallbackThreadEnabled;}
\DoxyCodeLine{125     std::atomic<bool>    mStopThreadAllowed\{\textcolor{keyword}{false}\};}
\DoxyCodeLine{126 }
\DoxyCodeLine{127     \textcolor{comment}{// pointer to the underlying 'C' AAudio stream, valid if open, null if closed}}
\DoxyCodeLine{128     std::atomic<AAudioStream *> mAAudioStream\{\textcolor{keyword}{nullptr}\};}
\DoxyCodeLine{129     std::shared\_mutex           mAAudioStreamLock; \textcolor{comment}{// to protect mAAudioStream while closing}}
\DoxyCodeLine{130 }
\DoxyCodeLine{131     \textcolor{keyword}{static} AAudioLoader *mLibLoader;}
\DoxyCodeLine{132 }
\DoxyCodeLine{133     \textcolor{comment}{// We may not use this but it is so small that it is not worth allocating dynamically.}}
\DoxyCodeLine{134     AudioStreamErrorCallback mDefaultErrorCallback;}
\DoxyCodeLine{135 \};}
\DoxyCodeLine{136 }
\DoxyCodeLine{137 \} \textcolor{comment}{// namespace oboe}}
\DoxyCodeLine{138 }
\DoxyCodeLine{139 \textcolor{preprocessor}{\#endif }\textcolor{comment}{// OBOE\_STREAM\_AAUDIO\_H\_}}

\end{DoxyCode}
