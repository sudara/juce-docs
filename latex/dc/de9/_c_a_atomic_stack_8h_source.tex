\hypertarget{_c_a_atomic_stack_8h_source}{}\doxysection{CAAtomic\+Stack.\+h}
\label{_c_a_atomic_stack_8h_source}\index{build/juce\_audio\_plugin\_client/AU/CoreAudioUtilityClasses/CAAtomicStack.h@{build/juce\_audio\_plugin\_client/AU/CoreAudioUtilityClasses/CAAtomicStack.h}}
\mbox{\hyperlink{_c_a_atomic_stack_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{/*}}
\DoxyCodeLine{2 \textcolor{comment}{     File: CAAtomicStack.h}}
\DoxyCodeLine{3 \textcolor{comment}{ Abstract: Part of CoreAudio Utility Classes}}
\DoxyCodeLine{4 \textcolor{comment}{  Version: 1.1}}
\DoxyCodeLine{5 \textcolor{comment}{}}
\DoxyCodeLine{6 \textcolor{comment}{ Disclaimer: IMPORTANT:  This Apple software is supplied to you by Apple}}
\DoxyCodeLine{7 \textcolor{comment}{ Inc. ("{}Apple"{}) in consideration of your agreement to the following}}
\DoxyCodeLine{8 \textcolor{comment}{ terms, and your use, installation, modification or redistribution of}}
\DoxyCodeLine{9 \textcolor{comment}{ this Apple software constitutes acceptance of these terms.  If you do}}
\DoxyCodeLine{10 \textcolor{comment}{ not agree with these terms, please do not use, install, modify or}}
\DoxyCodeLine{11 \textcolor{comment}{ redistribute this Apple software.}}
\DoxyCodeLine{12 \textcolor{comment}{}}
\DoxyCodeLine{13 \textcolor{comment}{ In consideration of your agreement to abide by the following terms, and}}
\DoxyCodeLine{14 \textcolor{comment}{ subject to these terms, Apple grants you a personal, non-\/exclusive}}
\DoxyCodeLine{15 \textcolor{comment}{ license, under Apple's copyrights in this original Apple software (the}}
\DoxyCodeLine{16 \textcolor{comment}{ "{}Apple Software"{}), to use, reproduce, modify and redistribute the Apple}}
\DoxyCodeLine{17 \textcolor{comment}{ Software, with or without modifications, in source and/or binary forms;}}
\DoxyCodeLine{18 \textcolor{comment}{ provided that if you redistribute the Apple Software in its entirety and}}
\DoxyCodeLine{19 \textcolor{comment}{ without modifications, you must retain this notice and the following}}
\DoxyCodeLine{20 \textcolor{comment}{ text and disclaimers in all such redistributions of the Apple Software.}}
\DoxyCodeLine{21 \textcolor{comment}{ Neither the name, trademarks, service marks or logos of Apple Inc. may}}
\DoxyCodeLine{22 \textcolor{comment}{ be used to endorse or promote products derived from the Apple Software}}
\DoxyCodeLine{23 \textcolor{comment}{ without specific prior written permission from Apple.  Except as}}
\DoxyCodeLine{24 \textcolor{comment}{ expressly stated in this notice, no other rights or licenses, express or}}
\DoxyCodeLine{25 \textcolor{comment}{ implied, are granted by Apple herein, including but not limited to any}}
\DoxyCodeLine{26 \textcolor{comment}{ patent rights that may be infringed by your derivative works or by other}}
\DoxyCodeLine{27 \textcolor{comment}{ works in which the Apple Software may be incorporated.}}
\DoxyCodeLine{28 \textcolor{comment}{}}
\DoxyCodeLine{29 \textcolor{comment}{ The Apple Software is provided by Apple on an "{}AS IS"{} basis.  APPLE}}
\DoxyCodeLine{30 \textcolor{comment}{ MAKES NO WARRANTIES, EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION}}
\DoxyCodeLine{31 \textcolor{comment}{ THE IMPLIED WARRANTIES OF NON-\/INFRINGEMENT, MERCHANTABILITY AND FITNESS}}
\DoxyCodeLine{32 \textcolor{comment}{ FOR A PARTICULAR PURPOSE, REGARDING THE APPLE SOFTWARE OR ITS USE AND}}
\DoxyCodeLine{33 \textcolor{comment}{ OPERATION ALONE OR IN COMBINATION WITH YOUR PRODUCTS.}}
\DoxyCodeLine{34 \textcolor{comment}{}}
\DoxyCodeLine{35 \textcolor{comment}{ IN NO EVENT SHALL APPLE BE LIABLE FOR ANY SPECIAL, INDIRECT, INCIDENTAL}}
\DoxyCodeLine{36 \textcolor{comment}{ OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF}}
\DoxyCodeLine{37 \textcolor{comment}{ SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS}}
\DoxyCodeLine{38 \textcolor{comment}{ INTERRUPTION) ARISING IN ANY WAY OUT OF THE USE, REPRODUCTION,}}
\DoxyCodeLine{39 \textcolor{comment}{ MODIFICATION AND/OR DISTRIBUTION OF THE APPLE SOFTWARE, HOWEVER CAUSED}}
\DoxyCodeLine{40 \textcolor{comment}{ AND WHETHER UNDER THEORY OF CONTRACT, TORT (INCLUDING NEGLIGENCE),}}
\DoxyCodeLine{41 \textcolor{comment}{ STRICT LIABILITY OR OTHERWISE, EVEN IF APPLE HAS BEEN ADVISED OF THE}}
\DoxyCodeLine{42 \textcolor{comment}{ POSSIBILITY OF SUCH DAMAGE.}}
\DoxyCodeLine{43 \textcolor{comment}{}}
\DoxyCodeLine{44 \textcolor{comment}{ Copyright (C) 2014 Apple Inc. All Rights Reserved.}}
\DoxyCodeLine{45 \textcolor{comment}{}}
\DoxyCodeLine{46 \textcolor{comment}{*/}}
\DoxyCodeLine{47 \textcolor{preprocessor}{\#ifndef \_\_CAAtomicStack\_h\_\_}}
\DoxyCodeLine{48 \textcolor{preprocessor}{\#define \_\_CAAtomicStack\_h\_\_}}
\DoxyCodeLine{49 }
\DoxyCodeLine{50 \textcolor{preprocessor}{\#if !defined(\_\_COREAUDIO\_USE\_FLAT\_INCLUDES\_\_)}}
\DoxyCodeLine{51 \textcolor{preprocessor}{    \#include <libkern/OSAtomic.h>}}
\DoxyCodeLine{52 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{53 \textcolor{preprocessor}{    \#include <\mbox{\hyperlink{_c_a_atomic_8h}{CAAtomic.h}}>}}
\DoxyCodeLine{54 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{55 }
\DoxyCodeLine{56 \textcolor{preprocessor}{\#if MAC\_OS\_X\_VERSION\_MAX\_ALLOWED < MAC\_OS\_X\_VERSION\_10\_4}}
\DoxyCodeLine{57 \textcolor{preprocessor}{    \#include <CoreServices/CoreServices.h>}}
\DoxyCodeLine{58 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{59 }
\DoxyCodeLine{60 \textcolor{comment}{//  linked list LIFO or FIFO (pop\_all\_reversed) stack, elements are pushed and popped atomically}}
\DoxyCodeLine{61 \textcolor{comment}{//  class T must implement T *\& next().}}
\DoxyCodeLine{62 \textcolor{keyword}{template} <\textcolor{keyword}{class} T>}
\DoxyCodeLine{63 \textcolor{keyword}{class }\mbox{\hyperlink{class_t_atomic_stack}{TAtomicStack}} \{}
\DoxyCodeLine{64 \textcolor{keyword}{public}:}
\DoxyCodeLine{65     \mbox{\hyperlink{class_t_atomic_stack_ae0737d98ffc727edd84afca6354f8997}{TAtomicStack}}() : \mbox{\hyperlink{class_t_atomic_stack_a04de785320baa8c41eff860da7aedb38}{mHead}}(NULL) \{ \}}
\DoxyCodeLine{66 }
\DoxyCodeLine{67     \textcolor{comment}{// non-\/atomic routines, for use when initializing/deinitializing, operate NON-\/atomically}}
\DoxyCodeLine{68     \textcolor{keywordtype}{void}    \mbox{\hyperlink{class_t_atomic_stack_a2b2e5aa60721b136f51831f867df7eed}{push\_NA}}(T *item)}
\DoxyCodeLine{69     \{}
\DoxyCodeLine{70         item-\/>next() = \mbox{\hyperlink{class_t_atomic_stack_a04de785320baa8c41eff860da7aedb38}{mHead}};}
\DoxyCodeLine{71         \mbox{\hyperlink{class_t_atomic_stack_a04de785320baa8c41eff860da7aedb38}{mHead}} = item;}
\DoxyCodeLine{72     \}}
\DoxyCodeLine{73 }
\DoxyCodeLine{74     T *     \mbox{\hyperlink{class_t_atomic_stack_a29bca1dfd0b2f0d91ab72fc7b2a808d8}{pop\_NA}}()}
\DoxyCodeLine{75     \{}
\DoxyCodeLine{76         T *\mbox{\hyperlink{namespacegl_a7cb1126dbc1cb105bcce082cff5ae633}{result}} = \mbox{\hyperlink{class_t_atomic_stack_a04de785320baa8c41eff860da7aedb38}{mHead}};}
\DoxyCodeLine{77         \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespacegl_a7cb1126dbc1cb105bcce082cff5ae633}{result}})}
\DoxyCodeLine{78             \mbox{\hyperlink{class_t_atomic_stack_a04de785320baa8c41eff860da7aedb38}{mHead}} = \mbox{\hyperlink{namespacegl_a7cb1126dbc1cb105bcce082cff5ae633}{result}}-\/>next();}
\DoxyCodeLine{79         \textcolor{keywordflow}{return} \mbox{\hyperlink{namespacegl_a7cb1126dbc1cb105bcce082cff5ae633}{result}};}
\DoxyCodeLine{80     \}}
\DoxyCodeLine{81 }
\DoxyCodeLine{82     \textcolor{keywordtype}{bool}    \mbox{\hyperlink{class_t_atomic_stack_a02ec90a14f8b09e014d6ef1582b11da8}{empty}}()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} \mbox{\hyperlink{class_t_atomic_stack_a04de785320baa8c41eff860da7aedb38}{mHead}} == NULL; \}}
\DoxyCodeLine{83 }
\DoxyCodeLine{84     T *     \mbox{\hyperlink{class_t_atomic_stack_a0a95ef24b2514b8eb74c825bc2affb80}{head}}() \{ \textcolor{keywordflow}{return} \mbox{\hyperlink{class_t_atomic_stack_a04de785320baa8c41eff860da7aedb38}{mHead}}; \}}
\DoxyCodeLine{85 }
\DoxyCodeLine{86     \textcolor{comment}{// atomic routines}}
\DoxyCodeLine{87     \textcolor{keywordtype}{void}    \mbox{\hyperlink{class_t_atomic_stack_a297439766835e454a4748c9269bf2694}{push\_atomic}}(T *item)}
\DoxyCodeLine{88     \{}
\DoxyCodeLine{89         T *head\_;}
\DoxyCodeLine{90         \textcolor{keywordflow}{do} \{}
\DoxyCodeLine{91             head\_ = \mbox{\hyperlink{class_t_atomic_stack_a04de785320baa8c41eff860da7aedb38}{mHead}};}
\DoxyCodeLine{92             item-\/>next() = head\_;}
\DoxyCodeLine{93         \} \textcolor{keywordflow}{while} (!\mbox{\hyperlink{class_t_atomic_stack_adf394c62801e19e5db45b2c5122eb7b2}{compare\_and\_swap}}(head\_, item, \&\mbox{\hyperlink{class_t_atomic_stack_a04de785320baa8c41eff860da7aedb38}{mHead}}));}
\DoxyCodeLine{94     \}}
\DoxyCodeLine{95 }
\DoxyCodeLine{96     \textcolor{keywordtype}{void}    \mbox{\hyperlink{class_t_atomic_stack_a2754aa0e5fc1e53ee666b7eea1214d73}{push\_multiple\_atomic}}(T *item)}
\DoxyCodeLine{97         \textcolor{comment}{// pushes entire linked list headed by item}}
\DoxyCodeLine{98     \{}
\DoxyCodeLine{99         T *head\_, *\mbox{\hyperlink{namespacegl_ab8b154a639177df172c80eddeb09a533}{p}} = item, *tail;}
\DoxyCodeLine{100         \textcolor{comment}{// find the last one -\/-\/ when done, it will be linked to head}}
\DoxyCodeLine{101         \textcolor{keywordflow}{do} \{}
\DoxyCodeLine{102             tail = \mbox{\hyperlink{namespacegl_ab8b154a639177df172c80eddeb09a533}{p}};}
\DoxyCodeLine{103             \mbox{\hyperlink{namespacegl_ab8b154a639177df172c80eddeb09a533}{p}} = \mbox{\hyperlink{namespacegl_ab8b154a639177df172c80eddeb09a533}{p}}-\/>next();}
\DoxyCodeLine{104         \} \textcolor{keywordflow}{while} (\mbox{\hyperlink{namespacegl_ab8b154a639177df172c80eddeb09a533}{p}});}
\DoxyCodeLine{105         \textcolor{keywordflow}{do} \{}
\DoxyCodeLine{106             head\_ = \mbox{\hyperlink{class_t_atomic_stack_a04de785320baa8c41eff860da7aedb38}{mHead}};}
\DoxyCodeLine{107             tail-\/>next() = head\_;}
\DoxyCodeLine{108         \} \textcolor{keywordflow}{while} (!\mbox{\hyperlink{class_t_atomic_stack_adf394c62801e19e5db45b2c5122eb7b2}{compare\_and\_swap}}(head\_, item, \&\mbox{\hyperlink{class_t_atomic_stack_a04de785320baa8c41eff860da7aedb38}{mHead}}));}
\DoxyCodeLine{109     \}}
\DoxyCodeLine{110 }
\DoxyCodeLine{111     T *     \mbox{\hyperlink{class_t_atomic_stack_aba0c8fad9b6a98cb87192e34747389bb}{pop\_atomic\_single\_reader}}()}
\DoxyCodeLine{112         \textcolor{comment}{// this may only be used when only one thread may potentially pop from the stack.}}
\DoxyCodeLine{113         \textcolor{comment}{// if multiple threads may pop, this suffers from the ABA problem.}}
\DoxyCodeLine{114         \textcolor{comment}{// <rdar://problem/4606346> TAtomicStack suffers from the ABA problem}}
\DoxyCodeLine{115     \{}
\DoxyCodeLine{116         T *\mbox{\hyperlink{namespacegl_a7cb1126dbc1cb105bcce082cff5ae633}{result}};}
\DoxyCodeLine{117         \textcolor{keywordflow}{do} \{}
\DoxyCodeLine{118             \textcolor{keywordflow}{if} ((\mbox{\hyperlink{namespacegl_a7cb1126dbc1cb105bcce082cff5ae633}{result}} = \mbox{\hyperlink{class_t_atomic_stack_a04de785320baa8c41eff860da7aedb38}{mHead}}) == NULL)}
\DoxyCodeLine{119                 \textcolor{keywordflow}{break};}
\DoxyCodeLine{120         \} \textcolor{keywordflow}{while} (!\mbox{\hyperlink{class_t_atomic_stack_adf394c62801e19e5db45b2c5122eb7b2}{compare\_and\_swap}}(\mbox{\hyperlink{namespacegl_a7cb1126dbc1cb105bcce082cff5ae633}{result}}, \mbox{\hyperlink{namespacegl_a7cb1126dbc1cb105bcce082cff5ae633}{result}}-\/>next(), \&\mbox{\hyperlink{class_t_atomic_stack_a04de785320baa8c41eff860da7aedb38}{mHead}}));}
\DoxyCodeLine{121         \textcolor{keywordflow}{return} \mbox{\hyperlink{namespacegl_a7cb1126dbc1cb105bcce082cff5ae633}{result}};}
\DoxyCodeLine{122     \}}
\DoxyCodeLine{123 }
\DoxyCodeLine{124     T *     \mbox{\hyperlink{class_t_atomic_stack_acb9605b77e3204dfd282f15d3e6389dd}{pop\_atomic}}()}
\DoxyCodeLine{125         \textcolor{comment}{// This is inefficient for large linked lists.}}
\DoxyCodeLine{126         \textcolor{comment}{// prefer pop\_all() to a series of calls to pop\_atomic.}}
\DoxyCodeLine{127         \textcolor{comment}{// push\_multiple\_atomic has to traverse the entire list.}}
\DoxyCodeLine{128     \{}
\DoxyCodeLine{129         T *\mbox{\hyperlink{namespacegl_a7cb1126dbc1cb105bcce082cff5ae633}{result}} = \mbox{\hyperlink{class_t_atomic_stack_a317866c1056892a52dcd5e1ac7986b3a}{pop\_all}}();}
\DoxyCodeLine{130         \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespacegl_a7cb1126dbc1cb105bcce082cff5ae633}{result}}) \{}
\DoxyCodeLine{131             T *next = \mbox{\hyperlink{namespacegl_a7cb1126dbc1cb105bcce082cff5ae633}{result}}-\/>next();}
\DoxyCodeLine{132             \textcolor{keywordflow}{if} (next)}
\DoxyCodeLine{133                 \textcolor{comment}{// push all the remaining items back onto the stack}}
\DoxyCodeLine{134                 \mbox{\hyperlink{class_t_atomic_stack_a2754aa0e5fc1e53ee666b7eea1214d73}{push\_multiple\_atomic}}(next);}
\DoxyCodeLine{135         \}}
\DoxyCodeLine{136         \textcolor{keywordflow}{return} \mbox{\hyperlink{namespacegl_a7cb1126dbc1cb105bcce082cff5ae633}{result}};}
\DoxyCodeLine{137     \}}
\DoxyCodeLine{138 }
\DoxyCodeLine{139     T *     \mbox{\hyperlink{class_t_atomic_stack_a317866c1056892a52dcd5e1ac7986b3a}{pop\_all}}()}
\DoxyCodeLine{140     \{}
\DoxyCodeLine{141         T *\mbox{\hyperlink{namespacegl_a7cb1126dbc1cb105bcce082cff5ae633}{result}};}
\DoxyCodeLine{142         \textcolor{keywordflow}{do} \{}
\DoxyCodeLine{143             \textcolor{keywordflow}{if} ((\mbox{\hyperlink{namespacegl_a7cb1126dbc1cb105bcce082cff5ae633}{result}} = \mbox{\hyperlink{class_t_atomic_stack_a04de785320baa8c41eff860da7aedb38}{mHead}}) == NULL)}
\DoxyCodeLine{144                 \textcolor{keywordflow}{break};}
\DoxyCodeLine{145         \} \textcolor{keywordflow}{while} (!\mbox{\hyperlink{class_t_atomic_stack_adf394c62801e19e5db45b2c5122eb7b2}{compare\_and\_swap}}(\mbox{\hyperlink{namespacegl_a7cb1126dbc1cb105bcce082cff5ae633}{result}}, NULL, \&\mbox{\hyperlink{class_t_atomic_stack_a04de785320baa8c41eff860da7aedb38}{mHead}}));}
\DoxyCodeLine{146         \textcolor{keywordflow}{return} \mbox{\hyperlink{namespacegl_a7cb1126dbc1cb105bcce082cff5ae633}{result}};}
\DoxyCodeLine{147     \}}
\DoxyCodeLine{148 }
\DoxyCodeLine{149     T*      \mbox{\hyperlink{class_t_atomic_stack_ac33b06fb2aafe19936a7648464648510}{pop\_all\_reversed}}()}
\DoxyCodeLine{150     \{}
\DoxyCodeLine{151         \mbox{\hyperlink{class_t_atomic_stack}{TAtomicStack<T>}} reversed;}
\DoxyCodeLine{152         T *\mbox{\hyperlink{namespacegl_ab8b154a639177df172c80eddeb09a533}{p}} = \mbox{\hyperlink{class_t_atomic_stack_a317866c1056892a52dcd5e1ac7986b3a}{pop\_all}}(), *next;}
\DoxyCodeLine{153         \textcolor{keywordflow}{while} (\mbox{\hyperlink{namespacegl_ab8b154a639177df172c80eddeb09a533}{p}} != NULL) \{}
\DoxyCodeLine{154             next = \mbox{\hyperlink{namespacegl_ab8b154a639177df172c80eddeb09a533}{p}}-\/>next();}
\DoxyCodeLine{155             reversed.\mbox{\hyperlink{class_t_atomic_stack_a2b2e5aa60721b136f51831f867df7eed}{push\_NA}}(\mbox{\hyperlink{namespacegl_ab8b154a639177df172c80eddeb09a533}{p}});}
\DoxyCodeLine{156             \mbox{\hyperlink{namespacegl_ab8b154a639177df172c80eddeb09a533}{p}} = next;}
\DoxyCodeLine{157         \}}
\DoxyCodeLine{158         \textcolor{keywordflow}{return} reversed.\mbox{\hyperlink{class_t_atomic_stack_a04de785320baa8c41eff860da7aedb38}{mHead}};}
\DoxyCodeLine{159     \}}
\DoxyCodeLine{160 }
\DoxyCodeLine{161     \textcolor{keyword}{static} \textcolor{keywordtype}{bool} \mbox{\hyperlink{class_t_atomic_stack_adf394c62801e19e5db45b2c5122eb7b2}{compare\_and\_swap}}(T *oldvalue, T *newvalue, T **pvalue)}
\DoxyCodeLine{162     \{}
\DoxyCodeLine{163 \textcolor{preprocessor}{\#if TARGET\_OS\_MAC}}
\DoxyCodeLine{164 \textcolor{preprocessor}{    \#if \_\_LP64\_\_}}
\DoxyCodeLine{165             return ::OSAtomicCompareAndSwap64Barrier(int64\_t(oldvalue), int64\_t(newvalue), (int64\_t *)pvalue);}
\DoxyCodeLine{166 \textcolor{preprocessor}{    \#elif MAC\_OS\_X\_VERSION\_MAX\_ALLOWED >= MAC\_OS\_X\_VERSION\_10\_4}}
\DoxyCodeLine{167             return ::OSAtomicCompareAndSwap32Barrier(int32\_t(oldvalue), int32\_t(newvalue), (int32\_t *)pvalue);}
\DoxyCodeLine{168 \textcolor{preprocessor}{    \#else}}
\DoxyCodeLine{169             return ::CompareAndSwap(UInt32(oldvalue), UInt32(newvalue), (UInt32 *)pvalue);}
\DoxyCodeLine{170 \textcolor{preprocessor}{    \#endif}}
\DoxyCodeLine{171 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{172             \textcolor{comment}{//return ::CompareAndSwap(UInt32(oldvalue), UInt32(newvalue), (UInt32 *)pvalue);}}
\DoxyCodeLine{173             \textcolor{keywordflow}{return} \mbox{\hyperlink{_c_a_atomic_8h_ad758a4df9a61e953cf58befe86e712a2}{CAAtomicCompareAndSwap32Barrier}}(SInt32(oldvalue), SInt32(newvalue), (SInt32*)pvalue);}
\DoxyCodeLine{174 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{175     \}}
\DoxyCodeLine{176 }
\DoxyCodeLine{177 \textcolor{keyword}{protected}:}
\DoxyCodeLine{178     T *     \mbox{\hyperlink{class_t_atomic_stack_a04de785320baa8c41eff860da7aedb38}{mHead}};}
\DoxyCodeLine{179 \};}
\DoxyCodeLine{180 }
\DoxyCodeLine{181 \textcolor{preprocessor}{\#if ((MAC\_OS\_X\_VERSION\_MAX\_ALLOWED >= MAC\_OS\_X\_VERSION\_10\_5) \&\& !TARGET\_OS\_WIN32)}}
\DoxyCodeLine{182 \textcolor{preprocessor}{\#include <libkern/OSAtomic.h>}}
\DoxyCodeLine{183 }
\DoxyCodeLine{184 \textcolor{keyword}{class }\mbox{\hyperlink{class_c_a_atomic_stack}{CAAtomicStack}} \{}
\DoxyCodeLine{185 \textcolor{keyword}{public}:}
\DoxyCodeLine{186     \mbox{\hyperlink{class_c_a_atomic_stack_a54e308212020ab00643306212497cd10}{CAAtomicStack}}(\textcolor{keywordtype}{size\_t} nextPtrOffset) : mNextPtrOffset(nextPtrOffset) \{}
\DoxyCodeLine{187         \textcolor{comment}{/*OSQueueHead h = OS\_ATOMIC\_QUEUE\_INIT; mHead = h;*/}}
\DoxyCodeLine{188         mHead.opaque1 = 0; mHead.opaque2 = 0;}
\DoxyCodeLine{189     \}}
\DoxyCodeLine{190     \textcolor{comment}{// a subset of the above}}
\DoxyCodeLine{191     \textcolor{keywordtype}{void}    \mbox{\hyperlink{class_c_a_atomic_stack_a1ba06e7fbb9e9449db78518c8dc10163}{push\_atomic}}(\textcolor{keywordtype}{void} *\mbox{\hyperlink{namespacegl_ab8b154a639177df172c80eddeb09a533}{p}}) \{ OSAtomicEnqueue(\&mHead, \mbox{\hyperlink{namespacegl_ab8b154a639177df172c80eddeb09a533}{p}}, mNextPtrOffset); \}}
\DoxyCodeLine{192     \textcolor{keywordtype}{void}    \mbox{\hyperlink{class_c_a_atomic_stack_a7961071448e838a09665acd359b4ef28}{push\_NA}}(\textcolor{keywordtype}{void} *\mbox{\hyperlink{namespacegl_ab8b154a639177df172c80eddeb09a533}{p}}) \{ \mbox{\hyperlink{class_c_a_atomic_stack_a1ba06e7fbb9e9449db78518c8dc10163}{push\_atomic}}(\mbox{\hyperlink{namespacegl_ab8b154a639177df172c80eddeb09a533}{p}}); \}}
\DoxyCodeLine{193 }
\DoxyCodeLine{194     \textcolor{keywordtype}{void} *  \mbox{\hyperlink{class_c_a_atomic_stack_ad628f0c4809f6aa3ece508edf76f93de}{pop\_atomic}}() \{ \textcolor{keywordflow}{return} OSAtomicDequeue(\&mHead, mNextPtrOffset); \}}
\DoxyCodeLine{195     \textcolor{keywordtype}{void} *  \mbox{\hyperlink{class_c_a_atomic_stack_ad6bd2376027ea5f4ccbf9a8da5c63aad}{pop\_atomic\_single\_reader}}() \{ \textcolor{keywordflow}{return} \mbox{\hyperlink{class_c_a_atomic_stack_ad628f0c4809f6aa3ece508edf76f93de}{pop\_atomic}}(); \}}
\DoxyCodeLine{196     \textcolor{keywordtype}{void} *  \mbox{\hyperlink{class_c_a_atomic_stack_aef42324dd66eb1aa9d3c56fa524d5eac}{pop\_NA}}() \{ \textcolor{keywordflow}{return} \mbox{\hyperlink{class_c_a_atomic_stack_ad628f0c4809f6aa3ece508edf76f93de}{pop\_atomic}}(); \}}
\DoxyCodeLine{197 }
\DoxyCodeLine{198 \textcolor{keyword}{private}:}
\DoxyCodeLine{199     OSQueueHead     mHead;}
\DoxyCodeLine{200     \textcolor{keywordtype}{size\_t}          mNextPtrOffset;}
\DoxyCodeLine{201 \};}
\DoxyCodeLine{202 }
\DoxyCodeLine{203 \textcolor{comment}{// a more efficient subset of TAtomicStack using OSQueue.}}
\DoxyCodeLine{204 \textcolor{keyword}{template} <\textcolor{keyword}{class} T>}
\DoxyCodeLine{205 \textcolor{keyword}{class }\mbox{\hyperlink{class_t_atomic_stack2}{TAtomicStack2}} \{}
\DoxyCodeLine{206 \textcolor{keyword}{public}:}
\DoxyCodeLine{207     \mbox{\hyperlink{class_t_atomic_stack2_aa13ffcbb6c7d4a12c04d24aca89376bc}{TAtomicStack2}}() \{}
\DoxyCodeLine{208         \textcolor{comment}{/*OSQueueHead h = OS\_ATOMIC\_QUEUE\_INIT; mHead = h;*/}}
\DoxyCodeLine{209         mHead.opaque1 = 0; mHead.opaque2 = 0;}
\DoxyCodeLine{210         mNextPtrOffset = -\/1;}
\DoxyCodeLine{211     \}}
\DoxyCodeLine{212     \textcolor{keywordtype}{void}    \mbox{\hyperlink{class_t_atomic_stack2_a699abdf24e04a851e3e319cda1c42bb8}{push\_atomic}}(T *item) \{}
\DoxyCodeLine{213         \textcolor{keywordflow}{if} (mNextPtrOffset < 0) \{}
\DoxyCodeLine{214             T **pnext = \&item-\/>next();  \textcolor{comment}{// hack around offsetof not working with C++}}
\DoxyCodeLine{215             mNextPtrOffset = (\mbox{\hyperlink{zconf_8h_ae3a497195d617519e5353ea7b417940f}{Byte}} *)pnext -\/ (\mbox{\hyperlink{zconf_8h_ae3a497195d617519e5353ea7b417940f}{Byte}} *)item;}
\DoxyCodeLine{216         \}}
\DoxyCodeLine{217         OSAtomicEnqueue(\&mHead, item, mNextPtrOffset);}
\DoxyCodeLine{218     \}}
\DoxyCodeLine{219     \textcolor{keywordtype}{void}    \mbox{\hyperlink{class_t_atomic_stack2_a8c34510cf6513b3b1593e03f87872d83}{push\_NA}}(T *item) \{ \mbox{\hyperlink{class_t_atomic_stack2_a699abdf24e04a851e3e319cda1c42bb8}{push\_atomic}}(item); \}}
\DoxyCodeLine{220 }
\DoxyCodeLine{221     T *     \mbox{\hyperlink{class_t_atomic_stack2_a2a351b4087bd51144cf83aef80e6972c}{pop\_atomic}}() \{ \textcolor{keywordflow}{return} (T *)OSAtomicDequeue(\&mHead, mNextPtrOffset); \}}
\DoxyCodeLine{222     T *     \mbox{\hyperlink{class_t_atomic_stack2_ae3a83fa5c43b711e4f847f718c03af9b}{pop\_atomic\_single\_reader}}() \{ \textcolor{keywordflow}{return} \mbox{\hyperlink{class_t_atomic_stack2_a2a351b4087bd51144cf83aef80e6972c}{pop\_atomic}}(); \}}
\DoxyCodeLine{223     T *     \mbox{\hyperlink{class_t_atomic_stack2_af2693de1e5b6fc30ae3eba910bb65966}{pop\_NA}}() \{ \textcolor{keywordflow}{return} \mbox{\hyperlink{class_t_atomic_stack2_a2a351b4087bd51144cf83aef80e6972c}{pop\_atomic}}(); \}}
\DoxyCodeLine{224 }
\DoxyCodeLine{225     \textcolor{comment}{// caution: do not try to implement pop\_all\_reversed here. the writer could add new elements}}
\DoxyCodeLine{226     \textcolor{comment}{// while the reader is trying to pop old ones!}}
\DoxyCodeLine{227 }
\DoxyCodeLine{228 \textcolor{keyword}{private}:}
\DoxyCodeLine{229     OSQueueHead     mHead;}
\DoxyCodeLine{230     ssize\_t         mNextPtrOffset;}
\DoxyCodeLine{231 \};}
\DoxyCodeLine{232 }
\DoxyCodeLine{233 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{234 }
\DoxyCodeLine{235 \textcolor{preprocessor}{\#define TAtomicStack2 TAtomicStack}}
\DoxyCodeLine{236 }
\DoxyCodeLine{237 \textcolor{preprocessor}{\#endif }\textcolor{comment}{// MAC\_OS\_X\_VERSION\_MAX\_ALLOWED \&\& !TARGET\_OS\_WIN32}}
\DoxyCodeLine{238 }
\DoxyCodeLine{239 \textcolor{preprocessor}{\#endif }\textcolor{comment}{// \_\_CAAtomicStack\_h\_\_}}

\end{DoxyCode}
